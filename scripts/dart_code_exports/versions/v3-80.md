# Dart-Code v3-80

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.80.0 _2023-12-27_

## Flutter

  * [#4867](https://github.com/Dart-Code/Dart-Code/issues/4867): Running a script with a `cwd` set to another project no longer sometimes selects the wrong type of debugger (for example Flutter when trying to run a Dart CLI script from another project with the `cwd` set to a Flutter project)

  > **#4867**: Cannot run CLI script located in another package from a Flutter project's launch configuration since version 3.78.0 `is bug` `in flutter`
  > ## Describe the bug:
  > Since version 3.78.0 ([commit](https://github.com/Dart-Code/Dart-Code/commit/74fd1ff0b6968cd59d3a03d2472897c25de482de)) it is not possible anymore to run dart scripts from another package because the path has to start with bin/
  > 
  > We have a monorepo setup and one of the packages contains multiple cli scripts (for syncing the styleguide, syncing translations, exporting translations, ...) The way we do that is running the cli script but the cwd is actually the other package. Maybe a better approach would be to make it possible to debug cli scripts defined by the package, so for example `dart pub run tools:toolX`.
  > 
  > ## To Reproduce:
  > I created a demo project https://github.com/krispypen/dart_extension_bin_issue
  > if you open the workspace file in vscode and then try to run "Run toolX" it will not run because it is not recognized as a dart script. On version 3.76.1 and lower it works.
  > 
  > ## Expected behavior:
  > until version 3.76.1 it was possible to run dart cli scrip
  > 
  > _(truncated)_

  * [#4904](https://github.com/Dart-Code/Dart-Code/issues/4904): The Flutter device daemon is now fully initialised before trying to query the supported platforms for a project. This may solve some race conditions that would prevent the correct devices from showing.

  > **#4904**: getSupportedPlatforms is sometimes called before the Flutter device daemon is fully initialized `is bug` `in flutter`
  > See https://github.com/Dart-Code/Dart-Code/issues/4840#issuecomment-1860124476

  * [#4885](https://github.com/Dart-Code/Dart-Code/issues/4885): For new versions of Flutter, launching an application will not overwrite any custom Pub root directories set via DevTools (by using the `addPubRootDirectories` service instead of `setPubRootDirectories`).

  > **#4885**: Migrate from setPubRootDirectories to addPubRootDirectories `is enhancement` `in flutter` `in debugging`
  > See https://github.com/flutter/flutter/commit/76f056ac6fde78a7f25339949dc7798b12822030
  > 
  > We need to only do this for SDKs newer than when the new API was added, and still use the old one for others.




## Editor

  * [#4896](https://github.com/Dart-Code/Dart-Code/issues/4896): The “Add ‘foo’ to dependencies” quick-fix will no longer appear duplicated when both `uri_does_not_exist` and `depend_on_referenced_packages` diagnostics are produced.

  > **#4896**: Duplicate "Add 'foo' to dependencies" action `is bug` `in editor`
  > When testing https://github.com/Dart-Code/Dart-Code/issues/4895 I saw this:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/0824ea86-b18c-4e96-a8eb-7ed86a834ca2)
  > 
  > We sometimes show both dependencies + dev_dependencies, but we shouldn't show two the same.

  * [#4808](https://github.com/Dart-Code/Dart-Code/issues/4808): Code completion now triggers automatically when typing inside an string interpolation expression.

  > **#4808**: Completion does not trigger automatically when typing inside an string interpolation expression `is bug` `in editor`
  > **Describe the bug**
  > Good:
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/21116742/6e169e64-2b87-47c5-a578-a59bb182982f
  > 
  > Bad:
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/21116742/38de09fa-c2bd-4a52-9a6c-e2c950cef459
  > 
  > **Note:** when you see the completion menu disappearing, it's me pressing `Esc`.
  > 
  > **Please complete the following information:**
  > 
  > Dart Code extension: 3.74.0
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: mac 1.83.1
  > 
  > Workspace type: Dart (LSP)
  > 
  > Dart (3.2.0-210.1.beta): /Users/dimannich/Desktop/flutter/bin/cache/dart-sdk
  > Flutter (3.16.0-0.1.pre): /Users/dimannich/Desktop/flutter

  * [#4719](https://github.com/Dart-Code/Dart-Code/issues/4719): When editing `.arb` files, a recommendation for the [ARB Editor](https://marketplace.visualstudio.com/items?itemName=Google.arb-editor) extension may be shown.

  > **#4719**: Suggest installing the ARB extension when editing arb files `is enhancement` `in editor`
  > The [ARB editor](https://marketplace.visualstudio.com/items?itemName=Google.arb-editor) extension provides language support for ARB files used for translating Flutter apps.
  > 
  > Since VS Code [has removed recommending extensions](https://github.com/microsoft/vscode/issues/188467) based on file extension we should consider showing a notification when a Flutter developer opens an ARB file offering to install the extension.
  > 
  > Something like:
  > 
  > > The ARB Editor extension can help with editing '.arb' files
  > > [Install Extension]   [Don't Show Again]
  > 
  > If the user does not interact with the notification at all (because they might not have noticed it and VS Code hides it after ~10s) we could re-show it only after some snooze period.
  > 
  > It should be shown:
  > 
  > - only if the extension is not already installed
  > - only if we have detected a Dart or Flutter project ~~(Dart doesn't currently use ARB files? @mosuem)~~
  > 
  > Questions:
  > 
  > - How long should we snooze before showing it again if not intera
  > 
  > _(truncated)_

  * [#4897](https://github.com/Dart-Code/Dart-Code/issues/4897): [@hrishikesh-kadam](https://github.com/hrishikesh-kadam) contributed an update to the recommended settings to bring `editor.wordBasedSuggestions` inline with new values in VS Code 1.85.

  > **#4897**: Update editor.wordBasedSuggestions for VS Code 1.85.0 `is enhancement`
  > References:
  > - https://github.com/microsoft/vscode/pull/197690
  > - https://github.com/microsoft/vscode/blob/f06dad8535e4556e97734a83a2eac83ca23af8eb/src/vs/editor/common/config/editorConfigurationSchema.ts#L64-L74




## Debugger

  * [#4906](https://github.com/Dart-Code/Dart-Code/issues/4906): The default files created at `bin/(project_name).dart` in console applications are now treated as potential default entry points, just as `bin/main.dart` is.

  > **#4906**: Support `bin/__project_name__` as a default entry point `is enhancement` `in debugging`
  > Right now if you press `F5` in a Dart CLI script we'll detect `bin/main.dart` as a default entry point. However, `dart create` has created the bin file with the same name as the project for a while now. This results in us telling you to add a `program` to your `launch.json` even though a) we could trivially infer this if it matches the folder name and b) we generally don't want people to create `launch.json`s for trivial projects.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They may be available to test in the current beta/master channels and will show up in future SDK releases.

  * [#4891](https://github.com/Dart-Code/Dart-Code/issues/4891): Inlay hints are now shown for for-in loops and for elements in collections.

  > **#4891**: Inlay hints not shown on collection control statements `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > When `var` is used in a for loop inside a collection, it doesn't show the type of the object.
  > 
  > **To Reproduce**
  > Paste this code into any function:
  > ```dart
  > var objects = ["1"];
  > var objects2 = [for (var i in objects) i];
  > ```
  > 
  > **Expected behavior**
  > ```dart
  > var List objects = ["1"];
  > var List objects2 = [for (var String i in objects) i];
  > ```
  > 
  > **Screenshots**
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/120231845/e6f31358-a018-459c-986f-24e8052f9895)
  > 
  > **Please complete the following information:**
  > 
  > You can run the **Dart: Collect Diagnostic Information** command from the VS Code command palette (`F1`) to easily capture this 
  > 
  > 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.79.20231206
  > Flutter extension: 3.78.0 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: win 1.85.0
  > 
  > Workspace type: Flutter (LSP)
  > 
  > Dart (3.3.0-166.0.dev): C:\Global\sdk\dart-sdk
  > Flutter (3.18.0-2.0.pre.27): C:\Global\sdk\flutter (Win
  > 
  > _(truncated)_

  * [#4865](https://github.com/Dart-Code/Dart-Code/issues/4865): Format document no longer sometimes adds blank lines in file that use `\n` line endings after formatting another file using `\r\n` line endings.

  > **#4865**: Format document sometimes adds blank newlines between every line `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > I've seen this a couple of times in the last few days:
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/1078012/4cbe6c12-36ae-4b86-bd0f-d846fe0936c1
  > 
  > My feeling is that it's related to having a document that is mostly LF but then you add some CRLF (for example during a merge conflict or pasting).
  > 
  > Here's a (zipped, to reduce the chance of anything messing with it) copy of the file from the video in the state that triggers it.
  > 
  > [handler_execute_command.zip](https://github.com/Dart-Code/Dart-Code/files/13515343/handler_execute_command.zip)
  > 
  > And as I hit save, I reload VS Code to ensure it still occurs, but it does not. So probably there is some state involved and it's not just the file on disk. It's unclear if the issue is on the server or the client side.

  * [#4863](https://github.com/Dart-Code/Dart-Code/issues/4863): Static types are now shown correctly in hovers for getters using generic types.

  > **#4863**: Not show generic type of getter Flutter 3.16 `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > Not show generic type of getter
  > 
  > **To Reproduce**
  > ```
  > class BaseState {
  >   late final T? data;
  >   T? get test => data;
  > }
  > 
  > final data = (BaseState()).data;
  > final test = (BaseState()).test;
  > ```
  > 
  > **Expected behavior**
  > Hover `.test` should show `Type: bool?` like `.data` does.
  > 
  > **Screenshots**
  > ![Screenshot 2023-11-29 150843](https://github.com/Dart-Code/Dart-Code/assets/35319492/953558bd-e883-462e-9413-a88004a6839d)
  > ![Screenshot 2023-11-29 150851](https://github.com/Dart-Code/Dart-Code/assets/35319492/1caee50f-b7d8-4016-a57f-366bf7000c0a)
  > 
  > **Please complete the following information:**
  > 
  > You can run the **Dart: Collect Diagnostic Information** command from the VS Code command palette (`F1`) to easily capture this information or provide it manually.
  > 
  >  - Operating System and version: windows 11
  >  - VS Code version: 1.84.2
  >  - Dart extension version: v3.76.1
  >  - Dart/Flutter SDK version: 3.2.1 / 3.16.1

