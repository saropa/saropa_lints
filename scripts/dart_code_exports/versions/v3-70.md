# Dart-Code v3-70

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.70.0 _2023-08-01_

## Editor

  * [#4637](https://github.com/Dart-Code/Dart-Code/issues/4637): A new setting `dart.sdkSwitchingTarget` allows you to configure the SDK Picker to modify the selected SDK globally, instead of only for the current workspace.

  > **#4637**: Add a setting to allow the SDK switcher to write to global user settings instead of workspace settings `is enhancement` `in commands`
  > The current behaviour was convenient for me, but might not be what users prefer/expect.
  > 
  > (cc @polina-c)

  * [#4630](https://github.com/Dart-Code/Dart-Code/issues/4630): The “SDK configured in dart.[flutter]sdkPath is not a valid SDK folder” warning message now opens the specific settings file that configures the invalid path (instead of always User Settings).

  > **#4630**: "Open Settings File" in "Bad SDK path" warning always opens user settings `is bug` `in editor`
  > If you set an invalid SDK path in the workspace level, then click "Open Settings" on the warning, it will always open user settings. It should open wherever the SDK path was defined.




## Flutter

  * [#4632](https://github.com/Dart-Code/Dart-Code/issues/4632): The Flutter device picker now shows the IDs of devices so that two devices of the same kind can be differentiated.

  > **#4632**: Cannot differentiate two devices of the same type in the device selector `is enhancement` `in flutter`
  > Type: Bug
  > 
  > i have two same phones. when i connect both to computer, vs code shows their names in "select device to use" and they are same. cannot understand what is what.
  > it is a name of phone model, so it cannot be fixed manually at the settings. it is a hardware phone name. 
  > vs code does not allow me to choose how, by which name i  want to see list of devices
  > 
  > Extension version: 3.66.0
  > VS Code version: Code 1.79.2 (695af097c7bd098fbf017ce3ac85e09bbc5dda06, 2023-06-14T08:57:04.379Z)
  > OS version: Windows_NT x64 10.0.22621
  > Modes:
  > 
  > 
  > System Info
  > 
  > |Item|Value|
  > |---|---|
  > |CPUs|12th Gen Intel(R) Core(TM) i7-12700H (20 x 2688)|
  > |GPU Status|2d_canvas: enabledcanvas_oop_rasterization: disabled_offdirect_rendering_display_compositor: disabled_off_okgpu_compositing: enabledmultiple_raster_threads: enabled_onopengl: enabled_onrasterization: enabledraw_draw: disabled_off_okvideo_decode: enabledvideo_encode: enabledvulkan: disabled_offwebgl: enabledwebgl2: enabledwebgpu: enabled|
  > |L
  > 
  > _(truncated)_




## Testing

  * [#4586](https://github.com/Dart-Code/Dart-Code/issues/4586): Test gutter icons will no longer show on the wrong lines on Windows when using functions that wrap calls to `test()` (such as Flutter’s `testWidgets`). This fix requires updating to the latest version of `package:test` for Dart projects, and will require a future Flutter SDK release for Flutter.

  > **#4586**: Test gutter icons appear in wrong lines `is bug` `in debugging` `on windows` `in testing` `relies on sdk changes`
  > **Describe the bug**
  > The gutter icons in test files appear in the wrong lines. This also affects the in-line stack trace boxes that pop up when a test fails.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. create a fresh flutter project with the cli: `flutter create new_project`
  > 2. open VSCode and open the `new_project` folder
  > 3. Go to `test/widget_test.dart`
  > 4. Make a change to make the test fail (e.g. change the `'0'` to `'1'` in line 19)
  > 5. Run the test (by clicking on the inline run button)
  > 
  > **Expected behavior**
  > The gutter icon of the test should be at line 14 where the test is defined. The test's failure stack trace should also appear there.
  > 
  > **Actual behavior**
  > Instead the gutter icon is at line 31. It is consistent across VSCode and OS restarts,
  > 
  > **Screenshots**
  > 
  > ![grafik](https://github.com/Dart-Code/Dart-Code/assets/47639380/0d254903-da22-4356-91b8-dc34ff3ad2ee)
  > 
  > ![grafik](https://github.com/Dart-Code/Dart-Code/assets/47639380/9d52b58d-305d-4966-b64
  > 
  > _(truncated)_




## Misc

  * [#4652](https://github.com/Dart-Code/Dart-Code/issues/4652): Connecting to a remote Live Share session from Windows will no longer sometimes try to analyze your local disk.

  > **#4652**: vsls:/ URIs are converted to file:/ URIs on the way to analysis server, causes issues with Live Share `is bug` `is performance` `important`
  > If you open a project in Live Share, we get a root folder of `vsls:/`, but this code here converts it to `file:///`:
  > 
  > https://github.com/Dart-Code/Dart-Code/blob/a895d3ca437bca7520e2abb9c2ce87f4220a9eb9/src/extension/analysis/analyzer_lsp.ts#L421
  > 
  > This results in the server analyzing the entire disk.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. Many are already available in the current beta channels though some are currently only available on bleeding-edge builds and will show up in future beta/stable SDK releases.

  * [#4518](https://github.com/Dart-Code/Dart-Code/issues/4518)/[#4159](https://github.com/Dart-Code/Dart-Code/issues/4159)/[#1831](https://github.com/Dart-Code/Dart-Code/issues/1831): The new **Move to File** refactoring is no longer behind an experimental flag.
  * [#4573](https://github.com/Dart-Code/Dart-Code/issues/4573): Some stack traces printed to the Debug Console will no longer try to open files using incorrect relative paths when clicking on the filename on the right side.

  > **#4573**: Location metadata on DAP output events are not absolute paths `is bug` `in debugging` `relies on sdk changes`
  > The links on the right side of the debug console here are not clickable, they are relative paths which resolve to "C:\Users\danny\AppData\Local\Programs\Microsoft VS Code\test\lsp\temporary_overlay_operation_test.dart".
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/d325ff05-4db2-4825-9900-b5183d38cfdb)
  > 
  > ```
  > [11:40:43 AM] [DAP] [Info] \n","source":{"name":"C:\\Users\\danny\\AppData\\Local\\Programs\\Microsoft VS Code\\test\\lsp\\temporary_overlay_operation_test.dart","path":"C:\\Users\\danny\\AppData\\Local\\Programs\\Microsoft VS Code\\test\\lsp\\temporary_overlay_operation_test.dart"}},"event":"output"}
  > ```

  * [#4636](https://github.com/Dart-Code/Dart-Code/issues/4636): Basic evaluation support is now available from the Debug Console when execution is not paused.

  > **#4636**: Support global evaluation in SDK DAPs `is bug` `in debugging`
  > In the old DAPs we supported some basic global evaluation using the root library and the first available isolate. We should support the same in the new SDK DAPs, but ideally use the current open file rather than the root library.

  * [#4106](https://github.com/Dart-Code/Dart-Code/issues/4106): The **Open Symbol in Workspace** search is now significantly faster for workspace with large numbers of projects.

  > **#4106**: Open Symbol in Workspace is far slower than it should be `is performance`
  > I've recently switched from using IntelliJ to VSCode as my full time Flutter editor, and the main thing I've noticed is that the searches for symbols are incredibly slow, when they work at all.
  > 
  > Often, I'll hit Ctrl-T/Cmd-T, and start typing, as I used to do with the "double-shift" from IntelliJ, and it sometimes quickly populates results for the "#" (which makes no sense, really), and then results for the first one or two letters of the search, but by the time I've completed typing the symbol I want to find, it just goes into the weeds waiting.
  > 
  > It will also sometimes just refuse to find a symbol that I know exists: if I let it sit there thinking for 5 minutes, it's still thinking (to make matters worse, I can't just go read email or something while it looks, because it closes when I click away from the window).
  > 
  > I've taken to just searching globally in the files for a symbol (Ctrl-Shift-F), and then click on a random search result, and then Ctrl-click on the symbol to go to the
  > 
  > _(truncated)_

  * [#4364](https://github.com/Dart-Code/Dart-Code/issues/4364): Code completion inside files that are `part of` libraries with a large number of files is no longer extremely slow when the results contain snippet or `@override` completions.

  > **#4364**: analyzer takes many seconds for Snippets+Overrides completions in files that are `part of` "large" libraries `in editor` `is performance` `in lsp/analysis server` `relies on sdk changes`
  > Autocomplete is much faster for me when I use the old analyzer protocol:
  > 
  > https://user-images.githubusercontent.com/6700184/214905760-7bd32cc7-9d06-4d39-a766-c75798ee380e.mp4
  > 
  > This is a proprietary codebase so unfortunately I'm not able to share it. A few things about this codebase which may be relevant:
  > 1. This is a web application which uses dart2js to compile to HTML + JS.
  > 2. This codebase is spread over ~20 packages. There is a main package which imports all the sub-packages.
  > 3. The main library has a file which imports 33 packages, including 8 from the Dart SDK. It has 49 `part` declarations for files within the repository. Most other files don't have imports, and instead use `part of` to inherit the global scope provided by the main file. Most of the other packages in this project do the same.
  > 
  > Please let me know if there is anything else I can share about this codebase.
  > 
  > I've included the info above about imports because the new analyzer protocol seems slowest when tr
  > 
  > _(truncated)_

  * [#4561](https://github.com/Dart-Code/Dart-Code/issues/4561): When the **Fix All** command (`"source.fixAll"`) is triggered automatically (for example because it was added to `"editor.codeActionsOnSave"`), removing unused imports is now excluded. If you want to remove unused imports on save, you can additionally add `"source.organizeImports"` to `"editor.codeActionsOnSave"`.

  > **#4561**: Prevent running Fix-All on-save from removing unused imports `is enhancement` `in editor` `in lsp/analysis server`
  > Placeholder for release notes, and for discoverability when this behaviour changes.
  > 
  > Before a recent SDK change, using fix-all-on-save in VS Code would also remove unused imports:
  > 
  > ```
  > "editor.codeActionsOnSave": {
  > 	"source.fixAll": true
  > }
  > ```
  > 
  > This behaviour was a little inconsistent without iterative fix-all (it would not remove the imports if other fixes were applied). Iterative fix-all made it consistent, but this behaviour is not what many users want (for example if they'd temporarily commented out code).
  > 
  > With this change, imports will not be touched when using fix-all if it was invoked automatically by save. However, it's possible to retain the original behaviour by invoked listing the original fix, or (more efficiently) `source.organizeImports`) to run on-save:
  > 
  > ```
  > "editor.codeActionsOnSave": {
  > 	"source.fixAll": true,
  > 	"source.organizeImports": true
  > }
  > ```

  * [#4576](https://github.com/Dart-Code/Dart-Code/issues/4576): The **Fix All** command now applies fixes iteratively, so if the result of applying one fix causes a warning that also has a fix, that will be resolved too.

  > **#4576**: Support iterative fixes in the LSP "Fix All" command `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Placeholder for release notes - tracking issue was at https://github.com/dart-lang/sdk/issues/47968.

  * [#4621](https://github.com/Dart-Code/Dart-Code/issues/4621): The **Convert to StatelessWidget** refactor now correctly removes instances of `widget.` inside function expressions.

  > **#4621**: "Convert to StatelessWidget" does not remove all instances of `widget.` `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Before:
  > 
  > ```dart
  > class ValueButton extends StatefulWidget {
  >   final String label;
  >   final T value;
  >   final void Function(T?) onChanged;
  > 
  >   const ValueButton(
  >       {required this.label,
  >       required this.value,
  >       required this.onChanged,
  >       super.key});
  > 
  >   @override
  >   State createState() => _ValueButtonState();
  > }
  > 
  > class _ValueButtonState extends State> {
  >   @override
  >   Widget build(BuildContext context) {
  >     return ElevatedButton(
  >         onPressed: () => widget.onChanged(widget.value),
  >         child: Text(widget.label));
  >   }
  > }
  > ```
  > 
  > After "Convert to StatelessWidget":
  > 
  > ```dart
  > class ValueButton extends StatelessWidget {
  >   final String label;
  >   final T value;
  >   final void Function(T?) onChanged;
  > 
  >   const ValueButton(
  >       {required this.label,
  >       required this.value,
  >       required this.onChanged,
  >       super.key});
  > 
  >   @override
  >   Widget build(BuildContext context) {
  >     return ElevatedButton(
  >         onPr
  > 
  > _(truncated)_

  * [#4627](https://github.com/Dart-Code/Dart-Code/issues/4627): Hovering over an identifier declared in a `for` loop variable now shows the type.

  > **#4627**: Hovering over a for loop variable does not show its type `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/21116742/2747b83d-63e9-4fa6-ac6e-539cbc4783ef
  > 
  > **Please complete the following information:**
  >  - Operating System and version: macOS
  >  - VS Code version: 1.79.2
  >  - Dart extension version: 3.66.0
  >  - Dart/Flutter SDK version: Dart SDK version: 3.1.0-163.1.beta (beta)

