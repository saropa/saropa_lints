# Dart-Code v3-72

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.72.2 _2023-09-06_

  * [#4724](https://github.com/Dart-Code/Dart-Code/issues/4724): The `package:flutter` source code from the Flutter SDK repository is no longer incorrectly detected as a plain Dart package (which would prevent running tests).

  > **#4724**: Unable to run tests with "Run" button in VSCode (but run fine from command line) `is bug` `in flutter` `in testing` `important`
  > Today (but not on Friday) I'm having trouble getting tests to run in VSCode. It is basically telling me that all the symbols in dart:ui aren't defined (Offset, Size, etc.), or the Flutter SDK isn't available.  The test runs fine from the command line, and `flutter doctor` isn't giving me anything actionable.
  > 
  > I've tried clicking the "Run" link on several tests, and they either have massive errors because of undefined symbols that are definitely defined (I can even command-click on them!), or they simply say "The Flutter SDK is not available. Exited (255)." when I click the "Run" link in VSCode.
  > 
  > By contrast, running them on the command line works fine:
  > 
  > ```
  > > cd packages/flutter
  > > flutter test test/material/page_test.dart
  > Resolving dependencies... 
  >   file 6.1.4 (7.0.0 available)
  >   material_color_utilities 0.5.0 (0.8.0 available)
  >   platform 3.1.1 (3.1.2 available)
  >   process 4.2.4 (5.0.0 available)
  >   webkit_inspection_protocol 1.2.0 (1.2.1 available)
  > Got dependencies!
  > 5 p
  > 
  > _(truncated)_




# v3.72.1 _2023-09-04_

  * [#4713](https://github.com/Dart-Code/Dart-Code/issues/4713): Extension no longer fails to activate with â€œCannot access â€˜domainRegexâ€™ before initializationâ€ when running in a workspace that provides a `remoteName`.

  > **#4713**: "Activating extension 'Dart-Code.dart-code' failed: Cannot access 'domainRegex' before initialization." `is bug` `important` `on cloud ide`
  > On IDX, the Dart extension fails to activate with this error in the logs:
  > 
  > > Activating extension 'Dart-Code.dart-code' failed: Cannot access 'domainRegex' before initialization.




# v3.72.0 _2023-09-04_

## Move to File Refactoring

[#4518](https://github.com/Dart-Code/Dart-Code/issues/4518): When using the latest Flutter release (v3.13), the Move to File refactoring is available without setting any experimental flags.

![](/images/release_notes/v3.72/move_to_file.gif)

## Improved â€œFlutter: New Projectâ€ Template Selection

[#4706](https://github.com/Dart-Code/Dart-Code/issues/4706): Project templates in the **Flutter: New Project** command have been updated to make it clearer which templates are applications and which are other project types.

  > **#4706**: Group "Application" template together better in Flutter: New Project `is enhancement` `in flutter` `in commands`
  > Skeleton should probably be with the other Application ones (and maybe have Application in the name?).
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/a4fd7b0b-50b4-4749-b905-57e70493c4b5)
  > 
  > We could also possibly add a separator to separate the application templates from the other template types.


![](/images/release_notes/v3.72/flutter_new_project.png)

## Flutter

  * [#4686](https://github.com/Dart-Code/Dart-Code/issues/4686): Cloning the Flutter SDK as part of the â€œNo SDK Foundâ€ flow no longer uses `--single-branch` which prevented using `flutter channel` to change channel.

  > **#4686**: Cloning Flutter SDK via VS Code doesn't enable non-stable branch selection `is bug` `in flutter`
  > When you clone the Flutter SDK with the flow provided in VS Code, you don't get the option to switch to channels other than stable.
  > 
  > Recommendation: Users who install the SDK through the flow offered in VS Code should have the ability to switch to all the available channels (currently master, main, beta and stable).
  > 
  > Screenshot of results in the terminal after cloning the SDK through the flow in VS Code and setting up the system's PATH environment variable (same result in VS Code's inbuilt terminal):

  * [#4685](https://github.com/Dart-Code/Dart-Code/issues/4685): Clicking the Hot Reload button on the debug toolbar will now automatically save all files before issuing the hot reload.

  > **#4685**: Automatically save files when clicking the debugger Hot Reload button `is enhancement` `in flutter` `in debugging`
  > See https://github.com/flutter/website/issues/9230

  * [#4702](https://github.com/Dart-Code/Dart-Code/issues/4702): Dart projects that reference the Flutter SDK in comments in `pubspec.yaml` no longer cause the project to be treated as a Flutter project.

  > **#4702**: Improve the check for whether a project is Flutter to be more reliable `is enhancement` `in flutter`
  > This code does a basic regex to check for `sdk: flutter` in the pubspec.yaml to decide whether a project is a Flutter project or not:
  > 
  > https://github.com/Dart-Code/Dart-Code/blob/b7c112438ba7e5c858d21c9ffa7026fdbedbe788/src/shared/utils/fs.ts#L141-L144
  > 
  > It was done this way for simplicity when we had no yaml parser referenced. It can be tripped up by comments and other unrelated keys. Now we have a yaml parser, we should do this properly so it's reliable.

  * [#4677](https://github.com/Dart-Code/Dart-Code/issues/4677): A new command `flutter.getSelectedDeviceId` is available which returns the ID of the currently selected Flutter device. This can be used in `tasks.json` to pass the device ID to external tasks.

  > **#4677**: Provide a command to get the ID of the selected device for use in tasks `is enhancement` `in flutter` `in tasks`
  > I'm trying to pass the mobile deviceId to a flutter `preLaunchTask`. Minimal sample below, but ultimately it's a `simctl` script that uses `booted` as the device id. However, this breaks down when I have multiple simulator devices booted, so I'm trying to explicitly run the preLaunch script with the target device.
  > 
  > Does someone know how to do this? I've tried almost everything I could think of with [variable substitution](https://code.visualstudio.com/docs/editor/variables-reference) and environment variables (`printenv` shows nothing useful), but I can't find any hook into `deviceId`. It should be the same parameter passed to the `-d` argument. Caveat: I can't use an explicit `deviceId` in the launch config because the config is checked in and shared with others, and we all use various versions of devices and Xcode. 
  > 
  > Can you help? :/
  > 
  > `launch.json`
  > ```json
  > {
  >   "version": "0.2.0",
  >   "configurations": [
  >     {
  >       "name": "Test My Shtuff",
  >       "type": "dart",
  >       "re
  > 
  > _(truncated)_




## Testing

  * [#4681](https://github.com/Dart-Code/Dart-Code/issues/4681): Test failures in `tearDownAll` are no longer attributed to the correct line but wrong file when `tearDownAll` is called from a file other than the one containing the test.

  > **#4681**: Test failures in tearDownAll are attributed to the correct line but wrong file `is bug` `in testing`
  > Moved from https://github.com/flutter/flutter/issues/131681. I thought this was just a request for https://github.com/dart-lang/test/issues/1851, however looking at the JSON we do get the location of the `tearDownAll` method, but we seem to record the line/col from that event in the file.
  > 
  > Here, "Go to Test" on "(tearDownAll)" is navigating to line 33 of the left file, instead of the right one. The test I ran was on line 26 of the left file.
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/8f157dd4-44ab-459c-902f-7b45a6ec9ac2)
  > 
  > The test event looks like:
  > 
  > ```js
  >  {
  > 	"test": {
  > 		"id": 5,
  > 		"name": "(tearDownAll)",
  > 		"suiteID": 0,
  > 		"groupIDs": [
  > 			2
  > 		],
  > 		"metadata": {
  > 			"skip": false,
  > 			"skipReason": null
  > 		},
  > ///////////////////////////////////////// ðŸ‘‡ This info looks correct 
  > 		"line": 33,
  > 		"column": 3,
  > 		"url": "file:///C:/Dev/Google/leak_tracker/pkgs/leak_tracker_flutter_test/test/tests/end_to_end/leak_tracking_config_test/flutter_test_con
  > 
  > _(truncated)_

  * [#4676](https://github.com/Dart-Code/Dart-Code/issues/4676): Folders excluded via `analysis_options.yaml` are now treated like those in `dart.analysisExcludedFolders`, including being excluded from the test runner. `analysis_options.yaml` is the recommended way to exclude files/folders nested inside a Dart project and `dart.analysisExcludedFolders` is recommended for excluding larger folders that are not nested inside a Dart project for performance reasons (for example to exclude `node_modules` folders from non-Dart projects in the workspace).

  > **#4676**: Folders excluded via analysis_options.yaml should be treated the same as dart.analysisExcludedFolders, including exclusion from the test runner `is enhancement` `in testing`
  > **Describe the bug**
  > 
  > The `Testing` view in vs code performs auto test discovery. For one of our projects (https://github.com/dart-lang/dart-pad/tree/main/pkgs/dart_services, the backend of dartpad), it traverses down into several (very large) subdirectories where we wouldn't want tests discovered or run from.
  > 
  > One of the local directories is `flutter-sdks/`; this contains a copy of the flutter sdk.
  > 
  > Another is `local_pub_cache/`; this contains a sub-set of a local pub cache.
  > 
  > Both directories are ignored from the POV of git (via a .gitignore) and analysis (via an analysis options file - https://github.com/dart-lang/dart-pad/blob/main/pkgs/dart_services/analysis_options.yaml#L8).
  > 
  > I suspect the issue here is that we can't just look in `test` in order to handle cases where the user has opened several packages at once). Perhaps we could stop traversing down into dirs once we see a directory w/ a pubspec? Or, we could have the traverseral algorithm respect the glob excludes from
  > 
  > _(truncated)_

  * [#4710](https://github.com/Dart-Code/Dart-Code/issues/4710): The spinner indicating a test is running should no longer sometimes persist in the gutter even after the test run completes.

  > **#4710**: Test spinner keeps running after test completes `is bug` `in testing`
  > After running this test, the spinner in the gutter remains visible (and in the wrong location, but that's for another issue).
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/1078012/cb88e476-a788-472b-9dfd-645ecfdc8b14




## Commands

  * [#4709](https://github.com/Dart-Code/Dart-Code/issues/4709): The **Get Packages** commands will no longer cause any nested `example` folders to have their packages fetched twice.

  > **#4709**: "Get Packages" commands should not include example folder implicitly `is bug` `in commands`
  > ## Description
  > With a Dart package at root, and a nested Flutter example package, running Dart Code's `pub get` command (via pubspec save) fails with error 69. See https://github.com/pattobrien/nested_package_bug to reproduce.
  > 
  > ## Steps to Reproduce
  > 
  > 1. Create a new Dart package, and in the root directory create a Flutter package named `example`.
  > 2. Save Dart package's pubspec.yaml (i.e at root) to trigger `pub get` via Dart Code (VSCode extension).
  > 
  > ## Observed Result
  > 
  > ```bash
  > [nested_package_bug] dart pub get
  > Resolving dependencies...
  > Got dependencies!
  > Resolving dependencies in ./example...
  > Because example depends on flutter_test from sdk which doesn't exist (the Flutter SDK is not available), version solving failed.
  > 
  > Flutter users should run `flutter pub get` instead of `dart pub get`.
  > exit code 69
  > ```
  > 
  > ## Additional Info
  > 
  > Dart Code extension v3.70.0
  > 
  > ```bash
  > Doctor summary (to see all details, run flutter doctor -v):
  > [âœ“] Flutter (Channel stable, 3.13.0, o
  > 
  > _(truncated)_

  * [#4708](https://github.com/Dart-Code/Dart-Code/issues/4708): When using the SDK switcher, paths written into `dart.sdkPath` and `dart.flutterSdkPath` will now use `~` and forward slashes when the path is inside your home directory to help share config between teams (if they agree to store versioned SDKs in the same location).

  > **#4708**: Write home-dir-relative paths into dart.sdkPath and dart.flutterSdkPath when switching SDKs `is enhancement` `in commands`
  > See https://github.com/Dart-Code/Dart-Code/issues/4703. This makes it a little easier to commit these if a team has agreed to put their SDKs somewhere off their home dir.

  * [#4698](https://github.com/Dart-Code/Dart-Code/issues/4698): A new command **Dart: Copy VM Service URI to Clipboard** will copy the VM Service URI of the current debug session to the clipboard.

  > **#4698**: Add a command to copy the current debug sessions VM Service URL to the clipboard `is enhancement` `in commands`
  > See https://github.com/flutter/flutter/issues/114039#issuecomment-1686848563

  * [#4697](https://github.com/Dart-Code/Dart-Code/issues/4697): The **Dart: Open Observatory** command is now marked as deprecated and will be removed in a future update once removed from the SDK.

  > **#4697**: Visibly mark Observatory command(s) as deprecated `in commands`
  > The Observatory command shouldn't be removed yet because some users are still using this. After we have a version number for complete removal, we can remov eit (https://github.com/Dart-Code/Dart-Code/issues/4696). For now, we should show "Deprecated" in the name so it's clearer to users that they should be moving away from this.




## Editor

  * [#4701](https://github.com/Dart-Code/Dart-Code/issues/4701): Searching the Workspace Symbols list has been fixed when using the legacy analyzer protocol (`dart.useLegacyAnalyzerProtocol`). The legacy protocol is not recommended (and will eventually be removed) - if you feel you need to use it please [file an issue](https://github.com/Dart-Code/Dart-Code/issues) with the details.

  > **#4701**: Workspace Symbols no longer works over legacy protocol `is bug` `in editor`
  > Probably as a result of https://github.com/dart-lang/sdk/commit/34a21f5691160c58a593d02ed73c888059d696de, the workspace symbol search doesn't work when LSP is disabled because it's not longer expected a regex.

  * [#4631](https://github.com/Dart-Code/Dart-Code/issues/4631): The error â€œLanguageStatusItem with id â€˜dart.analysisServerâ€™ ALREADY existsâ€ will no longer appear in the console sometimes when using the legacy analyzer protocol.

  > **#4631**: Error: LanguageStatusItem with id 'dart.analysisServer' ALREADY exists `is bug` `in editor`
  > I see this sometimes when running from source, modifying the `dart.sdkPath` setting making it valid/invalid. This error is possibly preventing the extension from activating correctly.

  * [#4583](https://github.com/Dart-Code/Dart-Code/issues/4583): A recent VS Code update prevented imports from being added automatically when completing code in `part` files. This change was reverted and these imports should work again.

  > **#4583**: Imports not being added automatically from code completion in part files `is bug` `blocked on vs code / lsp / dap` `in editor`
  > There's a test failing and I can repro this locally. Accepting `ProcessResult` here should auto-import `dart:io` into the part_wrapper file:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/0232e619-9074-42ff-ae97-77111072dbfe)
  > 
  > The import is never added. The resolved completion includes a `"command": "edit.sendWorkspaceEdit"`:
  > 
  > ```
  > {
  > 	"id": : 20,
  > 	"jsonrpc": : "2.0",
  > 	"result": : {
  > 		"additionalTextEdits": : [],
  > 		"command": : {
  > 			"arguments": : [
  > 				{
  > 					"edit": : {
  > 						"documentChanges": : [
  > 							{
  > 								"edits": : [
  > 									{
  > 										"newText": : "import 'dart::io';\n\n",
  > 										"range": : {
  > 											"end": : {
  > 												"character": : 0,
  > 												"line": : 0
  > 											},
  > 											"start": : {
  > 												"character": : 0,
  > 												"line": : 0
  > 											}
  > 										}
  > 									}
  > 								],
  > 								"textDocument": : {
  > 									"uri": : "file::///C::/Dev/Test%20Projects/test_failure_import_part/lib/part_wra
  > 
  > _(truncated)_




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. Many are already available in the current beta channels though some are currently only available on bleeding-edge builds and will show up in future beta/stable SDK releases.

  * [#4640](https://github.com/Dart-Code/Dart-Code/issues/4640): Hovering over a wildcard pattern now shows its static type.

  > **#4640**: Hovering over a wildcard pattern does not show its type `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/21116742/60ec21f4-658b-4df2-be2e-0136c5b7994f
  > 
  > **Please complete the following information:**
  >  - Operating System and version: macOS
  >  - VS Code version: 1.80.0
  >  - Dart extension version: v3.68.1
  >  - Dart/Flutter SDK version: Dart SDK version: 3.1.0-163.1.beta

  * [#2462](https://github.com/Dart-Code/Dart-Code/issues/2462): Code completion now shows the signatures/return types for all items and not only the selected item.

  > **#2462**: Always show return type/signature for all items in code completion `is enhancement` `in editor` `in lsp/analysis server`
  > Is it possible to show return type of a method in intellisense (or a complete method signature)?
  > 
  > Sometimes, it is much useful when we have a large number of methods available. And to pick one quickly, this will help much.
  > 
  > For example, in Android Studio, it shows like this:
  > ![Screenshot 2020-05-16 at 7 57 32 PM](https://user-images.githubusercontent.com/45350182/82122173-98fcd980-97af-11ea-819c-83876dbbabed.png)

  * [#4598](https://github.com/Dart-Code/Dart-Code/issues/4598): Breakpoints should no longer sometimes disappear when adding/removing breakpoints when there are multiple isolates running.

  > **#4598**: Breakpoints disappear `is bug` `in debugging` `awaiting info`
  > **Describe the bug**
  > Adding breakpoints causes some of the existing breakpoints to disappear.
  > I mean, I like arcades, but this feels too much ðŸ˜‚.
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/21116742/6ead370a-b93a-44e8-82ca-8c1fdbe38673
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Run a test with a breakpoint
  > 2. When the tests stops at the breakpoint, try add new breakpoints
  > 
  > **Please complete the following information:**
  >  - Operating System and version: MacOS 12.6
  >  - VS Code version: 1.79.2
  >  - Dart extension version: 3.66.0
  >  - Dart/Flutter SDK version: Dart SDK version: 3.1.0-63.1.beta (beta)

  * [#4668](https://github.com/Dart-Code/Dart-Code/issues/4668): `Find All References` now works correctly on class declarations.

  > **#4668**: `Find All References` doesn't work with class declaration `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Given this class
  > 
  > ```dart
  > class ProfileItem extends StatelessWidget {
  >   const ProfileItem({
  >     Key? key,
  >   }) : super(key: key);
  > }
  > ```
  > 
  > (and assuming that the class is used throughout my project,) if I select `ProfileItem` on the first line and then right-click and choose "Find All References", nothing is found. If I select `ProfileItem` on the second line (in the constructor definition) and then right-click and choose "Find All References", dart-code is able to find numerous references to the class.
  > 
  > **To Reproduce**
  > As above.
  > 
  > **Expected behavior**
  > 
  > Any reference to `ProfileItem` should correctly find all references. The syntax highlighter does highlight both references when I click on one of them.
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Linux
  >  - VS Code version: latest
  >  - Dart extension version: latest
  >  - Dart/Flutter SDK version: latest
  >  - Target device (if the issue relates to Flutter debuggi
  > 
  > _(truncated)_

  * [#4655](https://github.com/Dart-Code/Dart-Code/issues/4655): When using `editor.codeActionsOnSave` to run `source.fixAll`, unused parameters will no longer be removed. They will still be removed if you invoke the **Fix All** command explicitly.

  > **#4655**: Please don't remove unused parameters from function definitions on Save `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Create this class:
  > 
  > ```dart
  > class _MyClass {
  >   int? param;
  >   _MyClass({
  >     this.param,
  >   });
  > }
  > ```
  > 
  > Now hit save. You get:
  > 
  > ```dart
  > class _MyClass {
  >   int? param;
  >   _MyClass();
  > }
  > ```
  > 
  > `this.param` is removed automatically, because it is (as yet) unused.
  > 
  > This is not good default behavior. (Or maybe I accidentally enabled it in my settings, but it's not good behavior in general.)
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Linux
  >  - VS Code version: code-1.80.1-1689183644.el7.x86_64
  >  - Dart extension version:
  >  - Dart/Flutter SDK version: 3.0.6
  >  - Target device (if the issue relates to Flutter debugging):

  * [#4635](https://github.com/Dart-Code/Dart-Code/issues/4635): The `switch expression` snippet no longer shows up when completing named arguments.

  > **#4635**: switch expression snippet shows up in odd places `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/d87a98d5-e39c-4bd4-b5a1-f89009686a70)

  * [#4619](https://github.com/Dart-Code/Dart-Code/issues/4619): **Go to Definition** now works when you have a selection that ends at the start of a set of type arguments.

  > **#4619**: Go to Definition doesn't work with a selection `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > I thought this had come up before and been fixed, but I can't find any evidence of that. Ctrl+Click and F12 work fine on this symbol, but not if the entire thing is selected:
  > 
  > ![Screenshot 2023-06-29 151333](https://github.com/Dart-Code/Dart-Code/assets/1078012/bd35d7fb-f182-4957-9ccd-a8641140aa51)

  * [#4564](https://github.com/Dart-Code/Dart-Code/issues/4564): **Extract Method** now correctly marks functions extracted from function expressions in static fields as `static`.

  > **#4564**: `Extract Method` extracts to non-static method in static context `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > Given a method 
  > ```dart
  > static String test = getNameBy((v) => v.toString());
  > ```
  > when calling `Extract Method` on the inner lambda, it extracts to 
  > ```
  > static String test = getNameBy(newMethod);
  > String newMethod(v) => v.toString();
  > ```
  > which then gives the `implicit_this_reference_in_initializer` error. It should instead extract to
  > ```
  > static String test = getNameBy(newMethod);
  > static String newMethod(v) => v.toString();
  > ```
  > 
  > **Please complete the following information:**
  > Dart SDK version: 3.1.0-39.0.dev (dev) (Mon Apr 24 18:53:55 2023 -0700) on "linux_x64"
  > 
  > Version: 1.78.0
  > Commit: 252e5463d60e63238250799aef7375787f68b4ee
  > Date: 2023-05-03T20:09:46.685Z
  > Electron: 22.4.8
  > Chromium: 108.0.5359.215
  > Node.js: 16.17.1
  > V8: 10.8.168.25-electron.0
  > OS: Linux x64 6.1.20-2rodete1-amd64
  > Sandboxed: No
  > 
  > Dart-Code v3.65.20230520 Pre-Release

