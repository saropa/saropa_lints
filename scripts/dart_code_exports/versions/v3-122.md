# Dart-Code v3-122

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.122.0 _2025-10-30_

## Flutter

  * [#5749](https://github.com/Dart-Code/Dart-Code/issues/5749): Important Flutter app warnings emitted by the Flutter tool are now surfaced directly as VS Code warning toast notifications.

  > **#5749**: Add support for showing app warnings from Flutter `is enhancement` `in flutter` `in debugging`
  > Starting with the slow iOS wireless debugging warning.
  > 
  > Fixes https://github.com/Dart-Code/Dart-Code/issues/5730

  * [#5744](https://github.com/Dart-Code/Dart-Code/issues/5744): The Flutter Widget Preview sidebar icon now appears after extension activation instead of only after the widget preview server initialises.

  > **#5744**: Widget preview sidebar icon doesn't appear until after server has started `is bug` `in flutter` `in flutter widget preview`
  > There's a long delay before this icon shows up, but it should show up immediately and just have some kind of spinner/loading progress bar.




## Commands

  * [#5549](https://github.com/Dart-Code/Dart-Code/issues/5549)[#5760](https://github.com/Dart-Code/Dart-Code/issues/5760): The **Pub Get** command now refreshes timestamps of both `pubspec.lock` and `package_config.json` preventing false notifications that the command needs running again when opening a project.

  > **#5549**: New Version always displays notification to perform unnecessary Run 'pub get' `is bug` `in commands`
  > **Describe the bug**
  > Each time I open a Flutter project, the extension always displays a pop up notification that says, "Some packages are mission or out of date, would you like to get them now? Button: "Run 'pub get'". Even if I run flutter pub get command, then close VSCode, and then reopen the project, this pop up appears on project open, but shouldn't
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Open VSCode
  > 2. Using menu, open a recent project.
  > 
  > **Expected behavior**
  > No pop up notification if the project is actually up to date.
  > 
  > **Screenshots**
  > [Pop Up Notification](https://raw.githubusercontent.com/longtimedeveloper/puzzle_images/refs/heads/main/bug.JPG)
  > 
  > **Please complete the following information:**
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.112.0
  > Flutter extension: 3.112.0 (not activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: win 1.100.3
  > 
  > Workspace type: Dart (LSP)
  > Workspace name: rock_shared
  > 
  > _(truncated)_

  * [#5740](https://github.com/Dart-Code/Dart-Code/issues/5740)/[#5746](https://github.com/Dart-Code/Dart-Code/issues/5746): Progress notifications when running the **Pub Get** command for multiple packages in a batch are now combined into a single notification that updates with the package names, instead of flickering individual notifications.

  > **#5740**: Don't show a separate notification for every package when the `pub get`/`pub upgrade` prompts trigger many invocations `is enhancement` `in commands`
  > **Describe the bug**
  > 
  > https://github.com/user-attachments/assets/9197496d-f520-4178-910d-2b551ee2a7a4
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. open flutter/packages/packages in vscode 
  > 2. click `pub upgrade` 
  > 3. See a notification appear for every package as it upgrades. 
  > 
  > **Expected behavior**
  > Any of the following design patterns 
  > * One notification the whole time
  > * One notification the whole time with progress bar or text 
  > * One notification at the end
  > * No notification 
  > 
  > **Please complete the following information:**
  > 
  > You can run the **Dart: Collect Diagnostic Information** command from the VS Code command palette (`F1`) to easily capture this information or provide it manually.
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.120.0
  > Flutter extension: 3.120.0 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: mac 1.104.3
  > 
  > Workspace type: Dart, Flutter (LSP)
  > Workspace name: packages
  > 
  > _(truncated)_

  * [#5745](https://github.com/Dart-Code/Dart-Code/issues/5745)/[#5746](https://github.com/Dart-Code/Dart-Code/issues/5746): When the **Pub Get** command is being run for multiple packages in a batch, a single cancellation will cancel the entire batch instead of only the current project.

  > **#5745**: Cannot cancel a batch of "pub get" / "pub upgrade" / "flutter clean" commands `is bug` `in commands`
  > Slightly related to #5740 - if you try to cancel the "pub get" when it's running for all projects, it only cancels the one and then continues with the next.
  > 
  > We should fix things in a way that let you cancel the overall job.




## AI

  * [#5733](https://github.com/Dart-Code/Dart-Code/issues/5733): Registration of the MCP server no longer forces the Dart extension to eargerly activate in non-Dart workspaces.

  > **#5733**: Dart extension is always activated in new workspaces due to MCP registration `is bug` `in ai`
  > Once https://github.com/microsoft/vscode/issues/266221 lands, we need to add `when` clauses to both MCP + lm tool, and also re-enable this test:
  > 
  > https://github.com/Dart-Code/Dart-Code/commit/77a62cc4d555cd4947e8eb269e2025a2ff56b2a2

  * [#5767](https://github.com/Dart-Code/Dart-Code/issues/5767): When running inside Cursor (which [does not support automatic MCP registration](https://forum.cursor.com/t/support-vs-codes-register-mcp-server-definition-provider-api/133031)), a prompt is shown to help install the Dart MCP Server explicitly.

  > **#5767**: Prompt to install the MCP server in Cursor `is enhancement` `in ai`
  > Since Cursor doesn't support the VS Code MCP APIs ([requested here](https://forum.cursor.com/t/support-vs-codes-register-mcp-server-definition-provider-api/133031/3)), MCP servers must be registered explicitly.
  > 
  > We should detect when running in cursor and show a prompt that just triggers the URL from the button at https://github.com/dart-lang/ai/tree/main/pkgs/dart_mcp_server#cursor
  > 
  > See:
  > 
  > - https://github.com/dart-lang/ai/issues/273
  > - https://github.com/dart-lang/ai/issues/273#issuecomment-3270943769
  > - https://github.com/dart-lang/ai/issues/273#issuecomment-3451884632




## Testing

  * [#5620](https://github.com/Dart-Code/Dart-Code/issues/5620): The `dart.suppressTimeouts` setting now works correctly when used inside Pub Workspaces.

  > **#5620**: Timeouts are not ignored when debugging tests inside Pub Workspaces `is bug` `in testing`
  > **Describe the bug**
  > When running SDK tests, I constantly see test timeout exceptions when debugging them.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Go to any `test_reflective_loader` test like `pkg/analysis_server/test/src/services/correction/fix/remove_async_test.dart`
  > 2. Add:
  > 
  > ```dart
  > @Timeout(Duration(seconds: 5))
  > library;
  > import 'package:test/test.dart';
  > 
  > //...
  > 
  > @reflectiveTest
  > class RemoveAsyncIllegalReturnTest extends FixProcessorTest {
  >   @override
  >   FixKind get kind => DartFixKind.REMOVE_ASYNC;
  > 
  >   @soloTest
  >   void test_a() {
  >     print(''); // B1
  >     print(''); // B2
  >   }
  > 
  >   @soloTest
  >   Future test_b() async {
  >     print(''); // B3
  >     await Future.delayed(Duration.zero);
  >     print(''); // B4
  >   }
  > //...
  > ```
  > 
  > 3. Run the test and wait more than five seconds between `B1` and `B2`, see no problems
  > 4. Run the test and wait more than five seconds between `B3` and `B4`, see timeout
  > 
  > **Expected behavior**
  > Test timeout should be disabled when the debugger is running.
  > 
  > _(truncated)_

  * [#5763](https://github.com/Dart-Code/Dart-Code/issues/5763): The `dart.suppressTimeouts` setting now defaults to `debug`, which prevents test timeouts from firing when running in Debug mode.

  > **#5763**: Change the default of the `dart.suppressTimeouts` setting to `debug` `is enhancement` `in debugging` `in testing`
  > See https://github.com/Dart-Code/Dart-Code/issues/5620#issuecomment-3437643910
  > 
  > (cc @FMorschel)

  * [#5668](https://github.com/Dart-Code/Dart-Code/issues/5668): The new test location tracking is now enabled by default and should improve the locations in the test explorer and gutter icons when using packages like `test_reflective_loader` that register tests dynamically.

  > **#5668**: SDK tests with `test_reflective_loader` get out of sync with gutter icons if new tests are added after running once `is bug` `in testing`
  > **Describe the bug**
  > When working with the SDK and `test_reflective_loader` tests, adding a new test after running the suite makes some tests get out of sync with the gutter.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Open `pkg/linter/test/rules/prefer_initializing_formals_test.dart` (or whatever test file with it)
  > 2. Run the tests
  > 3. Add `test_a() {}` above all other tests
  > 4. Run again, see the test below it get out of sync with the test gutter
  > 
  > **Expected behavior**
  > For the tests to have different gutter icons.
  > 
  > **Screenshots**
  > 
  > **Please complete the following information:**
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.117.20250813
  > Flutter extension: 3.117.20250731 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: win 1.103.2
  > 
  > Workspace type: Dart (LSP) (Multiroot)
  > Workspace name: sdk (Workspace)
  > 
  > _(truncated)_

  * [#5738](https://github.com/Dart-Code/Dart-Code/issues/5738): The new test location tracking now monitors groups in addition to tests to ensure group nodes also stay in-sync in the test explorer/gutter.

  > **#5738**: New `experimentalTestTracking` only tracks tests, not groups `is bug` `in testing`
  > While looking into https://github.com/Dart-Code/Dart-Code/issues/5734 I noticed that we only have a tracker on `TestNode` and not `GroupNode`. This means we're probably not tracking groups (eg. classes in test_reflective_loader) correctly.
  > 
  > When we add these, we need to ensure they are untracked during deletion (as was a bug with tests in that issue).

  * [#5734](https://github.com/Dart-Code/Dart-Code/issues/5734): The new test location tracking no longer causes test locations to snap back to previous locations during edits.

  > **#5734**: Stale test markers for dynamic tests come back when using `experimentalTestTracking` and modifying the test `is bug` `in testing`
  > **Describe the behaviour**
  > With the new `experimentalTestTracking` set to `true`, I see a weird behaviour in `test_reflective_loader` test files once I've tried running a debug session that did not complete any tests.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Go to `pkg/analysis_server/lib/src/services/correction/dart/add_digit_separators.dart`
  > 2. Add a breakpoint at the first line inside `_AddDigitSeparators.compute` (at the time of writing is 69)
  > 3. Go to `pkg/analysis_server/test/src/services/correction/assist/add_digit_separators_test.dart`
  > 4. Disable that breakpoint on the breakpoints tab temporarily
  > 5. Run the full test file
  > 6. Enable the breakpoint and run the tests
  > 7. Once it breaks, stop the debugging session
  > 8. Go back to the test file and see no gutter icons
  > 9. Add a new line or something like that (some change, I think even whitespaces might do) and see the gutter icons show up
  > 10. Removing that change will make them go away
  > 11. Saving the file (even if you dele
  > 
  > _(truncated)_




## Misc

  * [#5747](https://github.com/Dart-Code/Dart-Code/issues/5747): Issue templates on GitHub have been updated to make it clearer that the Dart-Code issue tracker is used for both the Dart and Flutter extensions.

  > **#5747**: Wish for a "new issue" template that is clearly marked for "Flutter extension" `is enhancement` `in docs / website`
  > The Flutter extension issues are to be filed here in the Dart-code/dart-code repo's issue tracker. Which is fine, but just a little confusing. Some folks might end up on dart-code/dart-code looking to file an issue on the flutter extension and wonder if they made a wrong turn :)
  > 
  > Suggestion:
  > 
  > Create an explicit "Flutter extension" template which appears when you click "New issue". That way, it's clear that this is the right place to file an issue on the Flutter extension.
  > 
  > Thanks for considering!

  * [#5648](https://github.com/Dart-Code/Dart-Code/issues/5648): E2E tests have been expanded to include testing of the new Widget Preview.

  > **#5648**: Add some E2E tests for embedded Widget Preview `in flutter` `is testing` `in flutter widget preview`
  > It's difficult to test this within the APIs, so it may be better to have some basic tests for this in https://github.com/Dart-Code/E2E-Tests.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They may be available to test in the current beta/master channels and will show up in future SDK releases.

  * [#5717](https://github.com/Dart-Code/Dart-Code/issues/5717): The Flutter Widget Preview will no longer require an experiment flag to appear (this currently applies to the latest beta, and will apply to the next stable).

  > **#5717**: Remove requirement for experiment flag for Widget Preview gated on Flutter version with important fixes `is enhancement` `in flutter` `relies on sdk changes` `in flutter widget preview`
  > Currently we only show the widget preview if `dart.experimentalFlutterWidgetPreview` is set _and_ `flutterCapabilities.supportsWidgetPreview` (Flutter SDK is >= 3.36.0-1).
  > 
  > We should remove the requirement for the experiment flag for a version of the SDK that has all the fixes we think are necessary before showing this by default (by implementing a new capability `flutterCapabilities.supportsWidgetPreviewByDefault`).
  > 
  > I think https://github.com/flutter/flutter/pull/175783 is the most significant fix, so we could gate it on the version that lands in, which would mean any subsequent beta branch would have it enabled by default (@bkonyi - does this seem good to you, or are there any other changes/fixes you think we should require?).
  > 
  > (fyi @jwren @anderdobo)

  * [#5759](https://github.com/Dart-Code/Dart-Code/issues/5759): Exceptions shown in the Watch window once again show only the relevant part of the error message instead of prefixes like “Unhandled exception:”

  > **#5759**: Exceptions in Watch window are not correctly reduced to the relevant part `is bug` `in debugging`
  > We have some failing tests against beta because of this.. We used to strip out the important part of an error so this message was useful, but now it just shows this:

  * [#5761](https://github.com/Dart-Code/Dart-Code/issues/5761): Changes to `package:reflective_test_loader` prevent `@FailingTest()` from causing timeouts if the test passes unexpectedly.

  > **#5761**: `@FailingTest()` annotation on `test_reflective_loader` test timeouts but fails faster without it `is bug` `in testing` `relies on sdk changes`
  > **Describe the bug**
  > Adding `@FailingTest()` to a failing `test_reflective_loader` test makes us hit a timeout (which could go away if we land https://github.com/Dart-Code/Dart-Code/issues/5620).
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Clone https://dart-review.googlesource.com/c/sdk/+/456020 patchset 1
  > 2. Run the tests at `pkg/analysis_server/test/lsp/document_highlights_test.dart`
  > 3. See it gets stuck and times out (be sure you get a timeout, note the above issue I mentioned)
  > 
  > **Expected behavior**
  > For it to pass normally without a timeout as a _success_ since it does fail.
  > 
  > **Screenshots**
  > 
  > https://github.com/user-attachments/assets/c49cc01f-887e-4c2f-88a6-88f7a09a86fa
  > 
  > **Please complete the following information:**
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.121.20250930
  > Flutter extension: 3.121.20250930 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: win 1.105.1
  > 
  > Workspace type: Dart (LSP) (Multiroot)
  > Workspace name: sdk (Workspace)
  > 
  > _(truncated)_

  * [#5750](https://github.com/Dart-Code/Dart-Code/issues/5750): Nested folding ranges that end on the same line are no longer incorrectly truncated.

  > **#5750**: When nested folding ranges end on the same line, the outer range is incorrectly truncated `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > Switch case folding doesn't fold until the next `case` if a function has parameters that span multiple lines (I think that is the issue, but maybe something similar at least?).
  > 
  > **To Reproduce**
  > Add a file with this sample:
  > 
  > ```dart
  > Future f() async {
  >   switch (1) {
  >     case 1:
  >       print('something');
  > 
  >       someBigFunctionName(
  >         someReallyReallyLongNameHereSoItHasToSplit: 1234567,
  >       );
  >     case 2:
  >       print('another thing');
  >       print('yet another thing');
  >     case 3:
  >       print('more things');
  >   }
  > }
  > 
  > void someBigFunctionName({
  >   int? someReallyReallyLongNameHereSoItHasToSplit,
  > }) {}
  > ```
  > 
  > Try to fold at `case 1` and see that it doesn't fold `someBigFunctionName`.
  > 
  > **Expected behavior**
  > It folds `someBigFunctionName`.
  > 
  > **Please complete the following information:**
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.121.20250930
  > Flutter extension: 3.121.20250930 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: win 1.105.0
  > 
  > _(truncated)_

  * [#5730](https://github.com/Dart-Code/Dart-Code/issues/5730): When using WiFi debugging wioth versions of iOS known to be slow, a warning will be shown.

  > **#5730**: Wish to inform the user to prefer USB over WiFi when developing against an iOS 26 device `is enhancement` `in flutter` `in debugging` `relies on sdk changes`
  > Related to https://github.com/flutter/flutter/issues/176206
  > 
  > We propose to inform the user that if they are running against an iOS 26 device and connected over WiFi, that we suggest to the user to instead connect their device via USB.

  * [#5724](https://github.com/Dart-Code/Dart-Code/issues/5724): The `--timeline_streams` flag will be automatically set when debugging Dart applications so that the same events show up in the DevTools Performance as for Flutter apps.

  > **#5724**: Enable `--timeline_streams` when running debug from IDE button `is enhancement` `in debugging` `relies on sdk changes`
  > Steps to reproduce
  > 
  > Actual result:
  > 
  > Expected result:
  > 
  > * Timeline events show up.
  > 
  > Hypothesis:
  > 
  > * The `run` in the IDE doesn't run with `--observe`.
  > 
  > Side node, if you run the debugger by hand you can add the `--observe`:
  > 
  > ```json
  > 	"launch": {
  > 		"version": "0.2.0",
  > 		"configurations": [
  > 			{
  > 				"name": "Dart",
  > 				"type": "dart",
  > 				"request": "launch",
  > 				"vmAdditionalArgs": [
  > 					"--observe"
  > 				],
  > 				"program": "pkgs/hooks_runner/test/build_runner/build_runner_test.dart",
  > 			}
  > 		],
  > 		"compounds": []
  > 	}
  > ```
  > 
  > (repro from a checkout of https://github.com/dart-lang/native)
  > 
  > cc @elliette @DanTup

