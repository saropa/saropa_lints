# Dart-Code v3-68

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.68.1 _2023-07-04_

  * [#4625](https://github.com/Dart-Code/Dart-Code/issues/4625): The new warning about invalid SDK paths in config will no longer appear when your SDK is a symbolic link.

  > **#4625**: dart.flutterSdkPath is not a valid SDK folder when following symlink `is bug` `in editor`
  > **Describe the bug**
  > Warning "The SDK configured in dart.flutterSdkPath is not a valid SDK folder." appears when SDK configured via symlink: fvm as example. 
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Set dart.flutterSdkPath to ".fvm/flutter_sdk"
  > 
  > **Expected behavior**
  > Should not appear
  > 
  > **Screenshots**
  > ![Снимок экрана 2023-07-04 в 03 01 10](https://github.com/Dart-Code/Dart-Code/assets/136765139/993d6dd0-970d-4761-bcdf-57194c8e8ef6)
  > 
  > **Please complete the following information:**
  >  - Operating System and version: macOS Ventura 13.3.1 (a)
  >  - VS Code version: 1.79.2
  >  - Dart extension version: v3.68.0
  >  - Dart/Flutter SDK version: 3.10.5




# v3.68.0 _2023-07-03_

## Automatically Clone Flutter SDK

[#4532](https://github.com/Dart-Code/Dart-Code/issues/4532): When no suitable Flutter SDK is found, the “Download SDK” button will now attempt to use Git to clone an SDK before launching the Download page from the Flutter website. You will be prompted for a location to download the SDK to and the path will automatically be written into the `dart.flutterSdkPath` setting.

  > **#4532**: Offer to "git clone" the Flutter repo to a location of users choice if no SDK is found (and "git" is available) `is enhancement` `in flutter`
  > Splitting from #226 since Dart/Flutter would be different paths.
  > 
  > Currently if we don't find a Flutter SDK, we show a prompt to the user with a "Locate SDK" button that lets them browse (using a file picker) to where they have downloaded it. We validate this is an SDK and write it into the `dart.flutterSdkPath` setting.
  > 
  > We could consider adding an additional button to this prompt "Download SDK" that will ask the user (via a file picker) where they'd like to download it, and we can just "git clone" it for them, set the `dart.flutterSdkPath` setting, and run the **Flutter: Run Flutter Doctor** command at the end.
  > 
  > If we can't find `git` we could link them to a page on the website telling them to get `git` first.
  > 
  > @polina-c


![](/images/release_notes/v3.68/clone_flutter_sdk.gif)

## Add Dart/Flutter SDK to PATH Environment Variable

[#4604](https://github.com/Dart-Code/Dart-Code/issues/4604): New commands **Add Dart SDK to PATH** / **Add Flutter SDK to PATH** will attempt to add your current SDK to the PATH environment variable automatically. This is currently only supported on Windows, but other platforms will provide a link to additional information. You’ll be prompted for this automatically if you use the Clone Flutter SDK flow noted above.

  > **#4604**: Add a command to "Add SDK to Path" and offer to invoke it automatically after downloading an SDK [Windows] `is enhancement` `on windows` `in commands`
  > [go/setup-path-with-flutter-extension](https://goto.google.com/setup-path-with-flutter-extension)
  > 
  > - [x] Get URL to open instructions on Flutter website
  > - [x] Offer this flow after cloning SDK


![](/images/release_notes/v3.68/add_sdk_to_path.png)

## Editor

  * [#4615](https://github.com/Dart-Code/Dart-Code/issues/4615): The textmate grammar for basic syntax highlighting has been updated to v1.2.2.

  > **#4615**: Update textmate grammar for extension types `is enhancement` `in editor`
  > After https://github.com/dart-lang/dart-syntax-highlight/pull/41 lands, we should update it here.

  * [#4384](https://github.com/Dart-Code/Dart-Code/issues/4384): Test icons in the gutter are no longer duplicated when pressing `<enter>` in the first line of a test definition.

  > **#4384**: Test status indicator is duplicated `is bug` `in editor` `in testing`
  > **Describe the bug**
  > Noticed that the test status indicator (play button or spinner) got duplicated for the whole line length of the test.
  > 
  > **To Reproduce**
  > No steps. This is a new test file and I noticed that it's too much of the visual noise.
  > 
  > **Expected behavior**
  > Only one indicator.
  > 
  > **Screenshots**
  > 
  > 
  > https://user-images.githubusercontent.com/21116742/218462875-3a10062e-ade6-42a3-83c7-b535e246f00e.mov
  > 
  > **Please complete the following information:**
  >  - Operating System and version: macOS 12.6
  >  - VS Code version: 1.75.1
  >  - Dart extension version: 3.58
  >  - Dart/Flutter SDK version: Dart SDK version: 2.19.0 (stable) (Mon Jan 23 11:29:09 2023 -0800) on "macos_x64"
  >  - Target device (if the issue relates to Flutter debugging): -

  * [#4608](https://github.com/Dart-Code/Dart-Code/issues/4608): A warning will now be shown if `dart.sdkPath`/`dart.flutterSdkPath` are configured but do not resolve to a valid SDK.

  > **#4608**: Warn user when an invalid `dart.flutterSdkPath` is provided `is enhancement` `in editor`
  > **Is your feature request related to a problem? Please describe.**
  > As a developer, I tried to override the "dart.flutterSdkPath" in my `settings.json` and was setting it to `~Development/github.com/flutter/flutter/bin/flutter` but the extension expects: `~Development/github.com/flutter/flutter`.
  > 
  > **Describe the solution you'd like**
  > I would expect an error dialog to alert me when my "dart.flutterSdkPath" is invalid and therefore ignored.
  > 
  > **Additional context**
  > Related to #4607




## Commands

  * [#4606](https://github.com/Dart-Code/Dart-Code/issues/4606): The **Dart: New Project** and **Flutter: New Project** input boxes no longer close automatically if focus is lost. This allows you to tab away (for example to copy/paste values) without having to start over. Pressing `<escape>` will still cancel project creation.

  > **#4606**: Keep "new project" input boxes open even if focus is lost `is enhancement` `in commands`
  > I'm often starting to create a new project, then tabbing away to find the project name (I often create projects with GH issue numbers in). Currently the New Project input boxes close upon losing focus. There's probably no good reason not to have them persist and require Escape to close them.

  * [#4581](https://github.com/Dart-Code/Dart-Code/issues/4581): Folders that contain `__` or `\{\{` are now excluded from automatic `pub get` checks, since these are often template directories and not valid projects.

  > **#4581**: feat: provide option to exclude path for "run pub get" on outdated packages `is enhancement` `in commands`
  > **Is your feature request related to a problem? Please describe.**
  > When opening VS Code in a multi-package workspace, I **do not** want the message
  > 
  > > Some packages are missing or out of date, would you like to get them now?
  > 
  > to appear for a specified path or glob.
  > 
  > **Additional context**
  > I use `mason` for generating dart packages in my workspace, but the package template is in the workspace so it is evaluated in the check for 
  > 
  > ```
  > [ ... ] [General] [Info] Found 1 folders requiring "pub get" or "pub upgrade":
  > ````
  >  But this is an issue since the package template itself is an invalid dart package. It might include characters like `{`, `}`, `(`, and `)` in the `pubspec.yaml`'s `name`and in the package's path.
  > 
  > In my project I would specifically like the ability to exclude a glob like `bricks/*/__brick__/**` to align with my analysis file.




## Testing

  * [#4602](https://github.com/Dart-Code/Dart-Code/issues/4602): Formatting of Flutter error messages in the Test Error popup has been fixed.

  > **#4602**: Formatting of test report is broken `is bug` `in testing`
  > Type: Bug
  > 
  > Currently the formatting of the test report popup is broken. The line does not start on the left, but in the middle.
  > 
  > I've created this issue in the VSCode repo, but it seems to be an issue of the Flutter extension: https://github.com/microsoft/vscode/issues/185778
  > 
  > 
  > 
  > VS Code version: Code - Insiders 1.80.0-insider (636dbcff557af8aa088ae118b1a094dce6632ce7, 2023-06-21T08:21:53.800Z)
  > OS version: Darwin arm64 22.5.0
  > Modes:
  > 
  > 
  > System Info
  > 
  > |Item|Value|
  > |---|---|
  > |CPUs|Apple M1 Max (10 x 24)|
  > |GPU Status|2d_canvas: enabledcanvas_oop_rasterization: disabled_offdirect_rendering_display_compositor: disabled_off_okgpu_compositing: enabledmetal: disabled_offmultiple_raster_threads: enabled_onopengl: enabled_onrasterization: enabledraw_draw: disabled_off_okvideo_decode: enabledvideo_encode: enabledvulkan: disabled_offwebgl: enabledwebgl2: enabledwebgpu: enabled|
  > |Load (avg)|3, 4, 4|
  > |Memory (System)|32.00GB (1.19GB free)|
  > |Process Argv|--crash-reporter-id 511166e9-
  > 
  > _(truncated)_

  * [#4594](https://github.com/Dart-Code/Dart-Code/issues/4594): Expanding a test file in the test explorer tree that is not open will no longer often fail to discover tests in that file.

  > **#4594**: Test Discovery on expanding nodes for closed files sometimes doesn't discover tests `is bug` `in testing`
  > ... but opening the file does:
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/1078012/2e053a60-af36-4c62-8fa4-0beb43604e67
  > 
  > 
  > When we open the file, seems like we don't get an outline (but the discovery code expects that we do):
  > 
  > ```
  > Mon Jun 19 2023 [16:27:15 GMT+0100 (British Summer Time)] Log file started
  > [4:27:17 PM] [General] [Info] Returning cached results for project search
  > [4:27:20 PM] [Analyzer] [Info] ==> Content-Length: 426
  > [4:27:20 PM] [Analyzer] [Info] ==> {"jsonrpc":"2.0","method":"textDocument/didOpen","params":{"textDocument":{"uri":"file:///C%3A/Dev/Test%20Projects/dartcode_4553_project2/test/test2_test.dart","languageId":"dart","version":1,"text":"import 'package:test/test.dart';\n\nvoid main() {\n  test('project2 passing test 2', () {\n    expect(1, 1);\n  });\n\n  test('project2 failing test 2', () {\n    expect(1, 2);\n  });\n}\n"}},"clientRequestTime":1687188440001}
  > [4:27:20 PM] [Analyzer] [Info] ==> Content-Length: 426
  > [4:27:20 PM] [Analyzer] [Info] ==
  > 
  > _(truncated)_

  * [#4553](https://github.com/Dart-Code/Dart-Code/issues/4553): The “Run All Tests” action handles excluded suites better and now produces shorter command lines (reducing the chance of “Command line too long” on Windows).

  > **#4553**: "Run All Tests" passes all individual suite names for all projects when only some projects have exclusions `is bug` `in testing`
  > **Describe the bug**
  > On windows, test directories with too many test files output is just `The command line is too long // Exited (1)`
  > 
  > **To Reproduce**
  > 1. Be on windows
  > 2. have a directory with lots of tests
  > 3. the tests won't be run
  > 
  > **Expected behavior**
  > Should pass a single folder and not each individual test file
  > 
  > **Screenshots**
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/3664822/92baccae-10a8-4124-bb22-a40b1c147bc0)
  > I've got 34 lines here with roughly 125 characters each.
  > 
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Win 11 Business 22621.1265
  >  - VS Code version: 1.78.2
  >  - Dart extension version: v3.64.0
  >  - Dart/Flutter SDK version: 2.19.6
  >  - Target device (if the issue relates to Flutter debugging): simply running tests on windows




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They will show up automatically after you upgrade to the next (non-hotfix) Dart/Flutter SDK release in future. If you’re using a recent bleeding-edge version, these items should already be available to you and any issues should be reported on GitHub in the usual way.

All of these issues relate to using the new SDK debug adapters that are being gradually rolled out:

  * [#4599](https://github.com/Dart-Code/Dart-Code/issues/4599): Breakpoints in a file will no longer sometimes be left “unverified” when adding/removing other breakpoints in that file.

  > **#4599**: All breakpoints in a file become "unverified" when adding/removing breakpoints `is bug` `in debugging` `relies on sdk changes`
  > When I add or remove a breakpoint, other breakpoints in the file become unverified.
  > 
  > It's possible we remove and re-add them all, but I would expect them to be immediately resolved.
  > 
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/1078012/635085fd-1419-4824-9599-fc2d5245db19

  * [#4420](https://github.com/Dart-Code/Dart-Code/issues/4420): The debug adapter now drops references to variables, scopes and stack frames when execution resumes to reduce memory usage over long debug sessions.

  > **#4420**: Debug Adapter should drop references to variables, scopes, stack frames when execution resumes `in debugging` `is performance` `relies on sdk changes`
  > https://microsoft.github.io/debug-adapter-protocol/overview#lifetime-of-objects-references
  > 
  > > To simplify the management of object references in debug adapters, their lifetime is limited to the current suspended state. Once execution resumes, object references become invalid and DAP clients must not use them.
  > > ...
  > > Please note that other object references like `threadId` do not have limited lifetime because that would prevent something like the `pause` request from working in the running state.
  > 
  > We should probably store a flag with `StoredData` stating whether data can be dropped when resuming.
  > 
  > (We may need to consider when we clear `variablesReference`s for global evaluations, since those may still be visible in the Debug Console and users might still want to interact with them).

  * [#4287](https://github.com/Dart-Code/Dart-Code/issues/4287): Running Dart CLI apps using `cliConsole=terminal` will no longer show the terminal and then switch back to the Debug Console when the app launches.

  > **#4287**: Running tests using cliConsole:terminal often focuses the Debug Console, hiding the Terminal output `is bug` `in debugging` `relies on sdk changes`
  > While testing with the analysis_server tests, I noticed that the Debug Console gets focus even when using `runInTerminalRequest`, so it's not obvious where the output is going.

  * [#4505](https://github.com/Dart-Code/Dart-Code/issues/4505): Skipped tests no longer show ticks which made them look like passing tests.

  > **#4505**: Skipped tests look like passing tests in Debug Console `is bug` `in testing` `relies on sdk changes`
  > ![Screenshot 2023-04-24 at 11 56 19](https://user-images.githubusercontent.com/1078012/233977056-29a5f498-a02f-47c7-bba3-43a01612fd40.png)

  * [#4542](https://github.com/Dart-Code/Dart-Code/issues/4542): Triggering a hot reload during application launch will no longer report “DebugAdapterException: app ‘null’ not found”.

  > **#4542**: Failed to Hot Reload: DebugAdapterException: app 'null' not found `is bug` `in flutter` `in debugging` `relies on sdk changes`
  > Happened while saving when an app was being launched:

  * [#4577](https://github.com/Dart-Code/Dart-Code/issues/4577): The Flutter debug adapter now supports the `vmServiceInfoFile` field which is useful for attaching debug sessions to Flutter instances started by other tools that can produce this file.

  > **#4577**: vmServiceInfoFile does not work with Flutter SDK debug adapter `is bug` `in flutter` `in debugging` `relies on sdk changes`
  > Content of the vmService file:
  > 
  > ```
  > {
  >   "uri": "http://127.0.0.1:59168/t1E27KPVN5w=/"
  > }%      
  > ```
  > 
  > [logs-new-adapter (not working).txt](https://github.com/Dart-Code/Dart-Code/files/11681307/logs-new-adapter.not.working.txt)
  > 
  > [logs-old-adapter (working).txt](https://github.com/Dart-Code/Dart-Code/files/11681308/Dart-Code-Log-2023-05-03.21-34-07.txt)

  * [#4597](https://github.com/Dart-Code/Dart-Code/issues/4597): The pause action is now available.

  > **#4597**: Pause is not supported in SDK DAPs `is bug` `in debugging` `relies on sdk changes`
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/655b158c-154f-4afa-a8f8-1ef2d37c1875)

