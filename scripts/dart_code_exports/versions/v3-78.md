# Dart-Code v3-78

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.78.2 _2023-12-11_

[#4880](https://github.com/Dart-Code/Dart-Code/pull/4880): Using “Run” / “Run without Debugging” will now still connect the debugger to the Dart VM Service (but disable breakpoints and pause-on-exception). This restores some functionality that had become unavailable recently in Run mode, such as:

  > **#4880**: Force Flutter non-test sessions into debug mode to force SDK DAP to connect VM Service
  > See https://github.com/Dart-Code/Dart-Code/issues/4878#issuecomment-1840506612


  * [#4878](https://github.com/Dart-Code/Dart-Code/issues/4878): Flutter Widget inspector navigating the code editor as widgets are inspected

  > **#4878**: Inspector navigation doesn't work in noDebug mode with the SDK DAPs `is enhancement` `in flutter` `in debugging` `important`
  > It might not be obvious to users (especially as it changed with the new adapters) that they should run using Debug mode to get some functionality from the inspector (navigating to files as they select widgets).
  > 
  > https://github.com/Dart-Code/Dart-Code/issues/4876 is for deciding (and documenting) the differences between Run/Debug (which should probably be based on specific features rather than arbitrarily what comes over the VM Service) but in the short-term we should do something to avoid confusion from users that don't realise navigation only works in Debug mode.
  > 
  > As a minimum, we should warn users opening the inspector that they should use Debug mode, but we should also evaluate other options (such as a hotfix that connects the VM Service for noDebug mode, or forcing noDebug mode `off` in the extension and intercepting breakpoints/pause-on-exception requests).

  * [#4875](https://github.com/Dart-Code/Dart-Code/issues/4875): Logging from the `log()` function in `dart:developer` showing up in the Debug Console

  > **#4875**: Developer logs not showing up on the debug console anymore while running using the 'Run Without Debugging' option `is bug` `in flutter` `in debugging`
  > **Describe the bug**
  > Outputs of the `log()` function from `dart:developer` import is not showing up at the debug console anymore unless you run the app using "Run > Start Debugging". This was not the case before, I was able to see the logs on my console using "Run > Run Without Debugging" option.
  > 
  > I sometimes need to output long data on my console but this is not seem to be possible using `print()` since it truncates the text. I also don't want to use debugging mode while developing my application because the app runs too slow and it gets interrupted for every exception.
  > 
  > https://github.com/flutter/flutter/issues/135445
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Import `dart:developer` into your dart code
  > 2. Log something using `log()` function
  > 3. Run the app using "Run > Run Without Debugging"
  > 
  > **Expected behavior**
  > Log output to be displayed on debug console.
  > 
  > **Please complete the following information:**
  > 
  > You can run the **Dart: Collect Diagnostic Infor
  > 
  > _(truncated)_




[#4876](https://github.com/Dart-Code/Dart-Code/issues/4876) has been opened to review (and document) the differences between Run/Debug going forwards. If you have an opinion on this difference, please comment!

  > **#4876**: Document & Review differences between Run and Debug modes `in docs / website`
  > VS Code has first-class actions for running in Debug and "noDebug" modes. Our current distinction is:
  > 
  > - Run - does not connect the debug adapter to the VM Service
  > - Debug - does connect the debug adapter to the VM Service
  > 
  > This means in noDebug, anything that uses the VM Service will be unavailable:
  > 
  > - breakpoints
  > - break on exception
  > - (expression eval??)
  > - `dart:developer` `log()`
  > - navigating to files from `ToolEvents`
  > 
  > This distinction is not clear/obvious, and to confuse things further in the legacy debug adapters we did connect the VM Service in noDebug mode **but only for Flutter**.
  > 
  > The reason for doing more than just disabling breakpoints/break-on-exception in noDebug mode is that these are trivially toggleable in the UI anyway (users can easily do this, including changing it _while the session is running_, and VS Code could also just do this by not sending those settings to the debugger when you run if this was the intention).
  > 
  > However, we may have gone too 
  > 
  > _(truncated)_


# v3.78.0 _2023-11-30_

## Flutter Sidebar

[#4762](https://github.com/Dart-Code/Dart-Code/issues/4762)/[#4833](https://github.com/Dart-Code/Dart-Code/issues/4833) If you’ve upgraded to the [recently-released Flutter 3.16](https://medium.com/flutter/whats-new-in-flutter-3-16-dba6cb1015d1) you’ll have access to a new sidebar panel in VS Code when working on Flutter projects:

![](/images/release_notes/v3.78/sidebar.jpg)

The panel currently includes:

  * a list of current running debug sessions with buttons to Hot Reload, Hot Restart, and to quickly launch DevTools features
  * a list of connected devices that you can use to launch your application on



## Code Completion Signatures

[#2462](https://github.com/Dart-Code/Dart-Code/issues/2462): Also when using Flutter 3.16 / Dart 3.2, code completion has been improved to include more detailed signatures for all items instead of only the one currently selected.

  > **#2462**: Always show return type/signature for all items in code completion `is enhancement` `in editor` `in lsp/analysis server`
  > Is it possible to show return type of a method in intellisense (or a complete method signature)?
  > 
  > Sometimes, it is much useful when we have a large number of methods available. And to pick one quickly, this will help much.
  > 
  > For example, in Android Studio, it shows like this:
  > ![Screenshot 2020-05-16 at 7 57 32 PM](https://user-images.githubusercontent.com/45350182/82122173-98fcd980-97af-11ea-819c-83876dbbabed.png)


![](/images/release_notes/v3.78/completion.png)

## Lazy Getters in Debugger

[#4234](https://github.com/Dart-Code/Dart-Code/issues/4234): Setting `"dart.evaluateGettersInDebugViews": false` will no longer completely hide getters in debug views, but instead provide a clickable button that will evaluate them lazily.

  > **#4234**: Allow getters to be executed lazily instead of up-front `is enhancement` `in debugging` `relies on sdk changes`
  > DAP now allows us to wrap expensive getters in an object and signal that it's to support lazy-fetching of expensive/potential-side-effect properties:
  > 
  > https://github.com/microsoft/vscode/issues/134450
  > 
  > We should look at adopting this and then ditching the option that does this up-front (or keeping it as a way to opt-in to previous behaviour if it's more convenient and you have no concerns about side-effects/perf).
  > 
  > - [ ] Roll into Flutter and update its argument classes to pass this value
  > - [ ] Update Dart-Code to support setting this option


![](/images/release_notes/v3.78/lazy_getters.gif)

To completely hide getters you can use the new setting `"dart.showGettersInDebugViews": false`.

## Flutter

  * [#4571](https://github.com/Dart-Code/Dart-Code/issues/4571): When using the new SDK debug adapters, formatting of Flutter errors in the Debug Console has been improved to have the same colouring and emphasizing of user stack frames in stack traces as the legacy debug adapters.

  > **#4571**: Flutter structured errors aren't formatted well when using SDK DAPs `is bug` `in flutter` `in debugging`
  > The console doesn't show the exceptions correctly, links are in red, not clickable, 
  > 
  > [Dart-Code-Log-2023-05-05 19-17-57.txt](https://github.com/Dart-Code/Dart-Code/files/11637349/Dart-Code-Log-2023-05-05.19-17-57.txt)
  > 
  > _______
  > **with legacy DAPs:**
  > start of the exception:
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/44902066/b5c6bd35-b7a4-45b8-a132-0d22d0ff0cea)
  > middle:
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/44902066/7685d151-9718-4d64-acdb-03e4722126dd)
  > end:
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/44902066/6ac4ff8e-8f2a-42ce-8ce2-7e4fa0f790dc)
  > 
  > _______
  > **currently:** all of the console log looks like this with nothing clickable and not clear stacktrace.
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/44902066/1f863d1d-6f78-4ffc-abee-e6ad129ecbc6)

  * [#4823](https://github.com/Dart-Code/Dart-Code/issues/4823): The tooltip on the selected device in the status bar now updates correctly when devices change and includes counts of both all devices and those enabled for the current workspace.

  > **#4823**: Device entry in status bar shows incorrect count `is bug` `in flutter`
  > Seems like it's not taking into account that the device is unavailable (it's Windows, but I have no Windows folder).
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/3d5ed5cf-ece4-4c52-b91a-5791bbdea445)

  * [#4839](https://github.com/Dart-Code/Dart-Code/issues/4839): Failures to launch Android emulators are no longer silent and will be shown in an Output pane.

  > **#4839**: QEMU launch may fail silently `is bug` `in flutter` `in commands`
  > **Describe the bug**
  > 
  > In Dart-Code, if I try to launch the Android emulator, and virtualization support is disabled in the BIOS, or another emulator such as VirtualBox is already running, then QEMU will fail to launch, but no error is shown to the user. VS Code just keeps showing a spinner saying it is waiting for the emulator to start.
  > 
  > **Expected behavior**
  > 
  > It would be nice if the user were alerted to the fact that QEMU couldn't be started.




## Editor

  * [#4624](https://github.com/Dart-Code/Dart-Code/issues/4624): Inlay hints are now included for patterns.

  > **#4624**: Inlay hints for patterns `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Is your feature request related to a problem? Please describe.**
  > It would be helpful to easily see (and navigate) to inferred types for patterns (switch, if-case, destructuring, etc.)
  > For now it's only possible to see inferred type from hover popup.
  > 
  > **Describe the solution you'd like**
  > Make inlay hints for patterns behave like for generics (like #4366)
  > 
  > **Describe alternatives you've considered**
  > Not really.
  > 
  > **Additional context**
  > Also inferred patterns are not navigable, in example hint `Box` allows to navigate to `int`, but `Box` both `int`s are not navigable.
  > And probably inferred single element pattern should be `(Type,)` instead of `(Type)`.
  > 
  > ```dart
  > final class Box {
  >   const Box(this.value);
  >   final T value;
  > }
  > void main() {
  >   {
  >     { // actual
  >       final (i, j) = (1, 2);
  >     }
  >     { // expected
  >       final (int i, int j) = (1, 2);
  >     }
  >   }
  >   {
  >     final pattern = (test: (10,), 2);
  >     { // actual
  >       if (pattern case final p) {}
  > 
  >       fin
  > 
  > _(truncated)_

  * [#4837](https://github.com/Dart-Code/Dart-Code/issues/4837): An issue that caused closure code completions to stop showing up in Dart 3.2.0 has been fixed (and hot-fixed into Dart 3.2.2).

  > **#4837**: Closure completions are not showing up in VS Code `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > While looking into https://github.com/Dart-Code/Dart-Code/issues/4834, I don't see any closure completions even using code from the test:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/bb318208-35ef-48a6-a0c1-867b9b8c8a73)




## DevTools

  * [#4832](https://github.com/Dart-Code/Dart-Code/issues/4832): The “Open DevTools in browser” action should no longer sometimes fail when using the new Flutter sidebar panel.

  > **#4832**: "Open DevTools in browser" doesn't work `is bug` `in commands` `in devtools` `relies on sdk changes`
  > While working on #4821 I found that the browser window isn't actually opening. It's not just from the sidebar, the same happens when running the "Open DevTools" command then selected "Open in External Browser".

  * [#4828](https://github.com/Dart-Code/Dart-Code/issues/4828): The `dart.customDevTools` setting now running DevTools from source now works on Windows (this setting is intended for contributors to DevTools to allow testing it embedded).

  > **#4828**: Support dart.customDevTools on Windows `is enhancement` `on windows` `in devtools`
  > We should ensure once #4827 is done, that this whole thing works e2e on Windows.

  * [#4827](https://github.com/Dart-Code/Dart-Code/issues/4827): The `dart.customDevTools` setting now uses `devtools_tool serve` instead of the legacy `build_e2e` script.

  > **#4827**: Update dart.customDevTools to support using "devtools_tool serve" instead of the old build_e2e script `is enhancement` `in devtools`
  > Currently the `dart.customDevTools` setting assumes we will run `dart ${dart.customDevTools.script}` to start DevTools, but the script has been replaced by `devtools_tool serve` in https://github.com/flutter/devtools/pull/6638
  > 
  > We should update this to just take a path to the DevTools repo root and run `devtools_tool` from within. Backwards compatibility with older DevTools is not a requirement, as this functionality exists purely for hacking on DevTools and we can assume anyone doing that is on the latest version.




## Debugger

  * [#4543](https://github.com/Dart-Code/Dart-Code/issues/4543): The new SDK debug adapters are now enabled for all users on recent Dart and Flutter SDKs.

  > **#4543**: Migrate all users of new Flutter SDKs to the new SDK DAPs `in debugging`
  > Currently ~10% of users on Flutter 3.10 should be getting the new DAP (need to check stats). We should increase this as long as it's not generating lots of crashes.
  > 
  > @christopherfujino are you seeing (m)any crashes on stable since 3.10 released?




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They may be available to test in the current beta/master channels and will show up in future SDK releases.

  * [#4849](https://github.com/Dart-Code/Dart-Code/issues/4849): Rename and Go-to-Definition now work for for-each elements in top-levels and expression bodied functions.

  > **#4849**: Rename and Go-to-Definition do not work for for-each elements in top-levels and expression bodied functions `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Before:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/31bb740b-a2ec-49ed-bbd4-c54f75b92a8f)
  > 
  > Click on any of the `rightTableSubQuery` references (they are all correctly highlighted), hit F2, and rename it to `r`.
  > 
  > After:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/ba08598f-6918-48b2-ab26-092e450dac37)
  > 
  > 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.77.20231116
  > Flutter extension: 3.77.20231101 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: linux 1.84.2
  > 
  > Workspace type: Dart, Flutter (LSP) (Multiroot)
  > 
  > Dart (3.2.0): /opt/flutter/bin/cache/dart-sdk
  > Flutter (3.16.0): /opt/flutter (sdk gphone x86 64 (android-x64/android))
  > 
  > ```
  > 
  > 
  > 
  > 
  > 
  > Output from 'dart info'
  > 
  > `/opt/flutter/bin/cache/dart-sdk/bin/dart info`
  > 
  > If providing this information as part of reporting a bug, please review the information
  > below to ensure it only contains things you're comfortable posting publicly.
  > 
  > 
  > _(truncated)_

  * [#4843](https://github.com/Dart-Code/Dart-Code/issues/4843): The “switch expression” snippet now shows up after the `return` keyword.

  > **#4843**: switch expression snippet does not show after "return" `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **In Dart Code `v3.76.1`, the auto-completion menu shows the entry `switch expression` when defining a variable:**
  > ```Dart
  > final String message = swi
  > ```
  > 
  > **It would be useful, if the entry `switch expression` is presented whenever an expression is expected.**
  > 
  > For example in the following circumstances: 
  > 
  > ```Dart
  > // After the symbol =>
  > String message() => swi
  > 
  > // After the keyword return
  > String message(){
  >   return swi
  > }
  > ```

  * [#4836](https://github.com/Dart-Code/Dart-Code/issues/4836): The `Use imported library with prefix` quick fix no longer puts the prefix at the wrong position when the member has annotations.

  > **#4836**: `Use imported library with prefix` quick fix puts the prefix at the wrong position `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > `Use imported library with prefix` quick fix puts the prefix at the wrong position.
  > 
  > **To Reproduce**
  > 1. Create new project
  > 2. Insert `import 'dart:ffi' as ffi;`
  > 3. Type `@Native`
  > 4. Get the quickfix `Use imported library 'dart:ffi' with prefix 'ffi'`
  > 5. The prefix `ffi.` is placed _before_ the `@`, resulting in a syntax error
  > 
  > **Expected behavior**
  > 5. Should be placed _after_ the `@`
  > 
  > 
  > **Please complete the following information:**
  > 
  > ```text
  > Dart Code extension: 3.77.20231111
  > Flutter extension: 3.76.0 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: linux 1.82.2
  > 
  > Workspace type: Dart (LSP)
  > 
  > Dart (3.3.0-edge.de9494ae0703ba877e967cf8c6f1083b0b3d5d60): /home/mosum/dart-sdk/sdk/out/ReleaseX64/dart-sdk
  > ```

  * [#4834](https://github.com/Dart-Code/Dart-Code/issues/4834): Closure code completions will now include the `required` keyword where necessary when completing functions.

  > **#4834**: `required` keyword on lambda suggestion `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Is your feature request related to a problem? Please describe.**
  > I have the following class in my Flutter project:
  > 
  > ```dart
  > class DataRowCubit extends Cubit> {
  >   DataRowCubit({
  >     required DataRow Function({
  >       required bool selected,
  >       required T data,
  >       required int index,
  >       // ignore: avoid_positional_boolean_parameters, single parameter
  >       required void Function(bool?) onSelectionChanged,
  >     }) dataRow,
  >     void Function({
  >       required bool? selection,
  >       required int index,
  >       required List list,
  >     })? onSelectionChanged,
  >     List? list,
  >   })
  > //...
  > ```
  > But when I write down the constructor to create a new instance, the suggested fillings for the lambdas are the following:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/52160996/c3983ed7-b34b-4ad5-8990-3eb4f706081f)
  > 
  > This creates a minor inconvenience that I then need to write down the `required`s myself in all of the non-null parameters:
  > 
  > ![image](https://github.c
  > 
  > _(truncated)_

  * [#4186](https://github.com/Dart-Code/Dart-Code/issues/4186): Links in Flutter DartDocs (“See code in example/…”) are now correctly highlighted as links without having to Ctrl+hover.

  > **#4186**: Improve colouring of clickable path links in dartdocs `is enhancement` `in editor` `in lsp/analysis server`
  > Split from https://github.com/Dart-Code/Dart-Code/issues/4181, raised by @gspencergoog. Clickable links would be nice if they were highlighted without having to hover/hold Ctrl.
  > 
  > I believe this may be possible with a DocumentLinkProvider (or the LSP equiv of).

  * [#4540](https://github.com/Dart-Code/Dart-Code/issues/4540)/[#4814](https://github.com/Dart-Code/Dart-Code/issues/4814): The “copy to clipboard” buttons in embedded DevTools are now able to write to the clipboard.

  > **#4540**: Embedded DevTools is blocked from using clipboard APIs `is bug` `in devtools` `relies on sdk changes`
  > See https://github.com/flutter/devtools/issues/5775
  > 
  > We likely need to add an `allow` attribute to the iframe we use for embedding DevTools.

  * [#4820](https://github.com/Dart-Code/Dart-Code/issues/4820)/[#4831](https://github.com/Dart-Code/Dart-Code/issues/4831): The Flutter sidebar is now able to show platforms that have not yet been enabled, and trigger enabling of them.

  > **#4820**: Allow enabling new platforms via the API used by side bar `is enhancement` `in flutter` `in devtools`
  > Raised at https://github.com/flutter/devtools/issues/6563
  > 
  > We should ensure the API is able to expose disabled devices in a way that they can be enabled the same as through the device selector.
  > 
  > - ~~Requires a capability to be set~~  Not required.. enablePlatformType is valid only if the devices event had unsupportedDevices

  * [#4862](https://github.com/Dart-Code/Dart-Code/issues/4862): The error “Unable to edit document because the file was not previously opened” that could occur when using `"dart.onlyAnalyzeProjectsWithOpenFiles": true` and analyzer plugins has been resolved.

  > **#4862**: "Unable to edit document because the file was not previously opened" when using "dart.onlyAnalyzeProjectsWithOpenFiles":true (and plugins) `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Splitting this from #4740 since it's not the same as the original issue and I'm not yet certain that it's plugin-related at all.
  > 
  > To reproduce:
  > 
  > - Create a simple empty project that references an analyzer plugin (like `custom_lint`)
  >   I'm not sure the plugin is relevant yet, but it seems to repro pretty reliably with and I couldn't repro without
  > - Ensure `"dart.onlyAnalyzeProjectsWithOpenFiles":true` is set for the workspace and that no files are open
  > - Run the **Developer: Reload Window** command to get a clean analyzer with no open files
  > - Open `analysis_options.yaml` and press Save
  > - Close `analysis_options.yaml`
  >   Modifying analysis_options may or may not be relevant
  > - Open a `.dart` file
  > - Make some changes to the file
  > 
  > This open results in an error like:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/e69bcf8d-27fc-4feb-b396-a5a2bd898372)
  > 
  > Opening the file triggers rebuilding of analysis roots, but it also seems to remove the overlay:
  > 
  > ```
  > 170
  > 
  > _(truncated)_

