# Dart-Code v3-62

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.62.0 _2023-04-03_

## Flutter

  * [#4437](https://github.com/Dart-Code/Dart-Code/issues/4437): The â€œCompilingâ€¦â€ notification when launching a Flutter web app using legacy DAPs no longer remains on screen after the app has started.

  > **#4437**: "Compiling..." notification does not disappear when launching a Flutter web app using legacy DAPs `is bug` `in web` `in flutter` `in debugging`
  > Reported at https://github.com/flutter/devtools/issues/3208#issuecomment-1466600825
  > 
  > This is specific to the old DAPs.

  * [#4427](https://github.com/Dart-Code/Dart-Code/issues/4427): The `FLUTTER_ROOT` environment variable is now set automatically when working inside the Flutter repository, simplifying running/contributing to `flutter_tools`.

  > **#4427**: Set FLUTTER_ROOT automatically to simplify running flutter_tools tests `is enhancement` `in flutter` `in debugging` `in testing`
  > Currently you may have to set the `FLUTTER_ROOT` variable manually in `launch.config`/`dart.env` when running flutter_tools tests.
  > 
  > Since we know where the SDK is, perhaps we could just always set this when starting the Flutter debug adapters, as long as there isn't already one defined?
  > 
  > @christopherfujino can you see any cases where this wouldn't do the right thing?

  * [#4314](https://github.com/Dart-Code/Dart-Code/issues/4314): The new Flutter SDK debug adapter has been enabled by default again for recent versions (currently `master`) of Flutter.

  > **#4314**: Re-enable Flutter SDK DAP for new versions `in flutter` `in debugging`
  > - [x] https://github.com/dart-lang/sdk/issues/50802 / https://github.com/Dart-Code/Dart-Code/issues/4313
  > - [x] https://github.com/Dart-Code/Dart-Code/issues/4193




## Testing

  * [#4441](https://github.com/Dart-Code/Dart-Code/issues/4441): Test suites are no longer duplicated in the test tree on Windows after running tests.

  > **#4441**: Suites are duplicated in the test tree on Windows `is bug` `on windows` `in testing`
  > ![image](https://user-images.githubusercontent.com/1078012/225379085-bbe3466b-d36c-46e6-a06a-033b9dd73cd5.png)
  > 
  > The results from discovery and from running don't seem to have been merged together correctly.




## Commands

  * [#4474](https://github.com/Dart-Code/Dart-Code/issues/4474): When a prompt to run â€œpub getâ€ or â€œpub upgradeâ€ is shown, the extension log (accessible via the **Dart: Open Extension Log** command) will now record exactly what conditions triggered the prompt.

  > **#4474**: Add some logging to indicate why "pub get"/"pub upgrade" may be required `is enhancement` `in commands`
  > Both @jacob314 and @kenzieschmoll have reported seeing "Run pub get?" prompts appearing more often than they would expect (perhaps after changing Git branches).
  > 
  > I can only reproduce this when changing a branch that modifies the pubspec (which I think is to be expected), but we should log in the extension log why we think "pub get" is required so it'll be easier to track down if there are cases we can handle better.

  * [#4456](https://github.com/Dart-Code/Dart-Code/issues/4456): Conditions for including the â€œOpen in Xcodeâ€ context menu entry for `ios`/`macos` folders now behave consistently.

  > **#4456**: "Open in Xcode" condition is incorrect `is bug` `in commands`
  > https://github.com/Dart-Code/Dart-Code/blob/a8b9825d29838f12398b071b76f09ce0318ec74f/package.json#L1224
  > 
  > This and/or may be interpreted incorrectly, so all the conditions aren't applying to both sides (ios/macos).
  > 
  > Maybe there are others that should be reviewed.

  * [#4417](https://github.com/Dart-Code/Dart-Code/issues/4417): Support for project templates from the legacy Stagehand Pub package has been removed. The **Dart: New Project** command is now only usable with SDKs that support `dart create`.

  > **#4417**: Remove support for Stagehand templates `in commands`
  > Many CI tests are failing because we have tests for Stagehand but it no longer works on the latest dev SDKs (because it doesn't support null safety).
  > 
  > The package has been discontinued for a long time in favour of "dart create" so we should remove support here (and associated tests) and just provide a message if someone invokes **Dart: New Project** on a pre-Dart 2.10 SDK.




## DevTools

  * [#4450](https://github.com/Dart-Code/Dart-Code/issues/4450): When using the `dart.customDevTools` setting to use a local development version of DevTools, a failure to start will no longer try to activate the legacy Pub version of DevTools.

  > **#4450**: Failure to start Custom DevTools prompts to try again and activates pub version `is bug` `in devtools`
  > ```
  > [11:52:08] [DevTools] [Error] Unhandled exception:
  > Exception: Something went wrong while running `tool/build_release.sh.
  > #0      main (file:///Users/danny/Dev/Google/devtools/tool/build_e2e.dart:44:5)
  > 
  > [11:52:08] [General] [Error] Dart DevTools exited with code 255.
  > [11:52:42] [General] [Info] Returning cached results for project search
  > [11:52:44] [General] [Info] Spawning /Users/danny/Dev/Google/flutter/bin/cache/dart-sdk/bin/dart with args ["pub","global","activate","devtools"]
  > ```
  > 
  > Something went wrong running custom DevTools (I'll investigate that separately). This showed a prompt asking if I wanted to try again, which then triggered the pub-activate mechanism. This should not happen, the pub version is only for old SDKs.




## Other

  * [#4397](https://github.com/Dart-Code/Dart-Code/issues/4397): The `dart.addSdkToTerminalPath` setting added in the last release is now enabled by default. This setting will cause built-in terminal windows to have the version of Dart/Flutter configured by the extension in their `PATH`. Existing terminals may need to be reloaded for this to apply.

  > **#4397**: Enable dart.addSdkToTerminalPath by default
  > The setting added in #737 is shipping off by default for the first release to get some additional feedback before doing it by default.

  * [#4455](https://github.com/Dart-Code/Dart-Code/issues/4455): The VS Code developer tools console will no longer contain errors about creating quick-fixes for ignoring diagnostics if the document is modified while quick-fixes are being fetched.

  > **#4455**: Failure to create ignore fix `is bug` `in editor`
  > Split from #4421:
  > 
  > ```
  > console.ts:137 [Extension Host] Failed to build Ignore fix for diagnostics. Please report the information below in the Dart-Code/Dart-Code repo on GitHub.
  > T @ console.ts:137
  > $logExtensionHostMessage @ mainThreadConsole.ts:39
  > N @ rpcProtocol.ts:455
  > M @ rpcProtocol.ts:440
  > H @ rpcProtocol.ts:370
  > G @ rpcProtocol.ts:296
  > (anonymous) @ rpcProtocol.ts:161
  > invoke @ event.ts:718
  > deliver @ event.ts:926
  > fire @ event.ts:887
  > fire @ ipc.net.ts:671
  > ne.onmessage @ localProcessExtensionHost.ts:615
  > console.ts:137 [Extension Host] Original diagnostics:
  > [
  >   {
  >     "severity": "Error",
  >     "message": "Classes can only extend other classes.\nTry specifying a different superclass, or removing the extends clause.",
  >     "range": [
  >       {
  >         "line": 88,
  >         "character": 44
  >       },
  >       {
  >         "line": 88,
  >         "character": 55
  >       }
  >     ],
  >     "source": "dart",
  >     "code": {
  >       "value": "extends_non_class",
  >       "target": {
  >         "$
  > 
  > _(truncated)_

  * [#3936](https://github.com/Dart-Code/Dart-Code/issues/3936): Legacy colour previews shown in the gutter have been removed. These were already hidden once the server was providing inline color picker versions, but the temporary display of them was confusing so has been removed.

  > **#3936**: Remove legacy colours from Gutter
  > Having them show up briefly is confusing (see #3925). Once the significant majority of users is on an SDK that supports the new ones, we should remove the legacy ones (or at least prevent them flashing up for new SDKs).

  * [#4445](https://github.com/Dart-Code/Dart-Code/issues/4445): Linux keybindings for the **Dart: Rerun Last Debug Session** command have been fixed to use `Ctrl` (not `Cmd`).

  > **#4445**: Linux keybindings for "dart.rerunLastDebugSession"  is set to use cmd `is bug` `on linux`
  > **Describe the bug**
  > I'm not sure it's a bug (coz I don't have Linux, unfortunately), but I've noticed that the **key** for "dart.rerunLastDebugSession" has "cmd" in it https://github.com/Dart-Code/Dart-Code/blob/master/package.json#LL640C8-L640C8 and AFAIK, Linux does not have this modifier.
  > Reading through the docs also did not help to understand whether this really works or not, but it clearly states that Linux does not have cmd modifier here https://code.visualstudio.com/docs/getstarted/keybindings#_accepted-keys.
  > 
  > So I'm wondering, does it work? If so, how? ðŸ™‚

  * [#4377](https://github.com/Dart-Code/Dart-Code/issues/4377)/[#4457](https://github.com/Dart-Code/Dart-Code/issues/4457): [@aitor-gomila](https://github.com/aitor-gomila) contributed changes to migrate to VS Codeâ€™s new telemetry APIs for the extension. Any analytics collected by the extension will now show in the VS Codeâ€™s Extension Telemetry panel.

  > **#4377**: Switch to VS Code's telemetry classes `is enhancement`
  > https://code.visualstudio.com/updates/v1_75#_telemetry
  > 
  > This simplifies things be handling opt-in/opt-out and ensuring no user info leaks into the data. Adopting it requires bumping he required VS Code version though.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They will show up automatically after you upgrade to the next (non-hotfix) Dart/Flutter SDK release in future. If youâ€™re using a recent bleeding-edge version, these items should already be available to you and any issues should be reported on GitHub in the usual way.

  * [#4472](https://github.com/Dart-Code/Dart-Code/issues/4472): Upon opening a project or running â€œpub getâ€/â€pub upgradeâ€, if your project has issues that could be fixed by the `dart fix` command, a notification will be shown.
  * [#4469](https://github.com/Dart-Code/Dart-Code/issues/4469): When using SDK DAPs, breakpoints will no longer sometimes become unresolved when adding additional breakpoints.

  > **#4469**: Breakpoints unresolve when adding new breakpoints `is bug` `in debugging` `relies on sdk changes`
  > Something odd going on here:
  > 
  > ![Mar-28-2023 17-22-34](https://user-images.githubusercontent.com/1078012/228305503-3ce847a8-3798-429a-8626-bb707b052484.gif)

  * [#4464](https://github.com/Dart-Code/Dart-Code/issues/4464): When using SDK DAPs, `setLibraryDebuggable` is no longer called much more than necessary, which could slow down reloads/restarts and new isolates starting.

  > **#4464**: SDK DAP calls setLibraryDebuggable much more than necessary `is bug` `in debugging` `is performance` `relies on sdk changes`
  > There are two issues:
  > 
  > 1. We always call setLibraryDebuggable regardless of whether the current value matches what the default would be
  > 2. We always call setLibraryDebuggable for every library in an isolate after a Hot Reload, even though the values would stick
  > 
  > We should only send them if they are both a) libraries we haven't already sent values for and b) differ from what the default would be.
  > 
  > We need to ensure these changes don't interfere with when the user changes the settings (`applyDebugOptions`) which should always re-send all, or we should track the values on the VM side and then only send if they've changed.

  * [#4447](https://github.com/Dart-Code/Dart-Code/issues/4447): Stopping a Dart CLI test session while at a breakpoint when using SDK DAPs now automatically resumes from the breakpoint instead of waiting.

  > **#4447**: Stopping a Dart CLI debug session during a test run while at a breakpoint when using SDK DAPs does not work `is bug` `in debugging` `relies on sdk changes`
  > Using the branch here, running the `.solo()` test times out during cleanup:
  > 
  > https://github.com/Dart-Code/Dart-Code/tree/bug-repro
  > https://github.com/Dart-Code/Dart-Code/commit/5099a4d82e4dcec7f0a2f1dd6b617b0f6f11dcc9
  > 
  > It seems that the initial `terminateRequest` never completes, with just "Waiting for current test to finish".
  > 
  > We're supposed to unpause when we try to shutdown, so the tests should complete quite quickly, and then termination should complete normally. That doesn't seem to be happening though.

  * [#4462](https://github.com/Dart-Code/Dart-Code/issues/4462): Code Actions are now available on all lines of a multiline diagnostic instead of only the first.

  > **#4462**: Code actions menu is no available when the cursor is inside the highlighted zone  `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > Noticed that the code actions menu does not appear neither on the shortcut, nor via the button.
  > It can only be called via the diagnostic tooltip or if the cursor in on the first line (where the method signature is):
  > 
  > https://user-images.githubusercontent.com/21116742/227795251-781d58c1-4ca4-4a58-b8f9-5d48c2a74aa0.mov
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. enable `prefer_expression_function_bodies`
  > 2. create a method with a single return statement 
  > 3. try to call the code actions menu
  > 
  > **Expected behavior**
  > Code actions menu appears.

  * [#4451](https://github.com/Dart-Code/Dart-Code/issues/4451): Unnamed extension classes will no longer sometimes cause â€œCannot read properties of undefined (reading â€˜labelâ€™)â€ errors during code completion.

  > **#4451**: "Cannot read properties of undefined (reading 'label')" during code completion `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Reported in #4421 by @incendial:
  > 
  > ```
  > 2023-03-03 17:49:00.451 [error] [Dart-Code.dart-code] provider FAILED
  > 2023-03-03 17:49:00.451 [error] TypeError: Cannot read properties of undefined (reading 'label')
  > 	at shouldTriggerCompletionAgain (/Users/dimannich/.vscode/extensions/dart-code.dart-code-3.60.1/out/dist/extension.js:5474:39)
  > 	at LspAnalyzer. (/Users/dimannich/.vscode/extensions/dart-code.dart-code-3.60.1/out/dist/extension.js:5556:25)
  > 	at Generator.next ()
  > 	at fulfilled (/Users/dimannich/.vscode/extensions/dart-code.dart-code-3.60.1/out/dist/extension.js:5381:58)
  > 	at runNextTicks (node:internal/process/task_queues:61:5)
  > 	at process.processImmediate (node:internal/timers:437:9)
  > ```
  > 
  > Something is causing code completions without labels.

  * [#4440](https://github.com/Dart-Code/Dart-Code/issues/4440): The â€œUse curly bracesâ€ quick fix will no longer remove comments between the condition and body.

  > **#4440**: "Use curly braces" quick fix removes comment before the expression guearded by if statement `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > If a comment precedes expression guarded by `if` statement without curly braces, the "Use curly braces" quick fix removes the comment.
  > 
  > **To Reproduce**
  > 1. Make sure `curly_braces_in_flow_control_structures` lint rule is enforced
  > 1. Insert the following code:
  > ```dart
  > if (identical(true, false))
  >   // This is a nice comment.
  >   throw Exception();
  > ```
  > 3. Open quick fixes suggestions in VSCode at the if statement line.
  > 4. Apply "Use curly braces" fix.
  > 
  > The resulting code is 
  > ```dart
  > if (identical(true, false)) {
  >   throw Exception();
  > }
  > ```
  > 
  > **Expected behavior**
  > The resulting code should be:
  > ```dart
  > if (identical(true, false)) {
  >   // This is a nice comment.
  >   throw Exception();
  > }
  > ``` 
  > 
  > **Please complete the following information:**
  >  - Operating System and version: MacOS 13.1 (Ventura)
  >  - VS Code version: 1.76.1 (Universal)
  >  - Dart extension version: v3.60.1
  >  - Dart/Flutter SDK version: 2.19.2 / 3.7.3

  * [#4436](https://github.com/Dart-Code/Dart-Code/issues/4436): Function types with unnamed parameters will no longer produce empty Inlay Hints, sometimes leading to â€œCharacter must be non-negativeâ€ errors in the VS Code developer console.

  > **#4436**: "character must be non-negative" in inlay hints `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Hit by @incendial at https://github.com/Dart-Code/Dart-Code/issues/4421#issuecomment-1464907624
  > 
  > ```text
  > workbench.desktop.main.js:615   ERR Illegal argument: character must be non-negative: Error: Illegal argument: character must be non-negative
  > 	at w (/Applications/Visual Studio Code.app/Contents/Resources/app/out/vs/workbench/api/node/extensionHostProcess.js:7:1267)
  > 	at new p (/Applications/Visual Studio Code.app/Contents/Resources/app/out/vs/workbench/api/node/extensionHostProcess.js:94:13423)
  > 	at new n (/Applications/Visual Studio Code.app/Contents/Resources/app/out/vs/workbench/api/node/extensionHostProcess.js:94:14913)
  > 	at asRange (/Users/dimannich/.vscode/extensions/dart-code.dart-code-3.61.20230307/out/dist/extension.js:39344:24)
  > 	at asLocation (/Users/dimannich/.vscode/extensions/dart-code.dart-code-3.61.20230307/out/dist/extension.js:39675:66)
  > 	at asInlayHintLabelPart (/Users/dimannich/.vscode/extensions/dart-code.dart-code-3.61.20230307/out/dist/extension.js:40113:
  > 
  > _(truncated)_

  * [#4354](https://github.com/Dart-Code/Dart-Code/issues/4354): Refactor Code Actions now use the new â€œinlineâ€ and â€œmoveâ€ groups where appropriate, improving the grouping/sorting from other code actions.

  > **#4354**: Use new CodeAction groups "inline" and "move" `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > A recent VS Code release added support for two new well-known refactor groups:
  > 
  > https://code.visualstudio.com/updates/v1_72#_new-code-action-groups

  * [#4273](https://github.com/Dart-Code/Dart-Code/issues/4273): Trying to launch DevTools for an app that does not support it (such as in release mode) will now show a more detailed error message.

  > **#4273**: Improve messaging when trying to connect to an app in release mode `is enhancement` `in flutter` `relies on sdk changes`
  > When an app is running in release mode, and I run the "Open DevTools  in Web Browser" command, I get this warning:
  > 
  > ![Screenshot 2022-11-17 at 12 31 48 PM](https://user-images.githubusercontent.com/1145719/202555628-eb6125c4-07dd-49ae-be6d-814bd69f6d6c.png)
  > 
  > Could we detect when the launch configuration's `flutterMode` is set to `release` and point users to the [documentation](https://docs.flutter.dev/perf/ui-performance#run-in-profile-mode)?

  * [#4414](https://github.com/Dart-Code/Dart-Code/issues/4414): Using the SDK DAPs for Flutter web apps will no longer fail due to an unsupported `ToolEvents` stream used to communicate with the editor.

  > **#4414**: SDK DAPs fail to connect to web apps on latest code because subscribing to the ToolEvent stream fails `is bug` `in web` `in flutter` `in debugging`
  > See https://github.com/Dart-Code/Dart-Code/issues/4413#issuecomment-1450339766.

