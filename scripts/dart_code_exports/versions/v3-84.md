# Dart-Code v3-84

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.84.0 _2024-03-01_

## Move Multiple Files/Folders

[#4533](https://github.com/Dart-Code/Dart-Code/issues/4533): With Dart v3.3 / Flutter v3.19 it’s now possible to move multiple files/folders in a single action and have `import` statements updated automatically.

  > **#4533**: Dragging multiple files/folders are once does not update import statements `is enhancement` `in editor` `in lsp/analysis server`
  > **Describe the bug**
  > 
  > If I drag a dart file from one folder to another in VSCode with Dart-Code, the imports of other dart files that depend upon that file are not updated (i.e. the imports end up broken).
  > 
  > **Expected behavior**
  > 
  > Import paths should be updated when files are moved.
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Linux
  >  - VS Code version: code-1.78.0-1683145689.el7.x86_64
  >  - Dart extension version: Latest
  >  - Dart/Flutter SDK version: Dart SDK version: 2.19.4 (stable) (Tue Mar 7 09:58:46 2023 +0000) on "linux_x64"
  >  - Target device (if the issue relates to Flutter debugging):


![](/images/release_notes/v3.84/move_many.gif)

## Flutter

  * [#4954](https://github.com/Dart-Code/Dart-Code/issues/4954): Improvements have been made to the built-in flow for downloading Flutter. The built-in Git extension will now be included when trying to locate `git` for cloning and error messages have been improved.

  > **#4954**: Improve Flutter install flow when Git is not found `is enhancement` `in flutter`
  > When we don't detect an SDK, we prompt to install Flutter and try to locate Git.
  > 
  > Sometimes we fail to find Git (perhaps it's not installed, or not on PATH, or VS Code/Windows was not restarted since it was added to PATH).
  > 
  > Rather than just sending these users to the website (which now tries to send them back through the same flow they may have just tried), we should first try harder to find Git. For example we could:
  > 
  > - Look in the default install locations automatically (even if not on `PATH`)
  > - See if we can use the built-in Git extension to clone or get the Git path ([is this a Git path?](https://github.com/microsoft/vscode/blob/main/extensions/git/src/api/api1.ts#L274))
  > - Make it clearer to the user that we failed to find Git (instead of silently going to the website)




## Testing

  * [#4924](https://github.com/Dart-Code/Dart-Code/issues/4924): A progress notification is now shown immediately when starting a debug session. This should make it clearer when test sessions are starting up until the point that the test starts (and the test icon updates).

  > **#4924**: Show a progress notification when a debug session is starting `is enhancement` `in testing`
  > **Describe the bug**
  > The status indicator in the gutter for test doesn't show the running state. Right now, you can only tell that the tests are running by locating the floating toolbar, but this gets confusing when you also have an emulator running which has its own toolbar.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Create a test
  > 2. Run it once
  > 3. On subsequent runs, it doesn't show the running state, only `success` and `error`
  > 
  > **Expected behavior**
  > Display a loading spinner or another icon when a test in running. 
  > 
  > **Video**
  > 
  > https://github.com/Dart-Code/Dart-Code/assets/30532952/dfcbf346-4c8e-419c-bb14-891d86218473
  > 
  >  - Operating System and version: Linux 6.6.7-arch1-1 
  >  - VS Code version: 1.85.1
  >  - Dart extension version: v3.80.0
  >  - Dart/Flutter SDK version: Flutter 3.16.3 • channel stable | Dart 3.2.3 (stable)




## DevTools

  * [#5000](https://github.com/Dart-Code/Dart-Code/issues/5000): A new **DevTools: Open DevTools in Web Browser** command is available in the command palette that always opens DevTools in an external browser regardless of embed settings.

  > **#5000**: Make "Open DevTools in Web Browser" a top-level command `is enhancement` `in devtools`
  > **Is your feature request related to a problem? Please describe.**
  > I only use DevTools in the web browser, and having to go through an additional menu for that becomes annoying over time :)
  > 
  > **Describe the solution you'd like**
  > It'd be great to have the "Open DevTools in Web Browser" command be accessible on a top-level through ⌘+⇧+P (default shortcut)
  > 
  > **Describe alternatives you've considered**
  > -
  > 
  > **Additional context**
  > I think it also makes sense to have it since we have all the other ones as top-level AFAIK

  * [#4997](https://github.com/Dart-Code/Dart-Code/issues/4997): When using the `dart.customDevTools` setting to run DevTools from source, errors starting DevTools are surfaced better.

  > **#4997**: Errors launching custom DevTools are not handled correctly `is bug` `in devtools`
  > It just gets stuck with a "Starting Custom Dart DevTools" notification:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/56971335-fe75-4c60-bc07-5fdfcdbd4d5a)




## Dart Tooling Daemon

  * [#4984](https://github.com/Dart-Code/Dart-Code/issues/4984)/[#4985](https://github.com/Dart-Code/Dart-Code/issues/4985)/[#5013](https://github.com/Dart-Code/Dart-Code/issues/5013)/[#5017](https://github.com/Dart-Code/Dart-Code/issues/5017)/[#5010](https://github.com/Dart-Code/Dart-Code/issues/5010): Support for the new [Dart Tooling Daemon](https://docs.flutter.dev/go/dart-tooling-daemon) has been added. This daemon is aimed at simplifying communication between Dart and Flutter tools (including [DevTools Extensions](https://github.com/flutter/devtools/tree/master/packages/devtools_extensions#readme)) in the future.

  > **#4984**: Add support for spawning the Dart Tooling Daemon and providing the URI to DevTools `is enhancement` `in devtools`
  > - [x] Remove check for devtools_tool after https://github.com/flutter/devtools/pull/7191 lands




# Misc

  * [#5001](https://github.com/Dart-Code/Dart-Code/issues/5001): Due to breaking changes in the code completion APIs, the `dart.useLegacyAnalyzerProtocol` setting is now ignored for Dart SDKs 3.3 and later. The LSP protocol will always be used for these newer SDKs.

  > **#5001**: Enabling the legacy protocol for Dart 3.3 results in no completions `is bug` `in editor`
  > Completion tests are failing on Dart 3.3 when using the legacy protocol due to the removal of `completion.getSuggestions`.
  > 
  > Rather than migrating to the new APIs, we should disable using the legacy protocol on Dart 3.3 onwards. LSP has been stable and the default for a long time and we've not been updating the legacy client here to keep up with any new features.
  > 
  > As part of removing this, we should set up a bot that runs the tests using Dart 3.2 to ensure we're still testing the legacy protocol for older SDKs (because otherwise no legacy tests would run).




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They may be available to test in the current beta/master channels and will show up in future SDK releases.

  * [#5002](https://github.com/Dart-Code/Dart-Code/issues/5002): Pressing `F2` to rename a generic class with the class name selected or the cursor at the end of the class name no longer reports “The element can’t be renamed”.

  > **#5002**: Renaming a class by its defined name does not work `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > If you try to rename a class from its defined name, with the caret at the end of the name, hitting F2 does nothing:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/02854b8f-5557-48ab-aa50-52e4e5fd7bb2)
  > 
  > You have to put the caret anywhere but the position after the last character, for this to work:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/b268d4a2-af3d-4aaf-8f3d-4f321cba1527)
  > 
  > I thought this was already filed, but I can't find the dup... sorry if this is in fact a dup!
  > 
  > 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.83.20240207
  > Flutter extension: 3.83.20240201 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: linux 1.86.2
  > 
  > Workspace type: Dart, Flutter (LSP) (Multiroot)
  > 
  > Dart (3.4.0-99.0.dev): /opt/flutter/bin/cache/dart-sdk
  > Flutter (3.20.0-1.1.pre): /opt/flutter (sdk gphone x86 64 (android-x64/android))
  > 
  > ```
  > 
  > 
  > 
  > 
  > 
  > Output from 'dart info'
  > 
  > `/opt/flutter/bin/cache/dart-sd
  > 
  > _(truncated)_

  * [#4995](https://github.com/Dart-Code/Dart-Code/issues/4995): Automatic `toString()` invocations in the debugger (controlled by the `dart.evaluateToStringInDebugViews` setting) now evaluate up to 100 values per request instead of 11.

  > **#4995**: Debug `toString()` evaluates 11 values instead of 100 `is bug` `in debugging` `relies on sdk changes`
  > **Describe the bug**
  > When running a program in debug mode, `toString()` only evaluates the first 11 values, rather than 100 as specified in the docs.
  > 
  > **To Reproduce**
  > 1. Override `toString()` with a custom toString method on a custom class (e.g. `Token` class)
  > 2. Create a list of 100 instances of `Token` and pause the debugger while the list of tokens are in scope.
  > 
  > **Expected behavior**
  > All 100 instances show the evaluated `toString()` value next to the list of each `Token` in the debugger.
  > 
  > **Screenshots**
  > 
  > ![Screenshot 2024-02-19 at 2 24 52 PM](https://github.com/Dart-Code/Dart-Code/assets/12474318/565ffe7d-88b9-4740-b98c-d4bf417175a0)
  > 
  > **Environment info**
  > 
  > 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.83.20240207
  > Flutter extension: 3.83.20240201 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: mac 1.86.2
  > 
  > Workspace type: Dart (LSP)
  > 
  > Dart (3.3.0): /Users/pattobrien/.fvm/versions/stable/bin/cache/dart-sdk
  > Flutter (3.19.0): /Us
  > 
  > _(truncated)_

  * [#4877](https://github.com/Dart-Code/Dart-Code/issues/4877): The hover for `Enum.values` no longer incorrectly reports the type as `Enum` instead of `List<Enum>`.

  > **#4877**: Misleading `Enum.values` type hint `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > Hovering over the `values` getter currently shows the enum type, but is actually a list of values.
  > 
  > ```dart
  > enum MyEnum {
  >   first,
  >   second,
  > }
  > 
  > void main() {
  >   print(MyEnum.values);
  > }
  > ```
  > 
  > 
  > 
  > \
  > Given how code navigation works I assume it's all by design, but just in case it's not.
  > 
  > **Please complete the following information:**
  > 
  > Dart Code extension: 3.78.0
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: mac 1.84.2
  > 
  > Workspace type: Dart (LSP)
  > 
  > Dart (3.3.0-91.0.dev): /Users/dimannich/Desktop/flutter/bin/cache/dart-sdk
  > Flutter (3.17.0-0.0.pre): /Users/dimannich/Desktop/flutter (No device)

  * [#4730](https://github.com/Dart-Code/Dart-Code/issues/4730): The **Copy Value** action in the Watch window no longer copies truncated values.

  > **#4730**: Debugger "Copy Value", Watch window and Debug Console should show untruncated values in SDK DAPs `is bug` `in debugging` `relies on sdk changes`
  > **Describe the bug**
  > The debug variable, specifically a String, is not displaying all of its values. It only shows a portion of it and is then truncated with the '...' symbol.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. On your code, create a String variable with a very long size (>1000 characters should be enough).
  > 2. Create a breakpoint below that variable.
  > 3. Run the program with debugging.
  > 4. Go to 'Run and Debug' on the sidebar.
  > 5. Check that String variable value.
  > 
  > **Expected behavior**
  > When inspecting the debug variable, it should be able to display the entire content of its value.
  > 
  > **Screenshots**
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/41714881/40d09c59-fec4-47bc-ba17-6e4239ac17a2)
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Windows 11 22H2 Build 22621.2215
  >  - VS Code version: 1.81.1
  >  - Dart extension version: 3.72.2
  >  - Dart/Flutter SDK version: Dart 3.1.0 / Flutter 3.13.2

  * [#4780](https://github.com/Dart-Code/Dart-Code/issues/4780)/[#4931](https://github.com/Dart-Code/Dart-Code/issues/4931): For loops are now foldable.

  > **#4780**: Support folding for loops and arbitrary blocks `is enhancement` `in lsp/analysis server` `relies on sdk changes`
  > `for` blocks cannot be folded. Un-prefixed top-level blocks cannot be folded either.
  > 
  > One workaround is to select the lines containing the block and use the "Create Folding Region from Selection" command.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. In a VSCode editor, create and save a Dart file with the following contents:
  > ```dart
  > void main() {
  >   if ('i am foldable' != false) {
  >     print("i can be hidden by folding `main` or my containing `if` block");
  >   }
  > 
  >   for (int i = 0; i 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.74.0
  > Flutter extension: 3.75.20231002 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: mac 1.82.3
  > 
  > Workspace type: Dart, Flutter (LSP)
  > 
  > Dart (3.2.0-231.0.dev): /Users/andrewkolos/Documents/GitHub/flutter/bin/cache/dart-sdk
  > Flutter (3.16.0-6.0.pre.12): /Users/andrewkolos/Documents/GitHub/flutter
  > 
  > ```
  > 
  > 
  > 
  > 
  > 
  > Output from 'dart info'
  > 
  > `/Users/andrewkolos/Documents/GitHub/flutter/bin/cache/dart-sdk/bin
  > 
  > _(truncated)_

  * [#4723](https://github.com/Dart-Code/Dart-Code/issues/4723): Function expressions are now foldable.

  > **#4723**: Support folding function expressions `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > @DanTup should I open an issue for this case too? or is it meant to be like this?
  > There's no folding on these cases:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/14304128/f1ede756-03b9-4d8f-8ff8-a404a157e50b)
  > 
  > _Originally posted by @Fernandomr88 in https://github.com/Dart-Code/Dart-Code/issues/4506#issuecomment-1706978579_
  > 
  > As I commented on the above, there are some cases where some Flutter Widget parameters are large functions that would be nice to be able to fold.
  > 
  > My proposal, within the limits of VSCode as stated by @DanTup on the above mentioned issue, is to implement the ability to fold those cases too.

