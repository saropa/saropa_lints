# Dart-Code v3-60

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.60.1 _2023-03-01_

  * [#4413](https://github.com/Dart-Code/Dart-Code/issues/4413): Rollout of the SDK debug adapters for Flutter has been paused due to an issue debugging web apps when using current Flutter `master`.

  > **#4413**: Unable to debug web apps using latest Flutter master / SDK DAPs `is bug` `in web` `in flutter` `in debugging`
  > When clicking the Dart Debug Extension button (edit: this happens on Chrome too, not specific to the debug extension), the connection is made but the app never loads.
  > 
  > Verbose logs contain this:
  > 
  > ```
  > Connecting to VM Service at ws://127.0.0.1:54237/nxSUombw4hc=/ws
  > [ +107 ms] DevHandler: VmService proxy responded with an error:
  >            {jsonrpc: 2.0, id: 16, error: {code: -32601, message: Method not found, data: {jsonrpc: 2.0, method: _setStreamIncludePrivateMembers, id: 16, params: {streamId: Isolate, includePrivateMembers: false}}}}
  > [        ] DevHandler: VmService proxy responded with an error:
  >            {jsonrpc: 2.0, id: 17, error: {code: -32601, message: Method not found, data: {jsonrpc: 2.0, method: _setStreamIncludePrivateMembers, id: 17, params: {streamId: Debug, includePrivateMembers: false}}}}
  > [        ] DevHandler: VmService proxy responded with an error:
  >            {jsonrpc: 2.0, id: 18, error: {code: -32601, message: Method not found, data: {jsonrpc: 2.0, me
  > 
  > _(truncated)_




# v3.60.0 _2023-03-01_

## Flutter

  * [#4401](https://github.com/Dart-Code/Dart-Code/issues/4401): Saving a `.frag` file now triggers a Hot Reload.

  > **#4401**: In a Flutter project, saving a `*.frag` file should trigger a hot reload `is enhancement` `in flutter` `in commands`
  > **Is your feature request related to a problem? Please describe.**
  > I'm developing a [Flutter app with vertext shaders](https://docs.flutter.dev/development/ui/advanced/shaders). Flutter supports hot reloading vertex shaders. 
  > 
  > **Describe the solution you'd like**
  > While in development mode, it would be nice if saving a Fragment Shader caused a hot reload the same way saving a Dart file does.
  > 
  > /cc @craiglabenz for context

  * [#4374](https://github.com/Dart-Code/Dart-Code/issues/4374): Flutter tests with backticks in their name no longer fail to run from CodeLens links.

  > **#4374**:  Backticks in Flutter Test Description on VSCode cause error `is bug` `in debugging`
  > **Describe the bug**
  > If I put two backticks in my Test Description and try to run it with the Dart & Flutter VsCode Extensions I get the following output:
  > `No tests match regular expression "^( \(variant: .*\))?$".`
  > 
  > Interesting fact:
  > If I press the run button of the `main()`Function which is surrounding the Test the error doesnt occur
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Create a Test File and paste the test:
  > ```dart
  > import 'package:flutter_test/flutter_test.dart';
  > 
  > void main() {
  >   test('`echo`', () {
  >     expect(1, 1);
  >   });
  > }
  > ```
  > 2. VsCode should now you two `Run | Debug` Buttons. One over the `main` and and one over the `test`. Press the Run Button over the Test.
  > 
  > **Expected behavior**
  > I expect that the `Run` Button over test will behave like the `Run` over the main function and that backticks don't cause Reg Ex Errors
  > 
  > **Screenshots**
  > ![image](https://user-images.githubusercontent.com/29661951/216575202-7da4a3ac-ec04-4f89-8d43-1baeceef23e7.
  > 
  > _(truncated)_

  * [#4370](https://github.com/Dart-Code/Dart-Code/issues/4370): Debug sessions will no longer get stuck “Waiting for connection from debug service” when running on Web devices using older Flutter SDKs.

  > **#4370**: Debugger stuck on waiting for connection from debug service on chrome when trying to run on web using Flutter 2.x `is bug` `in debugging`
  > **Describe the bug**
  > Debugger stuck on waiting for connection from debug service on chrome when trying to run on web
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. having a flutter project with an older version 2.10.5 for example
  > 2. click on debug
  > ![image](https://user-images.githubusercontent.com/42588746/215763950-146afdc8-c480-413c-9007-bf58e3c2b8bf.png)
  > 
  > 
  > **Expected behavior**
  > project was supposed to run normally
  > 
  > **Screenshots**
  > ![image](https://user-images.githubusercontent.com/42588746/215764435-78b9d673-444e-47dc-866c-01ef5805b639.png)
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Ubuntu 22.04.1 LTS
  >  - VS Code version: 1.74.3
  >  - Dart extension version: 3.58.0
  >  - Dart/Flutter SDK version: 2.16.2/2.10.5
  >  - Target device (if the issue relates to Flutter debugging): chrome

  * ~~[#4314](https://github.com/Dart-Code/Dart-Code/issues/4314): Rollout of the new SDK debug adapters has been resumed for Flutter SDKs >= 3.8.0-16 (currently only the `master` channel).~~ Reverted in v3.60.1.

  > **#4314**: Re-enable Flutter SDK DAP for new versions `in flutter` `in debugging`
  > - [x] https://github.com/dart-lang/sdk/issues/50802 / https://github.com/Dart-Code/Dart-Code/issues/4313
  > - [x] https://github.com/Dart-Code/Dart-Code/issues/4193




## Terminal

  * [#737](https://github.com/Dart-Code/Dart-Code/issues/737): A new setting `"dart.addSdkToTerminalPath"` enables automatically adding your current SDK to the `PATH` environment variable for built-in terminals. This works with quick SDK switching and ensures running `dart` or `flutter` from the terminal matches the version being used for analysis and debugging. To avoid losing terminal state, VS Code may require you to click an icon in existing terminal windows to restart them for this change to apply (this is not required for new terminals). This setting is opt-in today, but may become the default in a future release.

  > **#737**: Switching SDK version should be reflected in terminal ("dart.addSdkToTerminalPath" setting) `is enhancement` `in editor`
  > When I switch my SDK version using the status bar and then I open a terminal I don't see the new version when I run `dart --version`.
  > 
  > This could maybe be set in to the path when a new terminal is created?




## Testing

  * [#4398](https://github.com/Dart-Code/Dart-Code/issues/4398): Profiles for running tests from gutter icons should no longer show up in projects where `package:test` is not supported (such as in the Dart SDK).

  > **#4398**: Tester gutter icons / profiles should not be available when package:test is not available `is bug` `in editor` `in testing`
  > We don't show Run/Debug CodeLens here because it's in the SDK, but we're still adding Run/Debug profiles to the tests, so they still show up with the option to run from gutter icons:
  > 
  > 
  > 
  > These won't work because we don't run with `package:test`:




## Debugger

  * [#4360](https://github.com/Dart-Code/Dart-Code/issues/4360): Detection of which packages come from Pub (used by the “Debug my code / Packages / SDK” options) has been updated to work correctly with Dart >= 2.19 when using the legacy debug adapters.

  > **#4360**: External packages are not correctly detected with Dart 2.19 using legacy DAPs `is bug` `in debugging`
  > In the legacy DAPs, our detection of which local packages are "external" (eg. from pub) depends on the paths in the pubcache:
  > 
  > 
  > 
  > In Dart 2.19, `pub.dartlang.org` changed to `pub.dev` which broke this check, and external package code is considered users code. This means "debug just my code" doesn't work as expected.
  > 
  > There are many test failures on the bots for the stable branch since 2.19 was released.

  * [#4379](https://github.com/Dart-Code/Dart-Code/issues/4379): Asserts are now enabled by default for “Run without Debugging” sessions. This was the original and intended behaviour but was lost in a recent refactor. You can use `"enableAsserts": false` in `launch.json` to change this behaviour.

  > **#4379**: Asserts are no longer enabled by default for non-debug sessions `is bug` `in debugging`
  > There might already be a way to do this that I didn't find, but I would like to be able to run code with asserts enabled without having to be running under the debugger. The primary motivation for not using the debugger is that the code runs slower.
  > 
  > My guess is that this would need to be a preference setting, but I'm happy with any solution you think would be best.

  * [#4390](https://github.com/Dart-Code/Dart-Code/issues/4390): Logging of debugging sessions is now (temporarily) only available if logs are being captured when the debug session starts. Forwarding VM Service logs can be expensive when there is lots of VM Service traffic (such as when spawning lots of Isolates) which was causing high CPU. A future release will allow this logging to be enabled dynamically without forwarding all logs when not capturing.

  > **#4390**: Debug adapter logging can cause high CPU when there's lots of VM Service traffic `is bug` `in debugging` `is performance`
  > Given an app that spawns isolates every half second:
  > 
  > ```dart
  > void main() {
  >   runApp(const MyApp());
  >   Timer.periodic(const Duration(seconds: 1), (timer) async {
  >     final res = await Isolate.run(() => comp(100, 200));
  >   });
  > }
  > ```
  > 
  > The CPU usage of the VS Code "window" process goes very high. It seems to be related to the volume of the `dart.log` events coming back from the debug adapter.
  > 
  > Right now, this logging is always enabled (so you can start logging after the debug session has started), but since this can negatively affect performance we should enable it only if logging is enabled as the debug session starts. If this becomes a problem, we should add the ability to send a custom message to the DA to start/stop logging later.




## DevTools

  * [#4363](https://github.com/Dart-Code/Dart-Code/issues/4363): Pressing `Ctrl+A`/`Cmd+A` in embedded DevTools should no longer “select” the whole frame.

  > **#4363**: Pressing Ctrl+A/Cmd+A in DevTools "selects" the whole iframe and is difficult to remove `is bug` `in devtools`
  > From https://github.com/flutter/devtools/issues/5107.
  > 
  > There appear to a few causes:
  > 
  > 1. The outer page has focus by default
  > 2. The outer page has focus if you focus DevTools then tab away, then click back into the VS Code window
  > 3. Pressing Ctrl+A inside DevTools is passed up to the parent page (used to ensure you can access the palette etc.)




## Other

  * [#4373](https://github.com/Dart-Code/Dart-Code/issues/4373): The initial startup prompt to use recommended settings will no longer be shown if there are already some Dart settings defined.
  * [#4378](https://github.com/Dart-Code/Dart-Code/issues/4378): Drive letters on Windows are now always normalised to uppercase when sent to the Dart Analysis Server to avoid some compatibility issues.

  > **#4378**: Windows drive letter casing is not working correctly for LSP `is bug`
  > Release notes placeholder for fix for https://github.com/dart-lang/sdk/issues/51251.
  > 
  > We have code that is uppercasing drive letters in many places due to the analyzer currently treating all paths as case-sensitive. At some point this code has stopped working because `vs.Uri.file(pathWithUppercaseDrive).toString()` has started lowercasing drive letters.
  > 
  > Our code should handle this, to ensure all drive letters going to the LSP server are normalised to uppercase, as we intended.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They will show up automatically after you upgrade to the next (non-hotfix) Dart/Flutter SDK release in future. If you’re using a recent bleeding-edge version, these items should already be available to you and any issues should be reported on GitHub in the usual way.

  * [#4193](https://github.com/Dart-Code/Dart-Code/issues/4193): When using the new SDK debug adapters, “Inspect Widget” will now navigate the editor to the location that created the widget (as the legacy debug adapters already did).

  > **#4193**: "Inspect Widget" does not navigate to code in IDE when using new DAPs `is bug` `in flutter` `in debugging`
  > The new DAPs don't handle the "inspect" event that was used to navigate the editor to code when inspecting widgets.
  > 
  > Perhaps it's worth considering a more specific event for navigating IDEs, since some users user `inspect()` for wanting to dump variables to the debug console and there's some overlap here (the API also requires a number of calls to get the widget summary which complicates things).
  > 
  > @jacob314 what's involved in creating a new event for this? Should I implement the old way in the new DAPs for now, or is it fairly straight-forward? (I think it would likely want to be a broadcast-style event and not a service extension that the DAP registers, to allow for multiple editors to be connected to the debugger and all receive it?).

  * [#4330](https://github.com/Dart-Code/Dart-Code/issues/4330)/[#4337](https://github.com/Dart-Code/Dart-Code/issues/4337): Calling `dart:developer`’s `inspect()` now dumps a variable to the Debug Console in the new SDK debug adapters to match the legacy debug adapters.

  > **#4330**: dart:developer inspect() doesn't work in SDK DAPs `is bug` `in debugging` `relies on sdk changes`
  > In the old dap, if you call `inspect()` we would send the object to the debug console so you can inspect/expand it.

  * [#4376](https://github.com/Dart-Code/Dart-Code/issues/4376): Selecting a class/mixin/extension name in its declaration now highlights other references to the type.

  > **#4376**: Selecting type name does not highlight references `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Selecting a type name does not highlight references to the type in the current file.
  > 
  > **To Reproduce**
  > 
  > See video.
  > 
  > **Expected behavior**
  > 
  > I feel like selecting a type name did at some point cause references to be highlighted like it is the case for constructors in the included video, but I'm not sure anymore :)
  > 
  > **Screenshots**
  > 
  > https://user-images.githubusercontent.com/5929595/216793327-84dc758e-6fb3-4d7a-9105-674f689aa5f0.mov
  > 
  > **Please complete the following information:**
  >  - Operating System and version: macOS 13.1 (22C65)
  >  - VS Code version: 1.75.0 
  >  - Dart extension version: 3.58.0
  >  - Dart/Flutter SDK version: Flutter 3.7.1 Dart 2.19.1
  >  - Target device (if the issue relates to Flutter debugging):

  * [#4312](https://github.com/Dart-Code/Dart-Code/issues/4312): The “Add type annotation” action no longer incorrectly includes default values for function types.

  > **#4312**: Add type annotation incorrectly includes default values for function types `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > The `Add type annotation` produces the wrong code for type `Function` with default values.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Create a class `ClassName` with a constructor with default values, such as `String name = ""`.
  > 2. Call `ClassName.new` somewhere.
  > 3. Call the `Add type annotation` quickfix
  > 4. The type will be `ClassName Function(String name = "")`, which is marked with the [default_value_in_function_type](https://dart.dev/diagnostics/default_value_in_function_type) error.
  > 
  > **Expected behavior**
  > The type should drop the default values.

  * [#4406](https://github.com/Dart-Code/Dart-Code/issues/4406): Inlay Hints for type arguments are now correctly nested so that each part of the type can be hovered over/navigated to.

  > **#4406**: Inlay hints with inner generics `is enhancement` `in editor` `relies on sdk changes`
  > **Is your feature request related to a problem? Please describe.**
  > Currently Inlay hints can show generics and their inferred types, but inner types are not clickable.
  > 
  > **Describe the solution you'd like**
  >  Make inner generics interactive.
  > 
  > **Describe alternatives you've considered**
  > \-
  > 
  > **Additional context**
  > 
  > Current behavior
  > 
  > ![image](https://user-images.githubusercontent.com/8970959/221232148-3ec0750e-719e-4873-9c6c-67b627debc8b.png)

  * [#4366](https://github.com/Dart-Code/Dart-Code/issues/4366): Inlay Hints are now shown for inferred type arguments on invocations and `List`/`Set`/`Map` literals.

  > **#4366**: Inlay hints should display inferred type argument `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Is your feature request related to a problem? Please describe.**
  > It's hard to navigate to inferred type of generics. You have to lookup relevant argument and find type from it.
  > For now it's only possible to see inferred type from hover popup, but it's just plain text.
  > 
  > **Describe the solution you'd like**
  > Inlay hints should show clickable inferred types of generics.
  > 
  > **Describe alternatives you've considered**
  > Make hovers interactive? (But that's likely out of scope).
  > 
  > **Additional context**
  > 
  > 
  > Screenshot of current behavior
  > 
  > ![image](https://user-images.githubusercontent.com/8970959/215269630-189bb1e4-350b-4c3e-bd1a-2ed48b851866.png)

  * [#4372](https://github.com/Dart-Code/Dart-Code/issues/4372): The `Never` type is now correctly syntax highlighted.
  * [#4320](https://github.com/Dart-Code/Dart-Code/issues/4320): `catch` block parameters are now correctly syntax highlighted.

  > **#4320**: Catch block parameters are not highlighted `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > Syntax highlighting for the catch block parameters is broken.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Create a new file, i.e. catch.dart and paste in the code sample
  > ```
  > try {
  >  // do something
  > } catch (error, stackTrace) {
  >  // handle error
  > }
  > ```
  > 2. Open the file in VSCode
  > 3. The `error` and `stackTrace` arguments are not highlighted, so they look the same as a `dynamic foo = 42;` variable would look.
  > 4. Type inference does not work either when hovering over either `error` or `stackTrace`, even though we know that `error` is an `Object` and `stackTrace` is a `StackTrace` 
  > 
  > **Expected behavior**
  > I expect that the `error` and `stackTrace` arguments get highlighted in blue. When hovering over either `error` or `stackTrace`, the tooltip should display the proper type.
  > 
  > **Screenshots**
  > ![Screenshot 2022-12-23 at 19 47 30](https://user-images.githubusercontent.com/23480364/209394160-14b7ea95-4686-4b76-b337-d73f2b95a701.png)
  > 
  > **Please c
  > 
  > _(truncated)_

  * [#4352](https://github.com/Dart-Code/Dart-Code/issues/4352): Nested variables in the Variables panel now have accurate “evaluate names” assigned to them, allowing functionality like “Copy Expression” or “Add to Watch”.

  > **#4352**: EvaluateNames are not set correctly when using new DAP `is bug` `in debugging` `relies on sdk changes`
  > ```
  > import 'dart:developer';
  > 
  > void main() {
  >   var a = [
  >     [
  >       [
  >         [1, 2, 3],
  >       ],
  >     ],
  >   ];
  >   debugger();
  > }
  > ```
  > 
  > The "Copy Expression" context menu entry is missing because we're not providing `evaluateName`s against nested items.
  > 
  > ![Screenshot 2023-01-19 at 11 16 17](https://user-images.githubusercontent.com/1078012/213428809-3fe64e42-9f0c-400e-a21b-6978fcc2c0d6.png)

  * [#4400](https://github.com/Dart-Code/Dart-Code/issues/4400): Errors in the Variables panel no longer show “unknown” instead of the exception text when using the new SDK debug adapters.

  > **#4400**: Errors on Locals are cryptic `is bug` `in debugging` `relies on sdk changes`
  > ```dart
  > import 'dart:developer';
  > 
  > void main() {
  >   final a = A();
  >   final b = B();
  >   debugger();
  > }
  > 
  > class A {
  >   final b = B();
  > }
  > 
  > class B {
  >   String toString() => throw UnimplementedError('NYI');
  > }
  > ```

  * [#4358](https://github.com/Dart-Code/Dart-Code/issues/4358): Invalid debug configurations that pass invalid arguments to the Dart VM no longer appear to hang when using the new SDK debug adapters and instead show the full error message.

  > **#4358**: Test run "hangs" at startup with invalid code `is bug` `in debugging` `in testing` `relies on sdk changes`
  > ```dart
  > import 'package:test/test.dart';
  > 
  > main() {
  >   test('slow', () async {
  >     print('starting...');
  >     await Future.delayed(const Duration(seconds: 5));
  >   }, timeout: const Timeout.factor(10));
  > }
  > ```
  > 
  > When I try to run this code, it fails with this error:
  > 
  > 
  > 
  > However, if I try to Debug it (both runs use the CodeLens on the `main` function), it just hangs with no error:

  * [#4266](https://github.com/Dart-Code/Dart-Code/issues/4266): The **Dart: Capture Debugging Logs** command now captures `flutter run` traffic when using the new SDK debug adapters.

  > **#4266**: Dart: Capture Debugging Logs doesn't capture "flutter run" JSON traffic when using new DAPs `is bug` `in debugging`
  > The base debug adapter uses `sendLogsToClient` to re-send VM Service traffic, but this isn't used by the Flutter adapter.

  * [#4280](https://github.com/Dart-Code/Dart-Code/issues/4280): The Dart Analysis Server no longer consumes significant CPU and memory on Linux if VS Code restores a dirty file buffer at startup for a file inside a folder that no longer exists.

  > **#4280**: analysis server consumes significant memory when VS Code restores a dirty file buffer for a project that no longer exists `is bug` `in lsp/analysis server` `relies on sdk changes`
  > i open my computer,  and vscode ,  in 3 minutes , have one nosave dart code in editor(old).    so , my memory always been rising.
  > 
  > i have a picture! 
  > 
  > ![image](https://user-images.githubusercontent.com/46606043/203556538-fa13f3d0-403f-4f45-a0c0-c74c0aef557b.png)
  > 
  > 
  > After a while:
  > 
  > ![image](https://user-images.githubusercontent.com/46606043/203556586-0bfd07d2-c73d-4ecd-8e73-82bd59163f15.png)

