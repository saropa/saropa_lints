# Dart-Code v3-54

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.54.1 _2022-11-30_

  * [#4290](https://github.com/Dart-Code/Dart-Code/issues/4290): Running the **Pub: Upgrade Packages** command will no longer sometimes run `pub get` instead of `pub upgrade`.



# v3.54.0 _2022-11-29_

## Improved Status Bar Information

[#4257](https://github.com/Dart-Code/Dart-Code/issues/4257): Several items that used to have their own status bar entries have been merged into VS Code’s new language status area. This can be found from the `{}` icon next to the language in the status bar.

![](/images/release_notes/v3.54/language_status.png)

Clicking the “pin” icon against an entry will move it back to being always visible on the status bar.

## Flutter: New Project Platform Defaults

[#4284](https://github.com/Dart-Code/Dart-Code/issues/4284): When creating a new Flutter project using the **Flutter: New Project** command it’s now possible to set the default platforms that should be enabled for new projects. This can be accessed from the “cog” icon when entering the project name.

  > **#4284**: Add a setting to control which platforms are enabled in new Flutter projects `is enhancement` `in flutter` `in commands`
  > Splitting from #4271. Initially a new setting, added to the existing Flutter Create settings editor.
  > 
  > #4271 is about showing this automatically (without needing to click the cog icon) and an option to skip that in future.


![](/images/release_notes/v3.54/platforms_1.png)

![](/images/release_notes/v3.54/platforms_2.png)

![](/images/release_notes/v3.54/platforms_3.png)

These can also be set directly via the `dart.flutterCreatePlatforms` setting.

## Flutter

  * [#4089](https://github.com/Dart-Code/Dart-Code/issues/4089): `cmd/ctrl`+`click` is now supported on `file://` and `package:` links in the test error peek window.

  > **#4089**: ⌘-click on link in test output doesn't go to location in file. `is enhancement` `in flutter` `in testing`
  > ## Description
  > 
  > When I run a test and it fails I get output that includes the absolute path to the file and the line number and character of the failure, and while VSCode detects the `file:///` URI as a link, and I can ⌘-click on it, it either fails and gives me an error dialog that says something like "Unable to open 'menu_bar_test.dart:205:7'" because it doesn't know about a file with a filename that ends in ":205:7" (unsurprisingly), or (if I click on the other link in the output that is only the filename followed by "line 205", it doesn't go anywhere (because it's already got that file open).
  > 
  > This issue also appears to happen on Linux, so I don't think it's macOS specific.
  > 
  > ## To Reproduce
  > Steps to reproduce the behavior:
  > 1. Run a failing test.
  > 2. In the "inline" failed test result at the test location in the file, ⌘-click on either link for the file location where the test failure occurred.
  > 3. See the failure dialog appear, or that the cursor doesn't move.
  > 
  > ## Expecte
  > 
  > _(truncated)_

  * [#4283](https://github.com/Dart-Code/Dart-Code/issues/4283): The **Flutter: New Project** settings editor now pre-selects the existing selected values in single-selection lists.

  > **#4283**: "flutter create" settings editor doesn't select existing values `is bug` `in flutter` `in commands`
  > When `objc` is selected here, it's not pre-selected on the next page.
  > 
  > ![Screenshot 2022-11-28 at 14 48 52](https://user-images.githubusercontent.com/1078012/204307298-1b763459-ac35-4325-971a-a653cbb074dc.png)
  > 
  > ![Screenshot 2022-11-28 at 14 48 59](https://user-images.githubusercontent.com/1078012/204307314-a70f52a2-4a03-41e3-8412-1d9a535d3105.png)

  * [#4276](https://github.com/Dart-Code/Dart-Code/issues/4276): The **Hot Reload** button and commands are now hidden if running your app in Profile/Release mode.

  > **#4276**: Disable hot reload profile/release mode `is bug` `in flutter` `in debugging`
  > The hot reload and hot restart buttons should be disabled when you run in profile or release mode, since they won't work.  See flutter/flutter#37987.

  * [#4272](https://github.com/Dart-Code/Dart-Code/issues/4272): The entries for enabling new platforms in the device selector are now listed after a seperator to make them easier to find.

  > **#4272**: Add a divider before "Enable platform" entries in device manager `is enhancement` `in flutter`
  > ![image](https://user-images.githubusercontent.com/1078012/202218413-d1691bab-b16b-4963-800b-633c73ce90a3.png)

  * [#4249](https://github.com/Dart-Code/Dart-Code/issues/4249): Chrome will no longer fail to be located if defined by `CHROME_EXECUTABLE` when using the new SDK debug adapters.

  > **#4249**: Unable to launch on Chrome when using CHROME_EXECUTABLE with new SDK DAPs `is bug` `in flutter` `in debugging`
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Use a non-standard chrome executable and have it defined in ENV.
  > 
  > **Expected behavior**
  > VSCode to launch using the web platform.
  > 
  > 
  > ** actual behavior **
  > Error shows in debug console
  > ```
  > No supported devices found with name or id matching 'chrome'.
  > 
  > The following devices were found:
  > Linux (desktop) • linux • linux-x64 • Arch Linux 6.0.2-arch1-1
  > 
  > Exited (1).
  > ```
  > 
  > **Screenshots**
  > If applicable, add screenshots to help explain your problem.
  > 
  > user settings
  > ```json
  > {
  >   "workbench.iconTheme": "material-icon-theme",
  >   "editor.fontSize": 15,
  >   "editor.cursorSmoothCaretAnimation": true,
  >   "dart.warnWhenEditingFilesOutsideWorkspace": false,
  >   "editor.largeFileOptimizations": false,
  >   "files.autoSave": "afterDelay",
  >   "dart.env": {
  >     "CHROME_EXECUTABLE": "/usr/bin/google-chrome-stable",
  >   },
  >   "dart.flutterSdkPath": "/home/USERNAME/development/flutter",
  >   "editor.stickyScroll.enabled": true,
  >   "typescript.up
  > 
  > _(truncated)_




## Editor

  * [#4255](https://github.com/Dart-Code/Dart-Code/issues/4255): A new command **Dart: Toggle Line Comment Kind** has been added that cycles through no comment, double-slashes, triple slashes.

  > **#4255**: Add a command that cycles between no comment, double-slash, triple-slash `is enhancement` `in editor`
  > If I press Ctrl+/ (Toggle Line Comment) on a Dartdoc line, currently the line gets transformed from:
  > ```dart
  > /// Dartdoc line
  > ```
  > to:
  > ```dart
  > / Dartdoc line
  > ```
  > Even though it'd be asymmetric with adding a comment, I think it'd be nice if uncommenting removed either `//` *or* `///`.  This would be particularly useful if I'm writing a Dartdoc comment, press Enter, which automatically adds `///` to the next line, but don't actually want the next line to be a Dartdoc comment.
  > 
  > I'm using v3.52.1 of the Dart VS Code extension.

  * [#4253](https://github.com/Dart-Code/Dart-Code/issues/4253): An issue that prevented Pub package names (used by the **Dart: Add Dependency** command) from being cached locally has been resolved.

  > **#4253**: Pub package name cache is not persisted `is bug` `in editor` `is performance`
  > The caching of the Pub package name cache is not working because of this code here:
  > 
  > https://github.com/Dart-Code/Dart-Code/blob/57a55110e58e8e11f6442a7e96dd9fe2a59e04c6/src/shared/vscode/workspace.ts#L11-L17
  > 
  > The URI is now a `vscode-userdata:/` URI and we only handle `file`.
  > 
  > We should isntead keep the URI and use `workspace.fs` to read/write this file.

  * [#3547](https://github.com/Dart-Code/Dart-Code/issues/3547): The `dart.showTodos` setting now accepts an array of strings and can be used to individually choose which `TODO`-style comments (of those supported by the analyzer - `TODO`, `FIXME`, `HACK`, `UNDONE`) should be shown. This requires Dart SDK >= 2.18.

  > **#3547**: Support string[] for dart.showTodos once updated LSP server ships to stable `is enhancement` `in editor`
  > See https://github.com/Dart-Code/Dart-Code/issues/2364#issuecomment-909209982.
  > 
  > This may need middleware to ensure we don't send an array to a version of the server that doesn't support it.




## Commands

  * [#4261](https://github.com/Dart-Code/Dart-Code/issues/4261): Upon opening a project, if your Dart/Flutter SDK versions have changed since you last ran `pub` you will now be prompted to run `pub upgrade`.

  > **#4261**: Prompt to run "pub upgrade" upon opening a package if the SDK versions has changed `is enhancement` `in commands`
  > When the user upgrades their SDK (a major or minor change, but not patch) there may be new versions of packages that were not available before (or that are required for some classes of changes). We should detect this change when we're checking if they need to run "pub get" (we can get the last version used to fetch packages from `.dart_tool/package_config.json`: (`"generatorVersion": "2.19.0-374.0.dev"`)) and offer to run `pub upgrade` (in preference to `pub get`).
  > 
  > @devoncarew should we do this in both directions, or only one? It probably doesn't affect many users, but I realise that I often switch between SDK versions (for testing) and if I click `pub upgrade` on this prompt and then switch back to an older SDK, there's a possibility that I now have packages that are not valid. Would `pub upgrade` even fix this (I don't think`pub downgrade` is what's wanted here, because I want to go back to "the highest that is valid given this new (lower) SDK"?)




## Testing

  * [#4163](https://github.com/Dart-Code/Dart-Code/issues/4163): Gutter icons for helper methods that call `setUpAll`/`tearDownAll` will no longer appear on the wrong line.

  > **#4163**: Gutter test icons sometimes show on wrong line when helper functions call setup/teardown `is bug` `in editor` `in testing`
  > **Describe the bug**
  > The bug usually occurs while creating new tests, moving them around or grouping them.. See screenshot below. 
  > 
  > Reloading VS Code seems the only option atm to realign the buttons (closing/reopening the file does not help)
  > 
  > **To Reproduce**
  > Unable to reproduce at the moment. I've seen it multiple time 
  > 
  > **Expected behavior**
  > The buttons should be aligned with tests. 
  > 
  > **Screenshots**
  > 
  > 
  > 
  > **Please complete the following information:**
  >  - Operating System and version: MacOS
  >  - VS Code version: 1.71.2
  >  - Dart extension version: v3.48.4
  >  - Dart/Flutter SDK version: Dart 2.18 
  > 
  > 
  > **Additional Context**
  > When I observed the issues, I had `"editor.codeLens": false"`  in the VS Code settings. I've enabled the code lens now and I'll follow up with an update if the issue appears.
  > 
  > Related Discord discussion ([here](https://discord.com/channels/615553440969392147/615553440969392151/1020609676221616139))

  * [#4286](https://github.com/Dart-Code/Dart-Code/issues/4286): `setUpAll` and `tearDownAll` results will no longer appear as runnable tests (which error if attempted to run). They still appear in the gutter/test tree to indicate their success/failure, but have no Run or Debug actions.

  > **#4286**: Prevent setup/teardown methods showing as runnable tests `is bug` `is enhancement` `in testing`
  > Setup/teardown methods currently show as runnable tests:
  > 
  > ![image](https://user-images.githubusercontent.com/1078012/204508700-7a4066d7-38e7-4311-acfb-0ade95a1f88f.png)
  > 
  > This is a little confusing, and trying to run them will fail. VS Code lets us use TestTags to restrict profiles, so we should be able to restrict the Run/Debug profile to "runnable tests" and then only set that tag on runnable tests.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They will show up automatically after you upgrade to the next (non-hotfix) Dart/Flutter SDK release. If you’re using a recent `beta` or `master` version, these items should be available to you and any issues should be reported on GitHub in the usual way.

  * [#4279](https://github.com/Dart-Code/Dart-Code/issues/4279): Some quick-fixes are now available for `pubspec.yaml` and `analysis_options.yaml` files.

  > **#4279**: Quick-fixes don't appear in Pubspec / analysis options `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > (release notes placeholder for issue raised at https://github.com/dart-lang/sdk/issues/50306)

  * [#4119](https://github.com/Dart-Code/Dart-Code/issues/4119): A new setting `dart.documentation` allows selecting what level of documentation (`none`, `summary`, `full`) should appear in hovers and code completion. The default is `full` to match previous behaviour.

  > **#4119**: Need an option to disable the documentation section on hover `is enhancement` `in editor` `in lsp/analysis server`
  > **Is your feature request related to a problem? Please describe.**
  > When I hover some symbol on Dart, I get a documentation section on hover:
  > 
  > ![image](https://user-images.githubusercontent.com/1370530/186607482-33fdde48-e173-4008-bd23-9a356239c0be.png)
  > 
  > I couldn't find a way to disable that section. Note that I don't want to disable the whole popup (which can be done at vscode level), I still need the build errors, the debugger inspections, and even the function prototype. I just want to remove the documentation.
  > 
  > **Describe the solution you'd like**
  > A lot of other plugins have an option for that, like:
  > 
  > ```
  >   "rust-analyzer.hover.documentation.enable": false,
  >   "html.hover.documentation": false,
  >   "csharp.referencesCodeLens.enabled": false,
  > ```
  > 
  > As an example, here's what my config looks like in C#, there's only the full type and a short description appearing:
  > 
  > ![image](https://user-images.githubusercontent.com/1370530/186609674-c2a3ef4b-fde5-46cf-b52f-b12a4eae92de.p
  > 
  > _(truncated)_

  * [#4268](https://github.com/Dart-Code/Dart-Code/issues/4268): A new ‘Application (empty)’ template is available when creating Flutter applications which is a stripped down version of the standard ‘Application’ template without all of the explanatory comments and test stubs.

  > **#4268**: Add support for creating an "empty" project `is enhancement` `in flutter` `in commands`
  > Flutter recently added an option to `flutter create` to create an empty project that doesn't have any comments, the code is just a hello world instead of the counter app, and there's no test directory.  The flag is `--empty`.
  > 
  > It would be nice to add the option to the VSCode extension to allow people to create an empty project instead of one that has the counter app in it.  I'm not sure how that should manifest, it could either be an option setting that modifies the "Flutter: New Project" command, or an additional "Flutter: New Empty Project" command, I'm not sure which is more appropriate (maybe the latter?).
  > 
  > For context, see [this comment](https://github.com/flutter/flutter/issues/111118#issuecomment-1315816702), the PR that added the flag: https://github.com/flutter/flutter/pull/113873, and the [related IntelliJ feature request](https://github.com/flutter/flutter-intellij/issues/6402).

  * [#4136](https://github.com/Dart-Code/Dart-Code/issues/4136): Use of `Container()` has been changed to `Placeholder()` in many Flutter snippets.

  > **#4136**: Change Container() to Placeholder() in snippets `is enhancement` `in flutter` `relies on sdk changes`
  > See discussion at https://github.com/Dart-Code/Dart-Code/issues/3975#issuecomment-1234507375. Empty `Container()`s may trigger lints, and `Placeholder` seems like a perfect replacement (`const Placeholder()`).
  > 
  > Needs doing in both the local snippets and the server.

  * [#4116](https://github.com/Dart-Code/Dart-Code/issues/4116): Code completion for overriding methods now includes members that have unimported types in their signature. Additionally, code completion now supports adding multiple imports automatically to support the case where there are several unimported types in an override completion from different libraries that are not yet imported.

  > **#4116**: Autocomplete for overriding methods does not show if the method has non-imported types `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Assume we've this on `a.dart` file:
  > ```dart
  > import 'dart:async';
  > 
  > abstract class Base {
  >   FutureOr method() => '';
  > }
  > ```
  > 
  > And on `b.dart` file we are trying to overide `Base.method`:
  > ```dart
  > import 'a.dart';
  > 
  > class BaseImpl extends Base {
  >   
  >   // 
  > 
  > 
  > Though, if we import `dart:async` in `b.dart`, the autocomplete for override works.
  > 
  > 
  > 
  > 
  > The same issue would occur if the non-imported type is an argument of the method instead of a return type.
  > 
  > **Expected Behavior**:
  > 
  > I would expect the autocomplete to show up, and once it's selected, it'll import all the necessary libraries (i.e. `dart:async` in this case)
  > 
  > ---
  > 
  > **Please complete the following information:**
  >  - VS Code version: Version: 1.70.1
  >  - Dart extension version: v3.46.1
  >  - Dart/Flutter SDK version: Dart SDK version: 2.17.6 (stable) (Tue Jul 12 12:54:37 2022 +0200) on "macos_x64"

  * [#3787](https://github.com/Dart-Code/Dart-Code/issues/3787): Code completion now shows correct constructor documentation for class constructors that are not yet imported into the current file.

  > **#3787**: Completion incorrectly shows class (not constructor) dartdocs for constructors for unimported items `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > This works fine for things in the local file, but for things from other libraries (probably suggestion sets?) it's showing the wrong comment.

  * [#4144](https://github.com/Dart-Code/Dart-Code/issues/4144): Unimported extension members now show their documentation correctly in code completion.

  > **#4144**: DartDocs are missing from auto-import extension members `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Related to https://github.com/Dart-Code/Dart-Code/issues/4143, we're not finding the element to look up the docs.

  * [#4242](https://github.com/Dart-Code/Dart-Code/issues/4242): Several issues with nested/overlapping code folding have been addressed.

  > **#4242**: Nested Code folding not working correctly `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Noted by @methompson in https://github.com/Dart-Code/Dart-Code/issues/4121#issuecomment-1298984464
  > 
  > ```dart
  > class MyClass {
  >   //
  >   method1(String a) {
  >     //
  >   }
  >   //
  > }
  > ```
  > 
  > ```js
  > {
  > 	"id": 202,
  > 	"jsonrpc": "2.0",
  > 	"result": [
  > 		{
  > 			"endLine": 1,
  > 			"startLine": 0
  > 		},
  > 		{
  > 			"endLine": 4,
  > 			"startLine": 2
  > 		}
  > 	]
  > }
  > ```
  > 
  > Here, the folding for the class goes from line 0-1 and doesn't actually cover the class at all. If you remove the first comment, it results in the folding for class not appearing at all.

  * [#4269](https://github.com/Dart-Code/Dart-Code/issues/4269): Whole functions can now be folded (both parameters and body) in a single region.

  > **#4269**: Allow fold when function declaration is in multiple lines Dart `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Type: Bug
  > 
  > I'm filing this issue in the Dart extension because I have not been able to reproduce this exact behavior in languages like Python or C, even with the same parameter formatting. It's relevant because this type of formatting is provided by dartfmt and makes the fold feature useless.
  > 
  > Environment:
  > OS: Windows
  > Version: 1.73.1
  > Reproducibility rate: 100%
  > 
  > Steps to reproduce: 
  > 1. Create a Dart function such as:
  > Future function(String param1,
  >      String param2, String param3) async {
  >      // content
  >      // content
  >      // content
  > }
  > 2. Try to fold the function
  > 
  > Expected Result:
  > The function folds and all the content and parameters are hidden.
  > 
  > Actual Result:
  > Only the function parameters are folded and the content stays visible.
  > 
  > 
  > Extension version: 3.52.1
  > VS Code version: Code 1.73.1 (6261075646f055b99068d3688932416f2346dd3b, 2022-11-09T04:27:29.066Z)
  > OS version: Windows_NT x64 10.0.22000
  > Modes:
  > Sandboxed: No
  > 
  > 
  > System Info
  > 
  > |Item|Value|
  > |---|---
  > 
  > _(truncated)_

  * [#4243](https://github.com/Dart-Code/Dart-Code/issues/4243): ‘.dill’ files will no longer sometimes be created alongside test files during test runs.

  > **#4243**: dil file is being created when I run a test `is bug` `in flutter` `in testing` `relies on sdk changes`
  > When I run a test from VS Code (by selecting the "Debug" option that floats above the tests main method), VS code creates a dil file with the same name as the test. I have to manually delete these files from source control before committing.
  > 
  > ![Screen Shot 2022-11-03 at 9 47 30 AM](https://user-images.githubusercontent.com/43759233/199783461-82fe74f6-e8f9-4195-afce-bacd88136953.png)

  * [#4185](https://github.com/Dart-Code/Dart-Code/issues/4185): The ‘Create Missing Overrides’ fix no longer includes invalid non-nullable types in the selector for choosing types.

  > **#4185**: Create Missing Overrides produces linked edits with unexpected non-nullable type options `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > @bwilkerson while fixing #4184 I noticed these edit groups being produced:
  > 
  > https://user-images.githubusercontent.com/1078012/192819877-e6e0cb59-fd3f-4a0d-b814-9f5fec6645d1.mp4
  > 
  > Here, we're creating linked edit groups with suggestions for `Object?` and `Object` where it seems like only `Object?` is allowed. I believe it's because of `withNullability: false` here:
  > 
  > https://github.com/dart-lang/sdk/blob/e08c94a65147aaa3ec8c4e09fd1935f20599eec2/pkg/analyzer_plugin/lib/src/utilities/change_builder/change_builder_dart.dart#L1936
  > 
  > I think perhaps it should be more like:
  > 
  > ```
  > withNullability: type.nullabilitySuffix != NullabilitySuffix.none
  > ```
  > 
  > However, in the case where there are additional supertypes, that only includes the suffix on the original type. So I think we need to capture the suffix for the original type, and just manually append that onto the result of `getDisplayString(withNullability: false)` for each result.
  > 
  > Before I do this, a) do you know if there are any c
  > 
  > _(truncated)_

  * [#4275](https://github.com/Dart-Code/Dart-Code/issues/4275): Analyzer plugins can now provide code completion entries that automatically import libraries.

  > **#4275**: CompletionSuggestion auto-imports don't work for plugin-contributed completions `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > I'm making a plugin base on [analyzer_plugin](https://github.com/dart-lang/sdk/tree/master/pkg/analyzer_plugin)  and follow the doc https://github.com/dart-lang/sdk/blob/master/pkg/analyzer_plugin/doc/tutorial/completion.md
  > 
  > The problem is that `libraryUri` is set and  `isNotImported` is set to true, but it still has not 'auto import from xxx' in completion. 
  > 
  > ``` dart
  >   /// This field is omitted if getSuggestions was used rather than
  >   /// getSuggestions2.
  >   ///
  >   /// This field is omitted if this suggestion corresponds to a locally
  >   /// declared element.
  >   ///
  >   /// If this suggestion corresponds to an already imported element, then this
  >   /// field is the URI of a library that provides this element, not the URI of
  >   /// the library where the element is declared.
  >   ///
  >   /// If this suggestion corresponds to an element from a not yet imported
  >   /// library, this field is the URI of a library that could be imported to
  >   /// make this suggestion accessible in the file
  > 
  > _(truncated)_

  * [#4128](https://github.com/Dart-Code/Dart-Code/issues/4128): Dart SDK sources are now correctly mapped when running Flutter applications using the new SDK debug adapters (currently behind the `"dart.previewSdkDaps": true` flag, but enabled by default for pre-release SDK users).

  > **#4128**: Dart SDK files are not correctly mapped to local sources when debugging a Flutter app `is bug` `in flutter` `in debugging`
  > #3551 is fixed with the new SDK DAPs, however in Flutter apps the returned URIs aren't the same as the Dart ones, so the fix is not complete for Flutter.
  > 
  > I've filed https://github.com/dart-lang/sdk/issues/49863 to find out whether this is a bug, and if not, exactly what the rules for the mapping are.

