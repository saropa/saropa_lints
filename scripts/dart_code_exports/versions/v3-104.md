# Dart-Code v3-104

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.104.0 _2025-02-03_

## Removing Support for Old SDK Versions

As [previously announced](https://groups.google.com/g/flutter-announce/c/JQHzM3FbBGI), support for older Dart/Flutter SDKs is being removed from the extension. This version of the extension (v3.104) is the last version that will work with SDKs earlier than Dart 3.0 and Flutter 3.10. If you’re using an affected SDK, a one-time notification will be shown.

![](/images/release_notes/v3.100/sdk_deprecation.png)

In the next release of the extension, code supporting these SDK versions will be removed. A table showing which extension versions support which SDKs (and instructions on how to change extension version) is available on the [SDK Compatibility page](/sdk-version-compatibility/) if you need to continue to use unsupported SDKs.

## Color Previews in Code Completions

[#3941](https://github.com/Dart-Code/Dart-Code/issues/3941): When using the latest stable version of Flutter, in addition to the large dartdoc previews for the currently selected completion item, color previews are now shown inline against each color completion even when not selected.

  > **#3941**: Show color previews in code completion `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > See https://github.com/dart-lang/sdk/issues/48870#issuecomment-1109617492.


![](/images/release_notes/v3.102/completion_colors.png)

## Improved Version Manager Support

[#5334](https://github.com/Dart-Code/Dart-Code/issues/5334)/[#5377](https://github.com/Dart-Code/Dart-Code/issues/5377)/[#5117](https://github.com/Dart-Code/Dart-Code/issues/5117): [@davidmartos96](https://github.com/davidmartos96) contributed new settings `dart.getFlutterSdkCommand` and `dart.getDartSdkCommand` that allow executing a command to locate the Dart/Flutter SDKs to use for a workspace. This improves compatibility with some SDK version managers (such as `mise` and `asdf`) because they can be queried for the current SDK instead of reading from `PATH` (or `package.json`).

  > **#5334**: Custom commands to obtain the Dart and Flutter SDK roots dynamically  `is enhancement`
  > **Is your feature request related to a problem? Please describe.**
  > 
  > This is a proposal to fix issues such as #5117 , where the path to the SDK is not statically known when using tools such as ASDF, mise or direnv.
  > It would be great if there was a setting which lets the user provide a command to run that should print to stdout the SDK path. This would allow a project to provide a command such as `asdf where flutter` with the working directory being the `firstFlutterProject` variable in the extension source code or the workspaceFile directory in case there is one.
  > This would let these kind of tools automatically switch vesions according to each project requirements or even let the user define a custom shell/python script based on their own rules. 
  > 
  > 
  > **Describe alternatives you've considered**
  > I've tried using the FLUTTER_ROOT variable in the shell configuration as `"$(asdf where flutter)"`, but that will not be dynamic, which defeats the whole purpose of these versioning tools.
  > 
  > 
  > _(truncated)_


## Editor

  * [#5378](https://github.com/Dart-Code/Dart-Code/issues/5378): The **Add ‘x’ to dependencies** quick-fix no longer tries to use a malformed package name when the imported URI contains more than one forward slash.

  > **#5378**: "Add 'x' to dependencies" quick-fix does not handle package URIs with multiple slashes correctly `is bug` `in editor`
  > **The problem my feature request is related to:**
  > 
  > I am using the standard VS-Code setup to develop a flutter app.
  > 
  > Recently I needed imports of the form:
  > import 'package:highlight/languages/java.dart';
  > 
  > So not like:
  > import 'package:/.dart';
  > 
  > But like:
  > import 'package://.dart';
  > 
  > I tried to go about it the usual way, simply using this suggestion to automatically import, but it failed:
  > 
  > Firstly, if you just start with such an import in an empty project, you sometimes don't even get that option:
  > ![image](https://github.com/user-attachments/assets/e18baff5-bf96-4dd9-bed1-51ea8f76bc24)
  > (Perhaps even with any import?)
  > 
  > Tough, after a few seconds, things normalize regarding that:
  > ![image](https://github.com/user-attachments/assets/408aa1ab-7f0e-46a0-8389-a94b48c63512)
  > 
  > So that's not that much of a problem in my opinion.
  > 
  > Now for the real "issue", if you just try the "auto-import" suggestion, you get:
  > 
  > [flutter_application_1] flutter pub add highlight/languages
  >   Usi
  > 
  > _(truncated)_




## Misc

  * [#5401](https://github.com/Dart-Code/Dart-Code/issues/5401): When using a VS Code workspace (`.code-workspace` file), relative paths in settings are now resolved relative to the folder containing the workspace file instead of the first folder in the workspace.

  > **#5401**: Vscode workspace and relative path to dart sdk not working as expected `is bug`
  > **Describe the bug**
  > When using the workspace feature for vscode and the `sdkPath` for some reason the relative path is not from the workspace file as everything else.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. I placed a `.code-workspace` two folders up the directory tree on my machine than the Dart SDK
  > 2. [server.code-workspace.txt](https://github.com/user-attachments/files/18580669/server.code-workspace.txt) (GitHub doesn't accept the extension so I had to add `.txt`)
  > 3. I had my sdk path on line 35 set to `~/dart`
  > 4. Commented that line and duplicated it
  > 5. I built the SDK and now I pointed it to a folder inside the SDK one where the output happened
  > 6. See that the message for not finding a valid sdk folder has the relative folder twice:
  > 
  > > The SDK configured in dart.sdkPath is not a valid SDK folder: C:\Users\felip_0vh5fa6\Documents\Projects\clones\dart-sdk2\sdk\pkg\analysis_server\dart-sdk2\sdk\out\ReleaseX64\dart-sdk
  > 
  > _(truncated)_




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They may be available to test in the current beta/master channels and will show up in future SDK releases.

  * [#5369](https://github.com/Dart-Code/Dart-Code/issues/5369): Functions assigned to local variables no longer fail to highlight other references correctly (instead, highlighting everything with the same name) when the text cursor is at their position.

  > **#5369**: Miss on highlight `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > If you ask for a highlight it shows every occurrence of that word.
  > 
  > **To Reproduce**
  > 1. Clone https://github.com/FMorschel/sdk/
  > 2. Go to [26241c9e8676b9bff7cef168de49a08b939ea800](https://github.com/FMorschel/sdk/commit/26241c9e8676b9bff7cef168de49a08b939ea800)
  > 3. Open `pkg/analysis_server/lib/src/lsp/handlers/handler_completion.dart`
  > 4. Leave the cursor at the first `element` (the new var) on line 481.
  > 
  > **Expected behavior**
  > For the highlight to be contained to a single variable (or to not show).
  > `element` on 506 and 507 as well as at the end of 481 should not be highlighted.
  > 
  > **Screenshots**
  > ![image](https://github.com/user-attachments/assets/3601a466-d225-4741-a121-978f8dde4c33)
  > 
  > **Please complete the following information:**
  > 
  > 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.103.20241211
  > Flutter extension: 3.103.20241202 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: win 1.96.0
  > 
  > Workspace type: Dart (LSP) (Mu
  > 
  > _(truncated)_

  * [#5365](https://github.com/Dart-Code/Dart-Code/issues/5365): Opening DevTools pages with the WASM experiment enabled no longer produces invalid URLs.

  > **#5365**: DevTools pages create bad URLs when the base contains `?wasm=true` `is bug` `in devtools` `relies on sdk changes`
  > Here's a URL that was produced by triggering the "Open DevTools in the browser" action:
  > 
  > http://127.0.0.1:9100/?wasm=true#?cacheBust=dart-3.7.0-188.0.dev-flutter-3.27.0-1.0.pre.669&ide=VSCode&ideFeature=command&theme=dark&uri=ws%3A%2F%2F127.0.0.1%3A60408%2FZJPl0ajZ8IM%3D%2Fws&page=home
  > 
  > The `cacheBust` param and all following are tacked on to the end instead of adding to the existing query parameters like `wasm=true`. Additionally, we shouldn't need the # sign which may be getting added by VS code.

  * [#5363](https://github.com/Dart-Code/Dart-Code/issues/5363): The debugger no longer incorrectly evaluates values for initializing parameters instead of class variables inside constructor bodies.

  > **#5363**: Debugger shows stale value sometimes when `this` is omitted -- differs from actual value `is bug` `fixed in dart / flutter` `in debugging` `relies on sdk changes`
  > **Describe the bug**
  > In some scenarios (see reproduction below), the debugger shows the wrong (a stale, previous) value of a class field.  This can make debugging super confusing, since the actual behavior of the code doesn't match what the debugger is showing.
  > 
  > **To Reproduce**
  > 
  > Here's a simple piece of code that reproduces the issue.
  > 
  > ```dart
  > class A {
  >   List list;
  >   A(this.list) {
  >     this.list = [3];
  > 
  >     print(list);
  >   }
  > }
  > 
  > void main() {
  >   A([1, 2]);
  > }
  > ```
  > 
  > If you put a breakpoint on the `print` statement, you'll see two values of `list` depending on whether it is preceded by `this.`.
  > 
  > With mouse-over on `list` in the print statement:
  > 
  > ![image](https://github.com/user-attachments/assets/174733a4-76e9-42b9-822c-5099d584199c)
  > 
  > With mouse-over on `this.list`, which is the **same variable**:
  > 
  > ![image](https://github.com/user-attachments/assets/b03dfbbe-1a3a-4b09-8f22-261a26dc277b)
  > 
  > You can also see something similar going on in the variables window:
  > 
  > 
  > 
  > _(truncated)_

  * [#5360](https://github.com/Dart-Code/Dart-Code/issues/5360)/[#4418](https://github.com/Dart-Code/Dart-Code/issues/4418): Stack traces printed to the Debug Console now have clickable links on the right hand side when the output has a prefix like `I/flutter`.

  > **#5360**: Debug Console doesn't add clickable links for stdout output line start with string different #number when using new Flutter SDK debug adapters `is bug` `in flutter` `in debugging` `relies on sdk changes`
  > **Describe the bug**
  > Continue https://github.com/Dart-Code/Dart-Code/issues/4711#issuecomment-2107742425
  > Issue not resolved yet
  > new Flutter SDK debug adapters only handle stdout line start with `#0 #1,...`
  > all other lines start with any other strings like `[log], flutter,...` will not clickable
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Use latest Flutter master channel create new project `flutter create .`
  > 2. Add example code in build method
  > ```
  >     final stack = StackTrace.current.toString().split('\n').take(2).join('\n');
  >     final stack2 = '\n$stack';
  >     log(stack);
  >     debugPrint(stack);
  >     log(stack2);
  >     debugPrint(stack2);
  > ```
  > 
  > **Expected behavior**
  > All line with stacktrace location should clickable even this line start with any string not `#0, #1,...`
  > 
  > **Screenshots**
  > ![2024-12-03_112937](https://github.com/user-attachments/assets/4e37793e-d89a-4992-b0c6-34335d69905d)
  > 
  > **Please complete the following information:**
  > 
  > You can run the **Da
  > 
  > _(truncated)_

  * [#5359](https://github.com/Dart-Code/Dart-Code/issues/5359): Diagnostics no longer produce “Illegal argument: character must be non-negative” errors that prevent diagnostics updating for some kinds of invalid parameters in constant constructor calls.

  > **#5359**: Diagnostics stop showing when some kinds of errors are produced (ex: invalid_constant with a missing required argument produces an invalid range) `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > there is a specific file (lib/auth/auth_bloc.dart) where changes will not trigger analysis (ie. if I delete a semicolon, nothing happens). Code actions will suggest fixes for the problems, but the UI does not show the error itself. 
  > 
  > I have opened the file as a txt just to make sure there weren’t any hidden annotations, and there are no files in the excluded folders for both user and workspace.
  > 
  > I have spent quite some time trying to solve this, and irritatingly copy and pasting the code into a new file even as separate blocks does not work. Running flutter analyze and dart analyze command in the terminal will notice the changes. 
  > 
  > If I restart my computer, any errors that exist in the file are found: they are in the problems tab, and the visual ques in the editor work as expected. However, if I then introduce an error to the file or fix an existing error the changes are not reflected in the problems tab. 
  > 
  > If I run analyze in the terminal, fixed problem
  > 
  > _(truncated)_

  * [#5350](https://github.com/Dart-Code/Dart-Code/issues/5350): **Extract Method** now uses the newer `Function()` syntax avoiding some generating diagnostics for function types with unnamed parameters.

  > **#5350**: [Bug report] extract method: The argument type 'void Function(SnackBarData)' can't be assigned to the parameter type 'void Function(dynamic)' `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > ### Input:
  > ``` Dart
  >         var snackBarData = await _executeConversionWithExceptionAsValue(
  >           () async {
  >             await JxlToJpeg.convert(
  >               jxlFile,
  >               outputPath: path_lib.join(
  >                 selectedOutputDirPath,
  >                 path_lib.setExtension(path_lib.basename(jxlFile.path), '.jpg'),
  >               ),
  >             );
  >           },
  >         );
  >         if (snackBarData != null) {
  >           displayFeedbackForTheUser(snackBarData);
  >         }
  >         _progress.value += 1;
  > ```
  > extract method `_abc`
  > ### Result:
  > ``` Dart
  >   Future _abc(File jxlFile, String selectedOutputDirPath, void displayFeedbackForTheUser(SnackBarData )) async {
  >     var snackBarData = await _executeConversionWithExceptionAsValue(
  >       () async {
  >         await JxlToJpeg.convert(
  >           jxlFile,
  >           outputPath: path_lib.join(
  >             selectedOutputDirPath,
  >             path_lib.setExtension(path_lib.basename(jxlFile.path), '.jpg'),
  >         
  > 
  > _(truncated)_

  * [#5343](https://github.com/Dart-Code/Dart-Code/issues/5343): Lints no longer run for files that don’t exist, which prevents a persistent `lower_case_with_underscores` diagnostic if a file tries to import a non-existant file with a violating name.

  > **#5343**: File with lower_case_with_underscores identifier message is persisting. `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > After https://github.com/Dart-Code/Dart-Code/issues/5270 (I think this might be the cause), if you make a code like this (no actual file with this name):
  > 
  > ```dart
  > export 'MyFile.dart';
  > ```
  > 
  > You'll see the new message for it. But even if you replace this export completely (no second file needed) the message will persist.
  > 
  > > The file name 'MyFile.dart' isn't a lower_case_with_underscores identifier.
  > Try changing the name to follow the lower_case_with_underscores style.
  > You may need to close the file and restart VS Code after renaming a file by only casing.
  > 
  > This is persisted because the message is showing on a non-existing file.
  > 
  > ![image](https://github.com/user-attachments/assets/9d49c07d-b8a8-4076-8b9b-d68a8efd81ca)
  > 
  > ![image](https://github.com/user-attachments/assets/3d998dcd-c866-465d-a27a-f35351fabf63)

