# Dart-Code v3-74

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.74.0 _2023-10-02_

## Editor

  * [#4749](https://github.com/Dart-Code/Dart-Code/issues/4749): The **Extract Local Variable** refactor now prompts for a name of the variable before extracting.

  > **#4749**: Add a prompt for Extract local variable
  > **Is your feature request related to a problem? Please describe.**
  > I'd like to see a prompt for `Extract local variable` as well as for `Extract method`.
  > 
  > **Describe the solution you'd like**
  > Add a prompt after select `Extract local variable`.
  > 
  > **Describe alternatives you've considered**
  > After extract, trigger `Rename symbol` vscode.

  * [#4741](https://github.com/Dart-Code/Dart-Code/issues/4741): The order of label/value in the language status area has been reversed to match other VS Code extensions.

  > **#4741**: Switch order of text/detail in language status area `is enhancement` `in editor`
  > It turns out we've been populating text/details the wrong way around here:
  > 
  > ![image](https://github.com/microsoft/vscode/assets/1078012/cea07a2e-fdee-4ddf-9aa4-f4a31374c255)
  > 
  > Compare this to TypeScripts version:
  > 
  > ![image](https://github.com/microsoft/vscode/assets/1078012/7de951c9-019e-4261-bf89-d0f2815503e2)
  > 
  > This is why the select device didn't fit into it very well. We should swap it around (and drop the detail where it doesn't look right in this order - for ex. we don't want "Started - Dart Analysis Server", we should just drop "Started").

  * [#4721](https://github.com/Dart-Code/Dart-Code/issues/4721): Violations of the `depend_on_referenced_packages` lint now show the quick-fix to automatically add the dependency.

  > **#4721**: Support adding dependencies for depend_on_referenced_packages `is enhancement` `in editor` `in commands`
  > When you paste imports that are not in your pubspec, we usually show a "Add foo to dependencies" quick-fix. This doesn't happen if the package is a transitive dependency because the error code is `depend_on_referenced_packages` and not one of `["uri_does_not_exist", "conditional_uri_does_not_exist"]`.

  * [#4718](https://github.com/Dart-Code/Dart-Code/issues/4718): A summary of debug sessions now appears in the language status area, with a command to quickly copy the VM Service URI to the clipboard.

  > **#4718**: Show debug session count with link to copy VM Service URI in language status area `is enhancement` `in editor` `in debugging` `in commands`
  > See https://github.com/flutter/flutter/issues/114039#issuecomment-1705702879

  * [#4615](https://github.com/Dart-Code/Dart-Code/issues/4615): The textmate grammar used for initial syntax highlighting has been updated to highlight `extension type`.

  > **#4615**: Update textmate grammar for extension types `is enhancement` `in editor`
  > After https://github.com/dart-lang/dart-syntax-highlight/pull/41 lands, we should update it here.




## Debugger

  * [#4746](https://github.com/Dart-Code/Dart-Code/issues/4746): Template launch configurations (using `"templateFor"` in `launch.json`) now apply when running your project using the Run/Debug links in the editor title bar and from the explorer context menu.

  > **#4746**: Environment variables provided by var option doesn't work for top right launch shortcuts or editor context menu `is bug` `in debugging`
  > Moved from https://github.com/flutter/devtools/issues/6381, raised by @DanBaDo
  > 
  > -----
  > 
  > After including a environment variable using `env` option and setting to `templateFor` a empty string value, variable value is accesible for all launching and testing cases, except when clicking top right shortcut icon.
  > 
  > Can see a example here: https://github.com/DanBaDo/dart-code-extension-4736-test




## Commands

  * [#4716](https://github.com/Dart-Code/Dart-Code/issues/4716): A new command **Dart: Collect Diagnostic Information** has been added to collect useful information (such as SDK version numbers and `flutter doctor` output) for reporting issues.

  > **#4716**: Please provide command for fetching version info, to make it easier to file bug reports `is enhancement` `in commands`
  > The bug report template requests the following info:
  > 
  > > **Please complete the following information:**
  > >  - Operating System and version: 
  > > - VS Code version: 
  > > - Dart extension version: 
  > > - Dart/Flutter SDK version: 
  > > - Target device (if the issue relates to Flutter debugging):
  > 
  > You have to fish around in several different places to find all this info. It would be great if Dart-Code could provide a command similar to `flutter doctor -v` that would look up and produce all this info for the user, so they can just paste it into a bug report easily.

  * [#4708](https://github.com/Dart-Code/Dart-Code/issues/4708): When using the SDK switcher, paths written in to `dart.sdkPath` and `dart.flutterSdkPath` will now use `~` (and forward slashes) when the SDK is inside your home directory. This is aimed to simplify sharing settings across machines/platforms.

  > **#4708**: Write home-dir-relative paths into dart.sdkPath and dart.flutterSdkPath when switching SDKs `is enhancement` `in commands`
  > See https://github.com/Dart-Code/Dart-Code/issues/4703. This makes it a little easier to commit these if a team has agreed to put their SDKs somewhere off their home dir.




## Testing

  * [#4410](https://github.com/Dart-Code/Dart-Code/issues/4410): The Test Peek window should no longer show duplicated output for failed tests.

  > **#4410**: Test Peek window has duplicated output `is bug` `in testing`
  > See https://github.com/microsoft/vscode/issues/166270#issuecomment-1446424240.




## Remote

  * [#4731](https://github.com/Dart-Code/Dart-Code/issues/4731): In remote workspaces (including web IDEs like Codespaces and IDX), the number of code completions included has been lowered to improve responsiveness. Typing additional characters will refresh the set of completions shown.

  > **#4731**: Use a lower maxCompletionItems when running in a remote workspace `is enhancement` `is performance` `in remote` `on cloud ide`
  > Similar to https://github.com/Dart-Code/Dart-Code/issues/4729, we should reduce `maxCompletionItems` to reduce payload sizes in remote workspaces. Ideally we'd reduce it for all sessions but it's not completely clear what the impact of ranking issues (such as https://github.com/Dart-Code/Dart-Code/issues/4618) would be, so trying it out in remote workspaces (a small portion of sessions) might help highlight any issues there.

  * [#4729](https://github.com/Dart-Code/Dart-Code/issues/4729): In remote workspaces, full documentation is no longer included for all items in code completion to improve responsiveness. This can be overridden using the `"dart.documentation"` setting.

  > **#4729**: Change default documentation settings when running in a remote workspace `is enhancement` `is performance` `in remote` `on cloud ide`
  > By default we usually include full dartdocs in code completion because transferring a few mb of data is not a problem. However in a web IDE such as IDX, when the completion list is large (see https://github.com/Dart-Code/Dart-Code/issues/3894) and most documentation is inline and not lazy-resolved (because it's already in -scope), this can result in a much slower completion experience.
  > 
  > Until we are able to a) resolve completion for imported elements lazily and/or b) truncate the completion list without regressing the experience (eg. dropping items that should be ranked highly because the ranking tables are old), we should consider changing the default for documentation to "summary" or "none" in a web context.




## Other

  * [#4722](https://github.com/Dart-Code/Dart-Code/issues/4722): External tools spawned by the extension (such as `dart devtools`) will now automatically have the `FLUTTER_TOOL` environment variable set, which may allow them to locate the Flutter SDK in some situations where they previously could not (and will help ensure they use the correct Flutter SDK if it’s not the one on `PATH`).

  > **#4722**: Set FLUTTER_ROOT for external tool processes like "dart devtools" `is enhancement` `in devtools`
  > When running `dart` from `flutter-sdk/bin/dart`, the `FLUTTER_ROOT` variable is set (the same is true for `flutter`).
  > 
  > DevTools [sometimes needs to call Flutter commands](https://github.com/flutter/devtools/pull/6089#discussion_r1306200951) but in the extension we always run the `dart` executable directly (not through the shell script) so this isn't set. We should set it for all tools we spawn (when we are in Flutter mode, with a Flutter SDK) to make it easier for them to locate the same Flutter version the IDE is using.

  * [#4739](https://github.com/Dart-Code/Dart-Code/issues/4739): An error is no longer reported if the dependency tree runs `flutter pub deps --json` and triggers the first-run “Welcome to Flutter” notification.

  > **#4739**: Running "flutter pub deps --json" fails if Flutter first run due to non-JSON output `is bug` `in flutter`
  > Ideally Flutter wouldn't do this, but since it's hard for the shell script to parse args and we already have a precedence for skipping no-JSON, we should do the same here.
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/1e58b75c-bab4-42c1-a597-8106b56a9650)




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. Some are already available in the current beta channels though some are currently only available on bleeding-edge builds and will show up in future beta/stable SDK releases.

  * [#4758](https://github.com/Dart-Code/Dart-Code/issues/4758): “Wrap with …” refactors no longer wrap an entire switch expression when only a single branch was selected.

  > **#4758**: "wrap with widget" wraps the entire switch expression instead of the current branch `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > "wrap with widget" wraps the entire switch expression instead of the current branch
  > 
  > **To Reproduce**
  > ```dart
  > enum MyEnum {a, b}
  > 
  > class MyWidget extends StatelessWidget {
  >   @override
  >   Widget build(BuildContext context) {
  >     return switch(get()) {
  >         MyEnum.a =>  const Text('a'),
  >         MyEnum.b =>  const Text('b'),
  >     };
  >   }
  > }
  > 
  > MyEnum get() {
  > // ...
  > }
  > 
  > ```
  > Move your cursor to `Text('a')` and do a `"Wrap with widget..."` (or anything else)
  > 
  > **Expected behavior**
  > The new widget should be parent of the `Text('a')`  branch and not of the entire switch expression
  > 
  > **Screenshots**
  > If applicable, add screenshots to help explain your problem.
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Fedora 38 
  >  - VS Code version: 1.82.2
  >  - Dart extension version: 3.72.2
  >  - Dart/Flutter SDK version: 3.1.2 / 3.13.5
  >  - Target device (if the issue relates to Flutter debugging):

  * [#4757](https://github.com/Dart-Code/Dart-Code/issues/4757): Running **Fix All** with an unresolved `backgroundColor` reference will no longer sometimes replace `backgroundColor` with `colorScheme.background`.

  > **#4757**: Pasting code with unknown color symbol prefixes it with `colorScheme.` `is bug` `in editor` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Select code like this:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/c9e1de3a-2d60-4caa-8591-5e0d3256967b)
  > 
  > Paste into another class, where the field `Color backgroundColor` is not present:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/9d7690d5-cce9-4964-b5cf-29d955e69d4b)
  > 
  > The `onTap` and `icon` fields are pasted as-is. However, `backgroundColor` gets transformed into `colorScheme.background`.
  > 
  > This is unexpected, and frankly weird...
  > 
  > It may have something to do with the special rendering of colors in Dart-Code, with a color swatch thumbnail.
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Linux
  >  - VS Code version: latest
  >  - Dart extension version: latest
  >  - Dart/Flutter SDK version: latest
  >  - Target device (if the issue relates to Flutter debugging):

  * [#4732](https://github.com/Dart-Code/Dart-Code/issues/4732): The **Inline Local Variable** refactor no longer adds unnecessary parens when inlining an expression in a `switch` statement.

  > **#4732**: "Inline local variable" adds extra parens to switch expression `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Before:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/eaa2c332-3c5f-461f-8eb1-d8cfbff19cae)
  > 
  > Choose "Inline local variable":
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/1e526ee1-d805-4d77-b5a4-9558d61cb0b9)
  > 
  > After:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/771191b3-c6d7-443e-bbc0-012eedaa114f)
  > 
  > There are extra (unnecessary) parens added inside the existing switch expression parens.
  > 
  > **To Reproduce**
  > 
  > As above
  > 
  > **Expected behavior**
  > 
  > The result should be
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/811305/514926d1-66c5-4fff-a26e-ed1af184bfcd)
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Linux
  >  - VS Code version: Latest public release
  >  - Dart extension version: Latest public release
  >  - Dart/Flutter SDK version: Latest public release
  >  - Target device (if the issue relates to Flutter debugging):

  * [#4692](https://github.com/Dart-Code/Dart-Code/issues/4692): Stepping after an exception has occurred should no longer sometimes jump to the top of the file when the top stack frame is inside an anonymous closure.

  > **#4692**: Cursor moves to beginning of file while stepping if an exception occurs during a test `is bug` `in debugging` `in testing`
  > Hello there,
  > 
  > It's been a while since I came by .. hope all is well! 
  > 
  > **Describe the bug**
  > 
  > When running a test in debug mode, the cursor in the test file moves to the beginning of the file after each run. 
  > 
  > This is inconvenient since after each time I run the test, I have to scroll back to the line wherever the test is to run it again.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. create a new dart project (i.e. `dart create debug_cursor_issue`)
  > 2. go to the test file and paste the sample code there (given below).
  > 3. scroll down to the test
  > 4. place the cursor somewhere within the test
  > 5. click on the `debug` button shown above the test within the file.
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/46427323/6488f143-cbeb-4d18-9426-88898de125bf)
  > 
  > 6. click the `continue` button in the debugger controller until the end.
  > 7. the cursor now should've moved to the top of the file.
  > 
  >  >>>> Sample Code 
  > 
  > ```dart
  > import 'package:dart_code_test_bug/dart_
  > 
  > _(truncated)_

  * [#4762](https://github.com/Dart-Code/Dart-Code/issues/4762): A new panel is available on the Flutter side bar for selecting devices and launching DevTools for each debug session.
