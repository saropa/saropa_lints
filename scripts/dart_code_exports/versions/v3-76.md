# Dart-Code v3-76

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.76.1 _2023-11-02_

  * New survey prompts have been enabled for a small number of Flutter beta users.



# v3.76.0 _2023-11-01_

## Flutter

  * [#4809](https://github.com/Dart-Code/Dart-Code/issues/4809): Running Flutter tests from a path that includes a `tool` segment within the `test` folder no longer uses `dart` and produces an error that `dart:ui` is unavailable.

  > **#4809**: Using a subdirectory named 'tool' in test makes vscode freeze  `is bug` `in flutter` `in testing`
  > **Describe the bug**
  > Currently if you make a simple dummy test in a folder named _tool_ it makes vscode freeze and unable to complete. 
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Create new flutter package project
  > 2. Create folder named _tool_ under _test_
  > 3. Create new file named my_test.dart and insert:
  > ```dart
  > import 'package:flutter_test/flutter_test.dart';
  > 
  > void main() {
  >   test('should expect null', () {
  >     expect(null, isNull);
  >   });
  > }
  > ```
  > 4. Click the green arrow to run the test
  > 
  > **Expected behavior**
  > To execute the file as if it was in the root of the _test_ folder.
  > 
  > 
  > **Please complete the following information:**
  > 
  > Dart Code extension: 3.74.0
  > Flutter extension: 3.74.0 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: linux 1.82.3

  * [#4778](https://github.com/Dart-Code/Dart-Code/issues/4778): The `dart.env` setting now correctly sets environment variables for the Flutter device daemon process which addresses some issues with custom `CHROME_EXECUTABLE` paths.

  > **#4778**: Web device is not being detected when running VSCode from icon launcher `is bug` `in flutter`
  > **Describe the bug**
  > Web device is not being detected when running VSCode from icon launcher but if it's run from terminal.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Run VSCode from its icon launcher which opens the latest Flutter project visited
  > 2. No Web device is detected
  > ![image](https://github.com/microsoft/vscode/assets/7342885/3c3c5f9f-f2c6-467b-9cb4-2d7f735be366)
  > 3. If I run VSCode from terminal then my Web device is detected
  > ![image](https://github.com/microsoft/vscode/assets/7342885/47ea7656-92e2-4ea5-af22-f9d76c744690)
  > 
  > Flutter detects Web device in both cases:
  > 
  > ```
  > $ flutter devices        
  > 1 connected device:
  > 
  > Chrome (web) â€¢ chrome â€¢ web-javascript â€¢ Google Chrome 117.0.5938.149
  > ```
  > 
  > This problem has emerged since the most recent VSCode and Flutter update .
  > 
  > **More info**
  > ```
  > $ flutter doctor -v                
  > [âœ“] Flutter (Channel stable, 3.13.6, on EndeavourOS 6.5.5-zen1-1-zen, locale en_US.UTF-8)
  >     â€¢ Flutter version 3.13.6 on chan
  > 
  > _(truncated)_




## Editor

  * [#4807](https://github.com/Dart-Code/Dart-Code/issues/4807): When clicking the â€œOpen Settingsâ€ button after accepting Dartâ€™s recommended settings or in warning notifications about invalid settings, the settings editor will now jump directly to the related setting.

  > **#4807**: Use revealSetting when opening settings files `is enhancement`
  > When we open settings files, we should reveal the interesting setting:
  > 
  > https://code.visualstudio.com/updates/v1_81#_revealsetting-and-focussearch-added-to-iopensettingsactionoptions

  * [#4822](https://github.com/Dart-Code/Dart-Code/issues/4822): The error â€œUnknown Outline item! EXTENSIONâ€ is no longer be printed to the console when working in files that contain extensions.

  > **#4822**: "Unknown Outline item! EXTENSION" `is bug`
  > This sometimes appears in the debug console:
  > 
  > ```
  > [4:53:20 PM] [General] [Error] Unknown Outline item! EXTENSION
  > ```

  * [#4786](https://github.com/Dart-Code/Dart-Code/issues/4786): The change in [#4749](https://github.com/Dart-Code/Dart-Code/issues/4749) to prompt for a variable name when extracted locals has been reverted because it prevented the analysis-server-suggested name from being used (forcing you to always type a name). A future release may re-introduce if it can be done in a way that preserves the server-suggested name as a default.

  > **#4786**: Extract Local Variable no longer uses server-generated name `is bug` `in editor`
  > Implementing https://github.com/Dart-Code/Dart-Code/issues/4749 has resulted in not using the server-generated name for a local variable. This feels worse than the behaviour before, so we should revert it and re-opened it to come up with a better solution.




## Commands

  * [#4789](https://github.com/Dart-Code/Dart-Code/issues/4789): The `Dart: Collect Diagnostic Information` command will no longer include `flutter doctor` output for non-Flutter projects even if a Flutter SDK is available.

  > **#4789**: `Dart: Collect Diagnostic Information` runs `flutter doctor` even in non-flutter project `is bug` `in commands`
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Open a plain dart project
  > 2. Call "Dart: Collect Diagnostic Information"
  > 3. A loader with the "running flutter doctor" text will be displayed
  > 
  > **Expected behavior**
  > flutter doctor is not called
  > 
  > **Please complete the following information:**
  > 
  > Dart Code extension: 3.74.0
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: mac 1.83.0
  > 
  > Workspace type: Dart (LSP)
  > 
  > Dart (3.2.0-134.1.beta): /Users/dimannich/Desktop/flutter/bin/cache/dart-sdk
  > Flutter (3.15.0-15.2.pre): /Users/dimannich/Desktop/flutter

  * [#4773](https://github.com/Dart-Code/Dart-Code/issues/4773): The **Go to Test/Implementation File** command now handles optional `src` segments in paths to handle jumping between `lib/src/foo.dart` and `test/foo_test.dart`.

  > **#4773**: Support optional /src/ in jumping between test/implementation `is enhancement` `in commands`
  > Sometimes implementations live in `src` but the tests live in the same path without `src`:
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/1078012/83237b88-58ba-4610-8959-7b1241e16422)
  > 
  > The "Go to Test/Implementation" command currently assumes a perfect match. We should handle when src exists/doesn't as a fallback.
  > 
  > We should probably also support tests alongside the implementation (like `lib/src/foo.dart`  `lib/src/foo_test.dart`) since we have some other support for tests outside of `test` for users that like to keep them together.




## Flutter Sidebar

The Flutter sidebar is currently available when using the latest Flutter beta and will be available in a future stable Flutter release.

  * [#4812](https://github.com/Dart-Code/Dart-Code/issues/4812): The `embed` flag is now set correctly so that the IDE theme colors are used correctly in the sidebar.
  * [#4819](https://github.com/Dart-Code/Dart-Code/issues/4819): Devices for platforms that are not enabled for the current project are no longer shown in the sidebar.

  > **#4819**: Devices in API should be filtered to what's valid in the workspace `is enhancement` `in flutter` `in devtools`
  > Raised at https://github.com/flutter/devtools/issues/6563
  > 
  > We usually filter the device list to what's valid (and add some "Enable X" options for others), but in the API we're exposing them all so you see "broken" devices.

  * [#4818](https://github.com/Dart-Code/Dart-Code/issues/4818): Devices that are emulators will now show the emulator name (instead of device name) in the sidebar, matching whatâ€™s shown in other locations such as the device quick-pick.

  > **#4818**: Use emulator names for devices in exposed API `is enhancement` `in flutter` `in devtools`
  > Raised at https://github.com/flutter/devtools/issues/6563 - currently the API used by DevTools/sidebar is getting the raw device names even though we've fixed them up in the VS Code UI.
  > 
  > The ideal fix is in Flutter tools (https://github.com/flutter/flutter/issues/11850) but since we already have this in VS Code we could fix up the sidebar now without needing to complete and ship that work.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. Some are already available in the current beta channels though some are currently only available on bleeding-edge builds and will show up in future beta/stable SDK releases.

  * [#4759](https://github.com/Dart-Code/Dart-Code/issues/4759): Assertion failures when debugging Flutter SDK code no longer show â€œSource not availableâ€ messages.

  > **#4759**: "Source not available" on assertion failures in Flutter when debugging SDK code `is bug` `in flutter` `in debugging` `relies on sdk changes`
  > ## Undebuggable Stack Frame Popup Bug
  > 
  > see reproducible example here: https://github.com/pattobrien/undebuggable_stack_frame#undebuggable-stack-frame-popup-bug
  > 
  > ### Steps to Reproduce
  > 
  > 1. Create a Dart package with Flutter SDK as a dependency.
  > 2. Set Dart Code debug option to 'debug my code + packages + SDK'.
  > 3. Run a test that fails an assertion.
  > 
  > ### Expected Behavior
  > 
  > The assertion stack frame should appear in the source view.
  > 
  > ### Actual Behavior
  > 
  > The assertion appears as a file in a new VSCode tab titled `errors_patch.dart` with the following content:
  > 
  > ```
  > Could not load source 'dart:core-patch/errors_patch.dart': .
  > ```
  > 
  > ### Screenshots
  > ![Screenshot 2023-09-25 at 4 32 45 PM](https://github.com/Dart-Code/Dart-Code/assets/12474318/309d6c7b-4e32-421f-a2aa-ddc06b1dbd3b)
  > 
  > 
  > Flutter 3.10.6 â€¢ channel stable â€¢ https://github.com/flutter/flutter.git
  > Framework â€¢ revision f468f3366c (3 months ago) â€¢ 2023-07-12 15:19:05 -0700
  > Engine â€¢ revision cdbeda788a
  > Tools â€¢ Da
  > 
  > _(truncated)_

  * [#4813](https://github.com/Dart-Code/Dart-Code/issues/4813): The **Fix All** command now works correctly for `part`` files and no longer fixes `part`s when invoked in the containing library file.

  > **#4813**: Fix all does not work on part ^\of files. `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > ## Reproduce
  > 1. Turn on the fix all option when saving in VSCode.
  > 2. Create the `main.dart` file and `sub.dart` file using dartâ€™s `part` & `part of` syntax as follows.
  >     - main.dart
  >     ```dart
  >     import 'package:flutter/material.dart';
  >     
  >     part 'sub.dart';
  >     
  >     void main() {
  >       runApp(const Sub());
  >     }
  >     ```
  >     - sub.dart
  >     ```dart
  >     part of 'main.dart';
  >     
  >     class Sub extends StatelessWidget {
  >       const Sub({super.key});
  >     
  >       @override
  >       Widget build(BuildContext context) {
  >         return Column(
  >           children: [
  >             SizedBox(), /// ðŸ‘ˆ Use 'const' with the constructor to improve performance.
  >           ],
  >         );
  >       }
  >     }
  >     ```
  > 3. Even if you save in the `sub.dart` file, fix all does not work, so `const` is not added before `SizedBox()`.
  > 4. If you save in the `main.dart` file, fix all will work in the sub.dart file.
  > 
  > ## Expected
  > I think even if saved in the `sub.dart` file, `const` must be 
  > 
  > _(truncated)_

  * [#4795](https://github.com/Dart-Code/Dart-Code/issues/4795): The â€œswitch expressionâ€ snippet no longer appears in completion when accessing enum members imported with a prefix.

  > **#4795**: Switch expression shows up in completion for prefixed enum member access `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Split from https://github.com/Dart-Code/Dart-Code/issues/4794:

  * [#4792](https://github.com/Dart-Code/Dart-Code/issues/4792): The **Add Import** quick-fix is now available for the `comment_references` lint.

  > **#4792**: support adding import statements for entities reference in comments. `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > dart-code is very helpful when offering to add a missing import for a class of function.
  > 
  > However, if I reference an entity in a comment dart-code doesn't offer to import the required library.
  > 
  > ```
  > /// see also: [PanelClipboards]
  > ```
  > 
  > A lint error is generated: 
  > 
  > ```
  > [{
  > 	"resource": "dvault_ui/lib/src/view/clipboard/clipboard_summary_card.dart",
  > 	"owner": "_generated_diagnostic_collection_name_#0",
  > 	"code": {
  > 		"value": "comment_references",
  > 		"target": {
  > 			"$mid": 1,
  > 			"external": "https://dart.dev/lints/comment_references",
  > 			"path": "/lints/comment_references",
  > 			"scheme": "https",
  > 			"authority": "dart.dev"
  > 		}
  > 	},
  > 	"severity": 2,
  > 	"message": "The referenced name isn't visible in scope.\nTry adding an import for the referenced name.",
  > 	"source": "dart",
  > 	"startLineNumber": 11,
  > 	"startColumn": 16,
  > 	"endLineNumber": 11,
  > 	"endColumn": 31
  > }]
  > `
  > 
  > To fix this we need a quick fix for `comment_references' that offers to import the required library.

  * [#4788](https://github.com/Dart-Code/Dart-Code/issues/4788): Code completion now shows field types on members of records.

  > **#4788**: Type label in autocomplete is not displayed for record fields `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > When typing a record field in the editor, the autocomplete menu does not show the type of suggest fields:
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/21116742/893c6452-3f03-476f-b2a4-a33154b50f1c)
  > 
  > **Please complete the following information:**
  > 
  > Dart Code extension: 3.74.0
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: mac 1.83.0
  > 
  > Workspace type: Dart (LSP)
  > 
  > Dart (3.2.0-134.1.beta): /Users/dimannich/Desktop/flutter/bin/cache/dart-sdk
  > Flutter (3.15.0-15.2.pre): /Users/dimannich/Desktop/flutter

  * [#4787](https://github.com/Dart-Code/Dart-Code/issues/4787): The **Extract Local Variable** refactor no longer rejects variable names that match named arguments in the current scope.

  > **#4787**: When extract locale variable, can't name with same name of parameter `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > When extract locale variable, can't name with same name of parameter
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. With this code:
  > ```dart
  > import 'package:flutter/material.dart';
  > 
  > void main() {
  >   runApp(const MyApp());
  > }
  > 
  > class MyApp extends StatelessWidget {
  >   const MyApp({super.key});
  > 
  >   @override
  >   Widget build(BuildContext context) {
  >     return MaterialApp(
  >       home: Scaffold(
  >         appBar: AppBar(),
  >       ),
  >     );
  >   }
  > }
  > ```
  > 2. Extract locale variable for `AppBar()`
  > 3. The variable is `appBar2` or with prompt if I set `appBar`, I have this error `The name 'appBar' is already used in the scope.`
  > 
  > **Expected behavior**
  > I want name variable `appBar`
  > 
  > **Please complete the following information:**
  > 
  >  - Operating System and version: macOS 14.0
  >  - VS Code version: 1.83.0
  >  - Dart extension version: 3.74.0
  >  - Dart/Flutter SDK version: Dart 3.1.3/Fluttter 3.13.6

  * [#4775](https://github.com/Dart-Code/Dart-Code/issues/4775): The **Ignore â€˜lintâ€™ for line** quick-fix no longer inserts the ignore comment in the wrong location for a getter that has a dartdoc.

  > **#4775**: Quick fix for ignoring lint rule is broken for external getters with existing DartDoc `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > _Not sure if these quick fixes are provided by the analyzer, feel free to move this issue if that is the case_
  > 
  > **Describe the bug**
  > When using the `ignore` quickfix, the ignore is put in the wrong place if there is DartDoc for an external getter
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Given the code sample:
  > 
  > ```dart
  > class Foo {  
  >   /// The uuid of the user.
  >   external String get UID;
  > }
  > ```
  > 
  > 2. Select the quick fix `Ignore constant_identifier_names for this line`
  > 
  > **Expected behavior**
  > ```dart
  > class Foo {
  >   /// The uuid of the user.
  >   external String get UID; // ignore: non_constant_identifier_names
  > }
  > ```
  > 
  > or
  > 
  > ```dart
  > class Foo {
  >   /// The uuid of the user.
  >   // ignore: non_constant_identifier_names
  >   external String get UID;
  > }
  > ```
  > 
  > **Actual behavior**
  > ```dart
  > class Foo {
  >   // ignore: non_constant_identifier_names
  >   /// The uuid of the user.
  >   external String get UID;
  > }
  > ```
  > 
  > Due to the ignore line not being directly before the 
  > 
  > _(truncated)_

  * [#4772](https://github.com/Dart-Code/Dart-Code/issues/4772): Code completion no longer suggests private static class members from other libraries.

  > **#4772**: Autocomplete suggests private fields from other files that cannot be accessed by the language rules `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > 
  > 
  > 
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Create 2 classes (each in its own file) with static const fields that have the same name
  > 2. Start typing the name of this field in one of the files
  > 
  > **Workspace Environment**
  > 
  > ```text
  > Dart Code extension: 3.74.0
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: mac 1.82.3
  > 
  > Workspace type: Dart (LSP)
  > 
  > Dart (3.2.0-134.1.beta): /Users/dimannich/Desktop/flutter/bin/cache/dart-sdk
  > Flutter (3.15.0-15.2.pre): /Users/dimannich/Desktop/flutter
  > 
  > ```

  * [#4712](https://github.com/Dart-Code/Dart-Code/issues/4712): Inlay Hints are now shown for type arguments for type names inside `if case` statements.

  > **#4712**: Inlay hints for nested patterns `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Is your feature request related to a problem? Please describe.**
  > It would be helpful to easily see (and navigate) to inferred types for nested patterns (switch, if-case, destructuring, etc.)
  > For now it's only possible to navigate to most inner inferred type.
  > 
  > **Describe the solution you'd like**
  > Make inlay hints for nested patterns behave like for generics (like #4366)
  > 
  > **Describe alternatives you've considered**
  > Not really.
  > 
  > **Additional context**
  > Addition to #4624
  > 
  > ```dart
  > final class Box {
  >   const Box(this.value);
  >   final T value;
  > }
  > void main() {
  >   {
  >     const boxedBox = Box(Box((1,2)));
  >     const boxedList = Box([1,2]);
  > 
  >     { // actual (notice that inner pattern is augmented correctly)
  >       if (boxedBox case Box(value: Box(:final (int, int) value))) {}
  >       if (boxedList case Box(value: List(:final int length)) when length > 0) {}
  >     }
  >     { // expected
  >       if (boxedBox case Box>(value: Box(:final (int, int) value))) {}
  >       if (boxedList case 
  > 
  > _(truncated)_

  * [#4790](https://github.com/Dart-Code/Dart-Code/issues/4790): Inspecting a list that contains a `null` in the debugger no longer produces an error.

  > **#4790**: Cannot inspect value of lists with null values in debugger `is bug` `in debugging` `relies on sdk changes`
  > **Describe the bug**
  > When debugging, I get an error if I try to inspect the value of lists that contain a null value.
  > 
  > **To Reproduce**
  > Create `main.dart` with the following code:
  > ```dart
  > void main() {
  >   final List myList = [null];
  >   print(myList.length);
  > }
  > ```
  > Set a breakpoint at the print statement and debug the code.
  > Hover over `myList` either in the code pane or the debug sidebar.
  > VS Code displays an error: `type 'Null' is not a subtype of type 'Response' in type cast`
  > 
  > **Expected behavior**
  > You see the value of the list `[null]`
  > 
  > **Screenshots**
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/9874748/45a381e0-6403-4f66-921a-5a21a3b2f256)
  > 
  > **Please complete the following information:**
  > 
  > 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.75.20231009
  > Flutter extension: 3.74.0 (not activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: win 1.83.0
  > 
  > Workspace type: Unknown (Dart SDK) (LSP)
  > 
  > Dart (3.1.3): C:\tools\dart-sdk
  > Flutter
  > 
  > _(truncated)_

  * [#4768](https://github.com/Dart-Code/Dart-Code/issues/4768): Location links shown on the right of the Debug Console now work for file paths even when running without debugging.

  > **#4768**: Debug Console location metadata doesn't appear when not running in debug mode `is bug` `in debugging` `in testing` `relies on sdk changes`
  > **Describe the bug**
  > 
  > Issue 1: The URI on the right hand side of the Debug Console doesn't work (screenshot 1)
  > Issue 2: The URIs printed in the Debug Console and Test Results work but the line number isn't a part of the URI -- i.e. cannot jump to the line using the URIs (screen shot 1 & 2)
  > 
  > Please see the screenshots below:
  > 
  > 1- Screenshot 1
  > 
  > 2- Screenshot 2
  > 
  > 
  > 
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. create `test/some_test.dart`
  > 2. add the following snippet:
  > ```dart
  > import 'package:test/test.dart';
  > void main() {
  > 
  >     void failure() => throw UnimplementedError();
  >     test('fail', () {
  >       failure();
  >     });
  > }
  > ```
  > 
  > **Please complete the following information:**
  > 
  >  - Operating System and version: 12.6 (21G115) 
  >  - VS Code version:  1.82.2
  >  - Dart extension version: v3.74.0
  >  - Dart/Flutter SDK version: Dart SDK version: 3.1.2 (stable) (Tue Sep 12 16:26:23 2023 +0000) on "macos_x64"
  > 
  > 
  > > sorry if this is already reported or should be filed e
  > 
  > _(truncated)_

  * [#4359](https://github.com/Dart-Code/Dart-Code/issues/4359): When using the new SDK debug adapters, the Restart Frame functionality is available for frames before the first async boundary.
