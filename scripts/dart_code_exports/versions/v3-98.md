# Dart-Code v3-98

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.98.1 _2024-10-08_

  * [#5302](https://github.com/Dart-Code/Dart-Code/issues/5302): When using VS Code 1.94, ANSI color codes once again show colors in the Debug Console instead of printing escape sequences.

  > **#5302**: No ANSI colors in Debug Console with VSCode 1.94.0 `is bug` `in debugging`
  > **Describe the bug**
  > After the 1.94.0 VScode update, colors stopped working in the debug console.
  > I did a bisect on vscode source code and this seems to be the related change in the protocol: https://github.com/microsoft/vscode/pull/227729
  > I looks like the extension now needs to opt in into the ANSI colors support.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Run the provided code in the VSCode debug session
  > 
  > ```dart
  > void main() {
  >   print("\^[[1;31m Red message");
  >   print("\^[[1;32m Green message");
  >   print("\^[[1;33m Yellow message");
  >   print("\^[[1;34m Blue message");
  >   print("\^[[1;35m Purple message");
  >   print("\^[[1;36m Cyan message");
  > }
  > ```
  > 
  > **Expected behavior**
  > 
  > ![image](https://github.com/user-attachments/assets/ee879553-4a1a-42b5-b43e-f010d04d2c14)
  > 
  > 
  > 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.98.0
  > Flutter extension: 3.98.0 (activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Version: linux 1.94.0
  > 
  > Workspace type: Da
  > 
  > _(truncated)_




# v3.98.0 _2024-09-30_

## Editor

  * [#3628](https://github.com/Dart-Code/Dart-Code/issues/3628)/[#5263](https://github.com/Dart-Code/Dart-Code/issues/5263): [@FMorschel](https://github.com/FMorschel) contributed new settings for customizing the prefix (`dart.closingLabelsPrefix`) and font style (`dart.closingLabelsTextStyle`) of Closing Labels. ![](/images/release_notes/v3.98/closing_labels_customization.png)

  > **#3628**: Allow customisation of closing label prefix and font/size `is enhancement` `good first issue :octocat:` `in editor`
  > Please allow to change the character and / or other styles of the closing labels I see in VS Code. 
  > Currently they look like comments. This triggers me. 
  > 
  > For example change the `//` slashes to `#` hashtag or `/` single slash or `-` minus, etc..  (just an user input)
  > Or nothing. I don't think the syntax matters. No need for slashes.
  > Changing the color and / or opacity would be also great.
  > 
  > Setting: `dart.closingLabels`
  > 
  > ![image](https://user-images.githubusercontent.com/53160891/138522493-b016900a-e9bd-46da-8e1a-cf90408f8874.png)

  * [#5265](https://github.com/Dart-Code/Dart-Code/issues/5265): Closing labels now show and update for all visible editors, not only the active editor.

  > **#5265**: Closing labels don't update correctly when a file is not the active editor `is bug` `in editor`
  > I noticed this while testing https://github.com/Dart-Code/Dart-Code/pull/5263 - if you open the settings alongside an editor and change them, the closing labels don't update correctly. They also appear/disappear inconsistently when an editor is not visible or active.
  > 
  > We should try to remove the use of `vs.window.activeTextEditor` in the closing labels (and perhaps other files that work the same as this, like UI guides?) and instead just handle all `vs.window.visibleTextEditors` instead.

  * [#5253](https://github.com/Dart-Code/Dart-Code/issues/5253): The `codeLens.path` field for launch configurations now supports wildcards, allowing more control over which files custom CodeLenses appear in.

  > **#5253**: Support wildcards for configuring "codeLens. path" `is enhancement` `in debugging`
  > I manage a monorepo with VSCode, which includes many Flutter apps and libraries. However, I have only one launch.json. Some test files require the --dart-define-from-file flag when running. When they fail, I need to debug these tests, but the default "Debug" codeLens does not include --dart-define-from-file. Therefore, I have defined a new set of codeLenses named Run(TestDefines) and Debug(TestDefines), and I pass the --dart-define-from-file parameter in the args of these codeLenses. But this results in these new codeLenses appearing on all test files, which is not very nice. So I want to enable these codeLenses only in the specific dart_defines_test.dart file. If codeLens.path supported wildcards, I could easily enable these codeLenses only in the required files.

  * [#5270](https://github.com/Dart-Code/Dart-Code/issues/5270): The diagnostic for the `file_names` lint now includes additional information about resolving the issue after renaming a file by only case.

  > **#5270**: Improve error message for Linter warning: lower_case_with_underscores / dart(file_names) `is enhancement` `in editor`
  > **Is your feature request related to a problem? Please describe.**
  > The problem is that sometimes when creating a new file, one might type in an uppercase character by accident. Dart-Code then immediately shows the `lower_case_with_underscores` warning. However, fixing the issue can be rather tricky, because VSCode doesn't want to change its internal cache of file names, when the only thing that changes about the file name is the casing.
  > 
  > For example create a new file `test.dart` with the following contents:
  > 
  > ```dart
  > // test.dart
  > 
  > part 'test_part.dart`;
  > ```
  > 
  > Then create another file `test_Part.dart` (intentionally using an uppercase `P`):
  > 
  > ```dart
  > // test_Part.dart
  > 
  > part of 'test.dart';
  > ```
  > 
  > The linter will immediatly recognize the problem and highlight it:
  > 
  > ```dart
  > // test_Part.dart
  > 
  > part of 'test.dart';
  > ^^^^
  > The file name 'test_Part.dart' isn't a lower_case_with_underscores identifier.
  > Try changing the name to follow the lower_case_with_underscores style.
  > `
  > 
  > _(truncated)_




## Dependencies Tree

Various improvements have been made to the Dependencies Tree.

![](/images/release_notes/v3.98/dependencies_tree.png)

  * [#5281](https://github.com/Dart-Code/Dart-Code/issues/5281): The Dependencies tree no longer sometimes fails to group dependencies by Direct, Dev, transitive when in a non-Flutter workspace but a Flutter SDK is available.

  > **#5281**: Dependencies tree doesn't show correct nodes `is bug` `in editor`
  > Not sure what's up here, but I created a new project to repro an issue and the Dependencies tree lists a load of dependencies with no direct/transitive/dev nodes:
  > 
  > ![image](https://github.com/user-attachments/assets/5a7c953d-dc58-4a19-a287-ae3d61a8ec18)
  > 
  > I thought I had broken something with the recent refactor, but that's still [on a branch](https://github.com/Dart-Code/Dart-Code/tree/refactor-packages-views) and not landed yet!

  * [#5288](https://github.com/Dart-Code/Dart-Code/issues/5288): The Dependencies tree no longer triggers `pub deps` (which can create a `.dart_tool` folder) for workspaces where Pub has been disabled.

  > **#5288**: Expanding a project in Dependencies tree triggers a pub fetch which creates .dart_tool `is bug` `in views`
  > We run "pub deps" in projects when you expand them in the dependencies tree, but this can result in creating an unwanted `.dart_tool` folder (for example in the SDK expanding language_server_protocol in my analysis server workspace):
  > 
  > ![image](https://github.com/user-attachments/assets/86a4184e-ac6e-4540-b8eb-355798c98dbb)
  > 
  > ![image](https://github.com/user-attachments/assets/66029728-94f6-43f9-9738-b1bde08ed261)

  * [#5287](https://github.com/Dart-Code/Dart-Code/issues/5287): Nested packages in the Dependencies tree are now shown with (and sorted by) their relative paths from their workspace folders to make finding nodes in large workspaces easier.

  > **#5287**: Nested packages in Dependencies tree are shown flattened but sorted by path `is bug` `in views`
  > This list looks awkward... It's sorted by the full path, but we only show the basename of the path for the label. This also means packages with the same name within the workspace will look similar.
  > 
  > ![image](https://github.com/user-attachments/assets/166b9ddc-2090-4abb-829b-fcbc00d84024)
  > 
  > We might want to either sort by the basename of the path so the list is alphabetical, or show the relative path as the label and not just the subtle description.

  * [#5286](https://github.com/Dart-Code/Dart-Code/issues/5286): Analysis and project exclusions from `analysis_options.yaml` like `foo/**` no longer incorrectly exclude the folder `foo/`.

  > **#5286**: analysis_options exclusions are applied incorrectly when detecting projects `is bug` `in views`
  > When opening pkg:build, I only see a subset of packages in the Dependencies tree:
  > 
  > ![image](https://github.com/user-attachments/assets/faf8c18d-bb1e-493b-9bc0-ad0912825044)
  > 
  > It turns out, all the ones starting with `build` (besides the root folder itself) are missing. The cause is the analysis_options exclusions:
  > 
  > ```
  >   exclude:
  >     - "build/**"
  > ```
  > 
  > This is excluding a folder named _build_, but we're losing the slash and doing a `startsWith`:
  > 
  > https://github.com/Dart-Code/Dart-Code/blob/446fbae82d71fcfd52cb5934417e371760e0255f/src/shared/vscode/utils.ts#L144

  * [#5260](https://github.com/Dart-Code/Dart-Code/issues/5260): The dependencies tree now properly supports [Pub Workspaces](https://github.com/dart-lang/pub/issues/4127).

  > **#5260**: Update dependencies tree to support Pub workspaces `is enhancement` `in views`
  > `pub deps --json` will work slightly different with the Pub Workspaces feature, so we need to change how we parse the JSON slightly (see https://github.com/dart-lang/pub/issues/4330).
  > 
  > Currently we use `kind` field on a package to know if it is a direct/dev/transitive dependency, but that data will no longer be accurate because the solve is for all packages in the Pub Workspace and not the one where we executed `pub get`. Instead, we should look at the `dependencies` list for the package (and a new `dev_dependencies` that may be added as the solution to https://github.com/dart-lang/pub/issues/4330).
  > 
  > For an initial fix, we could continue to execute `pub deps` in each package and just ensure we filter the results correctly - but as a further optimisation we should run only in workspace roots or non-workspace packages, and produce multiple package nodes at the root of the tree from a single `pub deps --json` result.




## Misc

  * [#5283](https://github.com/Dart-Code/Dart-Code/issues/5283): The “Build errors exist in your project” dialog has been updated to no longer refer to errors as “Build errors” and uses “Run Anyway” instead of “Debug Anyway” because it can also apply to running without debugging.

  > **#5283**: Make "Build errors exist in your project" clearer `is enhancement` `in debugging`
  > See https://github.com/Dart-Code/Dart-Code/issues/5227#issuecomment-2312446050
  > 
  > It currently says "Build errors" when they are not build errors.
  > It says "Debug Anyway", but you might be "Running without Debugging".

  * [#5272](https://github.com/Dart-Code/Dart-Code/issues/5272): When a background process like the analyzer or Flutter daemon terminates unexpectedly, the “Open Log” button on the prompt will now open the specific log for that process (if enabled) instead of a generic log of all events from all processes.

  > **#5272**: The "Open Log" button on generic prompt to reload should be more targetted `is enhancement`
  > Noted by @FMorschel in Discord. When DTD crashed, the "Open Log" button had a lot of unrelated stuff in it (for ex. LSP traffic). The prompt itself is pretty generic and just shows the latest X events from the ring log.
  > 
  > In some cases, there might be a more specific log we can use, and even if there isn't, maybe we have a `LogCategory` we could filter to? We're already passing in a string message, so we could pass a category/logfile too.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They may be available to test in the current beta/master channels and will show up in future SDK releases.

  * [#5271](https://github.com/Dart-Code/Dart-Code/issues/5271): The URI for the Dart Tooling Daemon provided to DevTools is now correctly exposed/tunnelled for remote workspaces and passed to the DevTools server. This fixes some (but not all) issues with using the Sidebar and/or DevTools in web based IDEs.

  > **#5271**: Sidebar doesn't work in web contexts because DTD URI is not exposed `is bug` `in devtools` `in dtd`
  > This is a part of the problem for https://github.com/Dart-Code/Dart-Code/issues/5158. DevTools now needs a connection to DTD, but when running in a web context, it tries to connect to localhost (but the service is running on a remote container).
  > 
  > With https://github.com/flutter/devtools/commit/5457f57fb09b27d88a96d00792b9cb171ce9c29d, we can pass a second DTD URI to DevTools, but we need to expose and provide it here in the extension.

  * [#5247](https://github.com/Dart-Code/Dart-Code/issues/5247): Annotations on super parameters (`@annotation super.x`) are now correctly coloured, just like field formals are (`@annotation this.x`).

  > **#5247**: `@annotation super.` appears parsed differently than `@annotation this.` `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > I'm guessing the grammar change was not reflected the same way, ... or something :)
  > 
  > ```dart
  > import 'package:meta/meta.dart';
  > 
  > final class Base {
  >   const Base(@mustBeConst this.code);
  >   final int code;
  > }
  > 
  > final class Super extends Base {
  >   const Super(@mustBeConst super.code);
  > }
  > ```
  > 
  > Real example:
  > 
  > ![Screenshot 2024-09-03 at 11 47 26 PM](https://github.com/user-attachments/assets/47bdfb67-93a0-460e-95c6-e3ae6c5809a7)

  * [#5289](https://github.com/Dart-Code/Dart-Code/issues/5289): When using the latest Flutter `master` branch, color previews (and the ability to use the color picker) are no longer missing.

  > **#5289**: Color previews are missing on Flutter master `is bug` `in flutter` `in editor` `relies on sdk changes`
  > While switching between stable/master I noticed the color previews disappeared:
  > 
  > ![image](https://github.com/user-attachments/assets/dd43681e-62ce-44af-8db7-c6aed9810952)
  > 
  > I believe there are some Color changes in Flutter and wonder if the way we're computing these is no long valid.

  * [#5284](https://github.com/Dart-Code/Dart-Code/issues/5284): Dartdoc `@template` macros declared on members of extensions and extension types are now supported.

  > **#5284**: `@template` documents declared on extension aren't shown elsewhere `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > A clear and concise description of what the bug is.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Declare a template doccomment on a method in an extension
  > 2. Use elsewhere
  > 3. Hover over method
  > 
  > ```
  > ```dart
  > class Foo {
  >   /// {@macro baz}
  >   ///
  >   /// {@macro pink}
  >   ///
  >   ///
  >   ///
  >   ///
  >   ///
  >   ///
  >   ///
  >   void bar() {}
  > 
  >   /// {@template pink}
  >   /// this works
  >   /// {@endtemplate}
  >   void pink() {}
  > }
  > 
  > extension on Foo {
  >   /// {@template baz}
  >   /// This does not work
  >   /// {@endtemplate}
  >   void baz() {}
  > }
  > ```
  > 
  > **Expected behavior**
  > See the referenced template.
  > The template is shown if running `dart doc`, so this isn't an issue there.
  > 
  > **Screenshots**
  > 
  > As you can see, the `baz` template isn't rendered in the hover.
  > 
  > 
  > 
  > 
  > 
  > 
  > Workspace Environment
  > 
  > ```text
  > Dart Code extension: 3.96.0
  > Flutter extension: 3.96.0 (not activated)
  > 
  > App: Visual Studio Code
  > App Host: desktop
  > Remote: wsl
  > Host Kind: wsl
  > Version: li
  > 
  > _(truncated)_

  * [#5268](https://github.com/Dart-Code/Dart-Code/issues/5268): Output from Flutter’s `stderror` is now correctly decoded when captured using **Dart: Capture Debugging Logs** command.

  > **#5268**: Flutter stderror output is not correctly decoded in verbose debugging logs ("dart.log" events) `is bug` `in flutter` `in debugging` `relies on sdk changes`
  > Cause Flutter to write an error to `stderr`, for example by adding invalid `toolArgs`:
  > 
  > ```js
  > "toolArgs": [
  > 	"--invalid"
  > ]
  > ```
  > 
  > In the logs it looks like this:
  > 
  > ```
  > [12:51:40 PM] [DAP] [Info] `. They only contain the same data so it's not critical, but if only looking at the log events it makes it an extra step to decode.

  * [#5254](https://github.com/Dart-Code/Dart-Code/issues/5254): Extension members are no longer duplicated in code completion for all imported libraries in which they are available.

  > **#5254**: Many duplicate completion suggestions on generic extensions `is bug` `in editor` `relies on sdk changes`
  > **Describe the bug**
  > 
  > **Summary:**
  > 
  > When I've defined a generic extension method, I see _n_ duplicate suggestions for this method when I've imported the extension into _n_ files in my project. This is annoying because it increasingly clutters the suggestions list proportionally for extension methods I frequently use.
  > 
  > **Given:**
  > 
  > 1. Define a generic extension method such as:
  > ```dart
  > extension LetExtension on T {
  >   R let(R Function(T) op) => op(this);
  > }
  > ```
  > in the file `let_extension.dart`;
  > 
  > 2. This extension is imported into _n_ other files in my project;
  > 
  > 3. When I trigger completion suggestions in a new file (in which the extension has **not yet** been imported) on an object, I see **_n_ + 1** occurrences of the extension method (see screenshot below).
  > 
  > 4. When I trigger completion suggestions in a file in which the extension **has already** been imported, I see only one occurrence as expected.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Create a new
  > 
  > _(truncated)_

  * [#5242](https://github.com/Dart-Code/Dart-Code/issues/5242): Prefixed identifiers are no longer hidden from code completion just because the same name is in-scope without a prefix.

  > **#5242**: Prefixed identifiers shouldn't be hidden from completion by the same identifier with no/different prefixes `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > When you have two classes with the same name, there may be some places where you'd like one over the other because they have no relation.
  > 
  > **To Reproduce**
  > Add the following code to your `main.dart` file:
  > 
  > ```dart
  > import 'my_class_name.dart' as i;
  > 
  > class MyClassName {}
  > 
  > void main() {
  >   f();
  > }
  > 
  > void f(i.MyClassName c) {}
  > ```
  > 
  > Add a new file called `my_class_name.dart` and inside it add:
  > 
  > ```dart
  > class MyClassName {}
  > ```
  > 
  > Now inside the call for `f`, add `My` and try to fill the class, it only shows the class from this library.
  > 
  > Even if you only have class declarations with that name from other files like say you add a `second.dart` file with the same content as `my_class_name.dart`. Import it with the alias `s` and remove `MyClassName` declaration from inside `main.dart` (some changes to `f` as well, look the following code). It will not be able to show both declarations (not ever the second one without the `s.`). 
  > 
  > ```dart
  > import 'my_cl
  > 
  > _(truncated)_

