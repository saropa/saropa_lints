# Dart-Code v3-66

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.66.0 _2023-06-01_

## Editor

  * [#4563](https://github.com/Dart-Code/Dart-Code/issues/4563): The Run/Debug editor button will no longer show for files that don’t have a `main` function unless they are known entry files.

  > **#4563**: Don't show Run/Debug button for files that don't have a main function `is enhancement` `in editor` `in debugging`
  > Type: Bug
  > 
  > The Run button used be active only on main.dart. After an update (note sure which on), the Run button is now active on all .dart extension file, which gives error main entry not found. Either the Run button should be active only on main.dart or the extension should locate and run main.dart automatically.
  > 
  > Extension version: 3.64.0
  > VS Code version: Code 1.78.2 (b3e4e68a0bc097f0ae7907b217c1119af9e03435, 2023-05-10T14:47:05.613Z)
  > OS version: Linux x64 5.15.0-72-generic
  > Modes:
  > Sandboxed: Yes
  > 
  > System Info
  > 
  > _(truncated)_

  * [#4520](https://github.com/Dart-Code/Dart-Code/issues/4520): Syntax highlighting (shown with semantic tokens are unavailable or have not yet been computed) has been updated to resolve some issues with comments inside type parameters.

  > **#4520**: Update syntax highlighting `is enhancement` `in editor`
  > After https://github.com/dart-lang/dart-syntax-highlight/pull/46 lands, we should update to that version.




## Testing

  * [#4557](https://github.com/Dart-Code/Dart-Code/issues/4557): Multiple test suites are now run using relative instead of absolute paths. This reduces the chance of “Command line too long” errors on Windows when running a large selection of test suites (either explicitly, or because exclusions require each suite to be passed to `dart test`/`flutter test` individually). Further improvements to this will be made in a future release via [#4553](https://github.com/Dart-Code/Dart-Code/issues/4553).

  > **#4557**: Running multiple suites by filename uses absolute paths, exceeding Windows command line length too early `is bug` `in debugging` `in testing`
  > Split from #4553 since that requires a bit of a refactor, but just using relative paths would help significantly too.




## Terminal

  * [#4545](https://github.com/Dart-Code/Dart-Code/issues/4545): Setting `dart.addSdkToTerminalPath` to `false` now removes any SDK path that had already been added to `PATH` in the embedded terminal that VS Code would automatically re-apply after a restart.

  > **#4545**: Disable addSdkToTerminalPath not working `is bug`
  > **Describe the bug**
  > When disable `addSdkToTerminalPath` it still add path to Integrated terminal.
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Setting `dart.addSdkToTerminalPath` to false
  > 2. Close VSCode then open again (even restarted computer)
  > 3. Run in Integrated terminal `which flutter`
  > 4. See result, it still add default flutter location to Path
  > 
  > **Expected behavior**
  > Don't touch anything in PATH when `addSdkToTerminalPath` disabled.
  > 
  > **Screenshots**
  > Problem - it still select one version in many version at Sdk Paths then set to ahead $PATH
  > ![problem](https://github.com/Dart-Code/Dart-Code/assets/35319492/61f1ea39-2e4e-4f49-a234-03ca1d14b589)
  > 
  > Normal - when not open Flutter project, it is correct $PATH which set in system variables
  > ![normal](https://github.com/Dart-Code/Dart-Code/assets/35319492/e3d797b2-6a04-4f38-8e91-a7f2ea82f08d)
  > 
  > 
  > 
  > **Please complete the following information:**
  >  - Operating System and version: Windows 11
  >  - VS Code version: 1.7
  > 
  > _(truncated)_




## Commands

  * [#4527](https://github.com/Dart-Code/Dart-Code/issues/4527): The default project names when using the **Dart: New Project** and **Flutter: New Project** commands have been updated to better reflect the kind of project. For example selecting the “package” template will provide a default name of `dart_package_1` instead of `dart_application_1`.

  > **#4527**: The default project name for a Dart package should be `dart_package_x` `is enhancement` `in commands`
  > If I create a new Dart package project, the default project name is `dart_application_x` instead of `dart_package_x`. It should really be the latter.




## Debugger

  * [#4554](https://github.com/Dart-Code/Dart-Code/issues/4554): The Hot Reload option is no longer missing when using Run (without debugging) with the new SDK debug adapters.

  > **#4554**: Hot reload missing when using new SDK DAPs `is bug` `in flutter` `in debugging`
  > hot reload doesn't work in vs code, the keyboard shortcut is there in the settings but it doesn't work, the icon isn't there anymore, and only hot restart works.
  > 
  > ![image](https://github.com/Dart-Code/Dart-Code/assets/44902066/75c382bb-a18a-4d0e-bbc3-c2d7d3b52aa3)
  > 
  > I've tried to run a new app from the terminal and Android Studio and do a hot reload from there with no problems.
  > 
  > Dart: Capture debugging logs
  > [https://pastebin.pl/view/dec2abec](https://pastebin.pl/view/dec2abec)
  > 
  > Flutter doctor -v:
  > ```
  > [√] Flutter (Channel stable, 3.10.1, on Microsoft Windows [Version 10.0.19045.2846], locale en-US)        
  >     • Flutter version 3.10.1 on channel stable at C:\Developing\SDK\flutter
  >     • Upstream repository https://github.com/flutter/flutter.git
  >     • Framework revision d3d8effc68 (2 days ago), 2023-05-16 17:59:05 -0700
  >     • Engine revision b4fb11214d
  >     • Dart version 3.0.1
  >     • DevTools version 2.23.1
  > 
  > [√] Windows Version (Installed version of Windows is version 10
  > 
  > _(truncated)_

  * [#4539](https://github.com/Dart-Code/Dart-Code/issues/4539): The `customTool` field in launch configuration is [now detailed on the Dart-Code website](/docs/launch-configuration/) and does not causing a warning in VS Code that it’s not valid. This field is for advanced use where the `dart` or `flutter` tool need to be replaced by another (compatible) tool.

  > **#4539**: customTool launch configuration is not listed on dartcode website, and VS Code says it's not valid `is bug` `in debugging` `in docs / website`
  > I have a Dart-based macOS service that offloads some work to a native FFI plugin.  The plugin requires root privileges to perform some tasks.  When the service is properly installed in /Library/LaunchDaemons, it runs with root privileges and functions correctly.  However, when launching the service in the VS code debugger, those tasks fail because the debug session is not privileged.  
  > 
  > From the VS code level, it seems the answer to this problem is either:
  > (1) Launch VS code as superuser.  Running apps as root in macOS rarely works besides being frowned upon and I've encountered basic debugging issues trying to do so.
  > (2) Farm it off to the extension.  I've found that the Go extension supposedly has an "asRoot" setting for launch.json configurations though I haven't confirmed that.
  > 
  > I propose adding a Dart Code launch config setting to launch a debug session with sudo.  A reasonable prerequisite is adding the user to sudoers to avoid any password prompts (we develop this way with
  > 
  > _(truncated)_




## Misc

  * [#4556](https://github.com/Dart-Code/Dart-Code/issues/4556): A new setting `dart.analyzerAdditionalVmArgs` allows passing additional VM arguments when spawning the analysis server.

  > **#4556**: Add the ability to pass additional VM args when spawning the server `is enhancement` `in editor`
  > We can set the VM Service port, but we can't pass other VM args (such as `--serve-observatory`). We should add another setting for this (`"dart.analyzerAdditionalVmArgs"`).




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They will show up automatically after you upgrade to the next (non-hotfix) Dart/Flutter SDK release in future. If you’re using a recent bleeding-edge version, these items should already be available to you and any issues should be reported on GitHub in the usual way.

  * [#4535](https://github.com/Dart-Code/Dart-Code/issues/4535): Go-to-References on initializing formals now correctly finds references in calls to the function.

  > **#4535**: Go to references of Widget property only search in same file with Flutter 3.7+ `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > On newer Flutter version 3.7+ Go to References of Widget property only find in same file.
  > Old version 3.3.2 working fine.
  > Go to References of function property work fine on both
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 1. Clone https://github.com/noncheat/flutter_gotoreferences
  > 2. Using Flutter 3.3.2, right click `required this.problemReferences,` lib/test.dart:6 > Go to References
  > 3. Result will show `main.dart` and `test.dart`
  > 4. Using Flutter 3.10.0 repeat step 2
  > 5. Result only show `test.dart`
  > 
  > **Expected behavior**
  > Flutter 3.7+ when use `Go to References` of Widget property should find in all files.
  > 
  > **Screenshots**
  > Working - Go to References of Widget property in Flutter 3.3.2
  > ![](https://github.com/noncheat/flutter_gotoreferences/raw/master/3.3.2_work.png)
  > 
  > Problem - Go to References of Widget property in Flutter 3.10.0
  > ![](https://github.com/noncheat/flutter_gotoreferences/raw/master/3.10.0_problem.png)
  > 
  > Working - Go to Refe
  > 
  > _(truncated)_

  * [#4531](https://github.com/Dart-Code/Dart-Code/issues/4531): Go to Implementations no longer reports spurious results when implementations are provided by mixins in other files.

  > **#4531**: Go to Implementations on a getter gives random-looking results `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > Right click and show implementations on a specific getter, and the in-line dialog shows obviously implausible suggestions.  The feature works most of the time so I'm not sure what set of conditions is causing this.   IntelliJ's plugin seems to give good results here, so to start with, filing with the VSCode plugin. 
  > 
  > **To Reproduce**
  > Steps to reproduce the behavior:
  > 
  > 1. `git clone git@github.com:dart-lang/dartdoc.git`
  > 2. `cd dartdoc && git checkout e8c5de44294d61890ef28ca91e3ecf38e50c1c69`
  > 3. Set up directory as a Dart project 
  > 4. Open `lib/src/model/model_object_builder.dart` in VSCode
  > 5. Go to line 36 and right click on `modelBuilder`, select "Go to Implementations".
  > 
  > **Expected behavior**
  > Show only links to valid implementations.
  > 
  > **Screenshots**
  > ![Screenshot 2023-05-08 at 1 34 46 PM](https://github.com/Dart-Code/Dart-Code/assets/14116827/a9b8ccc7-7bbd-4368-bbdd-b2e3b490bc81)
  > 
  > **Please complete the following information:**
  >  - Operating System 
  > 
  > _(truncated)_

  * [#4530](https://github.com/Dart-Code/Dart-Code/issues/4530): Code completion for filenames is now available for conditional imports.

  > **#4530**: Filename completion doesn't work for conditional imports `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Filed by @mosuem at #4529. Splitting it up because the issues may be fixed separately.
  > 
  > > 2. There is no code completion for source file paths in conditional imports.

  * [#4521](https://github.com/Dart-Code/Dart-Code/issues/4521): Highlighting occurences of the selected variable now correctly includes variables declared by `for in` loops.

  > **#4521**: iterated variable in for..in loops no longer highlighted `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Until a couple months or so ago, if you had something like:
  > 
  > `for (final element in listOfStuff) {....}`
  > 
  > when the cursor is on `element`, all instances of that in the loop are highlighted, as vscode normally highlights variables. But recently it has stopped. If the cursor is on `listOfStuff`, the highlighting still works as expected, but nothing is highlighted when it's on `element`. See screenshot:
  > 
  > 
  > 
  > What used to happen (and I think what is supposed to still happen?) is that `element` should be highlighted, including where the cursor currently is, along with the two places it's used inside the loop. But you can see that's not happening.
  > 
  > Additionally, if you do put the cursor on one of them inside the loop, both instances inside the loop are highlighted (as expected) but the one in the 'for-in' line still is not highlighted.
  > 
  > 
  > 
  > I don't know if this is even a dart code extensions problem, or something with vscode itself, or something where a default setting was changed 
  > 
  > _(truncated)_

  * [#4506](https://github.com/Dart-Code/Dart-Code/issues/4506): Code folding is now available for `switch` statements.

  > **#4506**: Code folding for `switch` statements `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > With the addition of patterns to the Dart language, it would be nice if code folding could be used on `switch` statements, much as it can be used for other control flow such as `if` statements.
  > 
  > For example, given the code:
  > ```dart
  > switch (expr) {
  >   case 0:
  >     statement;
  >     statement;
  >     statement;
  >   case 1:
  >     statement;
  >     statement;
  >     statement;
  > }
  > ```
  > It would be nice to be able to collapse individual cases, e.g.
  > ```dart
  > switch (expr) {
  >   case 0: …
  >   case 1:
  >     statement;
  >     statement;
  >     statement;
  > }
  > ```
  > Or to collapse the entire switch statement:
  > ```dart
  > switch (expr) {…
  > }
  > ```

  * [#4499](https://github.com/Dart-Code/Dart-Code/issues/4499): Code completion no longer sometimes shows types as nullable if they have been restricted to being non-nullable by another `implement`ed type.

  > **#4499**: Code completion shows getter type as nullable for type that overrides to non-nullable `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **Describe the bug**
  > When a class has an implementation that overrides a getter (and also marks the type as non-nullable), the getter type is still shown as nullable in the autocomplete suggestion.
  > 
  > 
  > 
  > 
  > https://github.com/dart-lang/sdk/blob/fb43937e201b76a3a53cb5bb6a001b4c79463939/pkg/analyzer/lib/dart/element/element.dart#L1706
  > 
  > **To Reproduce**
  > Start typing `name` prop of `InterfaceOrAugmentationElement`.
  > 
  > **Please complete the following information:**
  >  - Operating System and version: macOS
  >  - VS Code version: 1.77.3
  >  - Dart extension version: v3.63.20230405
  >  - Dart/Flutter SDK version: 2.19.6

  * [#4498](https://github.com/Dart-Code/Dart-Code/issues/4498): Classes and constructors declaration now have the `declaration` semantic token modifier to allow them to be coloured differently by themes.

  > **#4498**: Classes and constructors are missing declaration semantic modifiers `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > We have a declaration modifier on fields, methods etc.:
  > 
  > 
  > 
  > But they don't seem to be on classes/constructors:

  * [#4495](https://github.com/Dart-Code/Dart-Code/issues/4495): Unnamed constructors now have the `constructor` semantic token modifier, matching named constructors.

  > **#4495**: Like named constructor, add  `constructor`  modifier for unnamed constructor `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > **[Screenshots Attached Below]**
  > I want to apply distinct color to all types of constructors i.e. named or unnamed so that I can **quickly spot** them wherever they are declared or used. Currently as named constructor has constructor modifier so I have used the following coloring customization:
  > ```
  > "method.constructor:dart": { 
  >     "bold": true,
  >     "foreground": "#2e32ff",
  >   },  
  > ```
  > Similar to named constructor, if there was constructor modifier for unnamed constructor then I could have used the following:
  > ```
  > "class.constructor:dart": {
  >     "bold": true,
  >     "foreground": "#2e32ff",
  >   },  
  > ```
  > 
  > First look at the **Named Constructor** that how nicely it has **_constructor_** **modifier**:
  > 
  > ![image](https://user-images.githubusercontent.com/14161646/232297478-5d1d358f-3e19-475d-bef0-6ece5cbc7e50.png)
  > 
  > Now look at the **Unnamed Constructor** that it doesn't have **_constructor_** **modifier**:
  >  
  > ![image](https://user-images.githubusercontent.com/14161646/232297984
  > 
  > _(truncated)_

  * [#4473](https://github.com/Dart-Code/Dart-Code/issues/4473): The `class` snippet no longer shows up inside enum definitions.
