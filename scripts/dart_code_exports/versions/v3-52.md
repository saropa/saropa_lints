# Dart-Code v3-52

For instructions on installing the Dart or Flutter extensions, [go here](/#installation).

# v3.52.1 _2022-11-02_

  * [#4239](https://github.com/Dart-Code/Dart-Code/issues/4239): An issue introduced with [#4197](https://github.com/Dart-Code/Dart-Code/issues/4197) that could prevent `cwd` being inferred correctly in multi-root workspaces when `program` was a relative path has been resolved.

  > **#4239**: "No such file or directory" for launch configuration with "program" but no "cwd" in multi-root workspace `is bug` `in debugging`
  > Noted by @maik-kluwe in https://github.com/Dart-Code/Dart-Code/pull/4197#issuecomment-1300023198.
  > 
  > Given a workspace:
  > 
  > ```js
  > {
  > 	"folders": [
  > 		{
  > 			"path": "proj1"
  > 		},
  > 		{
  > 			"path": "proj2"
  > 		}
  > 	],
  > }
  > ```
  > 
  > And a workspace folder has a launch config:
  > 
  > ```js
  > {
  > 	"version": "0.2.0",
  > 	"configurations": [
  > 		{
  > 			"name": "proj1",
  > 			"request": "launch",
  > 			"type": "dart",
  > 			"program": "bin/main.dart"
  > 		}
  > 	]
  > }
  > ```
  > 
  > Trying to run results in this:
  > 
  > 
  > 
  > 
  > 
  > This is likely caused by #4197 but I do not believe is expected. In this case, the `program` should be resolved relative to the workspace folder that it lives inside.




# v3.52.0 _2022-11-01_

## Debugger

  * [#4197](https://github.com/Dart-Code/Dart-Code/issues/4197): When launching debug sessions, if an explicit `program` is supplied but no `cwd` in the launch configuration, only the `program` (and not the current open file) will be used to determine the best working directory.

  > **#4197**: Don't infer cwd from workspace folder when there's an explicit program `is enhancement` `in debugging`
  > @helin24 does this solve the issue you had?
  > 
  > If there's a `program` we will try to infer a `cwd` from it, but if that fails, we should no longer use the workspace folder. We'll only use the workspace folder directly is there was no open file _or_ `program`.
  > 
  > Then, if we still don't have one (which we won't for a special `target` that doesn't have an enclosing `WorkspaceFolder`) we'll look for a common ancestor for all workspace folders.

  * [#4209](https://github.com/Dart-Code/Dart-Code/issues/4209): Mapping call stacks while debugging has been optimised in a way that avoids some calls that could fail when running Flutter apps on the web using the current stable Flutter SDK (an issue that has been fixed for future Flutter SDK releases).

  > **#4209**: Use line/col information from source locations instead of mapping tokenPosTables `is enhancement` `in debugging`
  > While investigating #4208 I noticed that the responses from the VM have line/col information and we don't need to look it up from tokenPosTable (as of https://github.com/dart-lang/sdk/commit/2db8f37cfa22d5120d56c82eeddd3f3008f72ec3). Assuming the data is there, this may save us fetching a lot of scripts.
  > 
  > (We should check both old and new DAPs).




## Flutter

  * [#4093](https://github.com/Dart-Code/Dart-Code/issues/4093): A new command **Flutter: Inspect Widget (Auto-Cancel after Selection)** behaves the same as **Flutter: Inspect Widget** but will automatically exit selection mode upon after selecting a widget and navigating in code.

  > **#4093**: Add a version of the Flutter: Inspect Widget command that auto-cancels on selection `is enhancement` `in flutter`
  > I often want to click on a UI element and see the line of widget code where its defined.
  > 
  > Currently this is eminently doable but involves the following steps: 
  > * click "open devtools" button in debug bar
  > * in Devtools click on "select widget mode" button
  > * click on the widget I'm interested in the Flutter running app 
  > * switch back to VSCode window (I run Devtools not in embedded mode)
  > * Remember to go back to Devtools to un-toggle  "select widget mode" button
  > * close devtools tab in web browser
  > 
  > It would be really nice if there was a single VSCode command palette command that I could use to do all of the above in one go, ie. select the cmd in the cmd palette, click on the widget I'm interested in the running app and then VSCode jumps to the relevant code line and exists out of  "select widget mode".




## Editor

  * [#4229](https://github.com/Dart-Code/Dart-Code/issues/4229): The legacy Type Hierarchy command no longer shows up in the command palette when using LSP (where it does not work). Integration with the new VS Code built-in Type Hierarchy will be available when using LSP in an upcoming Dart/Flutter SDK release (see below).

  > **#4229**: Old Type Hierarchy command should not show when using LSP `is bug` `in editor`
  > The old Type Hierarchy command does not work with LSP and should now show up in the palette.




## Features/Fixes Enabled with Future SDKs

The following items depend on changes to the Dart/Flutter SDKs that have not yet been released to stable channels. They will show up automatically after you upgrade to the next (non-hotfix) Dart/Flutter SDK release. If you’re using a recent `beta` or `master` version, these items should be available to you now and any issues should be reported on GitHub in the usual way.

  * [#4221](https://github.com/Dart-Code/Dart-Code/issues/4221): Refactorings like “Convert Getter to Method” no longer appear on references to symbols outside of your workspace which made it possible to accidentally modify Flutter SDK or Pub package sources.

  > **#4221**: Vscode refactoring: Convert Getter to Method applied to "widget", applies also to all flutter SDK & pub cache files `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Quite big warning, since doing this has opened hundreds of files from SDK/pub cache, in my Vscode, and (I don't which mistake I made) saved and corrupted all of them
  > 
  > ![image](https://user-images.githubusercontent.com/61077647/195983625-4ce687f0-ec07-4d39-aec5-a7210a9bfb3e.png)
  > 
  > ----
  > Linux mint 20.3
  > VS Code version: 1.72.2
  > Dart SDK version: 2.18.2 (stable) (Tue Sep 27 13:24:11 2022 +0200) on "linux_x64"
  > Flutter 3.3.4 • channel stable • https://github.com/flutter/flutter.git
  > Framework • revision eb6d86ee27 (il y a 10 jours) • 2022-10-04 22:31:45 -0700
  > Engine • revision c08d7d5efc
  > Tools • Dart 2.18.2 • DevTools 2.15.0

  * [#4202](https://github.com/Dart-Code/Dart-Code/issues/4202): The “Extract Method” refactor no longer shows up on import statements.

  > **#4202**: Extract Method show up in import statements `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > Similar to #4165, @jacob314 noticed this shows up for `import`s:
  > 
  > ![image](https://user-images.githubusercontent.com/1078012/194112399-86fb3837-da49-4437-b654-84c47fe53a6f.png)

  * [#4165](https://github.com/Dart-Code/Dart-Code/issues/4165): The “Extract Method” refactor no longer shows up on method declarations.

  > **#4165**: Extract Method appears in method delcaration `is bug` `in editor` `in lsp/analysis server`
  > ```dart
  > int test() => 42;
  > ```
  > 
  > Putting the caret before the parameter list shows Extract Method:
  > 
  > ![Screenshot 2022-09-21 at 11 10 44](https://user-images.githubusercontent.com/1078012/191478246-aba0b024-5838-40d2-a74d-b14c62009490.png)
  > 
  > This doesn't occur when not at the parameter list, and if invoked it generates bad code:
  > 
  > ```dart
  > int testnewMethod
  > 
  > newMethod() => 42;;
  > ```
  > 
  > (this doesn't seem related to the other parameter list issues discussed in #4157 as this occurs in 2.18 too).

  * [#4215](https://github.com/Dart-Code/Dart-Code/issues/4215): Renaming enum constants will no longer sometimes show “The element can’t be renamed”.

  > **#4215**: Unable to rename some enum elements `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > ```
  > [4:00:20 PM] [Analyzer] [Info] ==> {"jsonrpc":"2.0","id":22,"method":"textDocument/prepareRename","params":{"textDocument":{"uri":"file:///Users/danny/Dev/Google/dart-sdk/sdk/pkg/analysis_server/lib/src/computer/computer_lazy_type_hierarchy.dart"},"position":{"line":191,"character":7}},"clientRequestTime":1665673220121}
  > [4:00:20 PM] [Analyzer] [Info] <== {"id":22,"jsonrpc":"2.0","result":null}
  > ```

  * [#4214](https://github.com/Dart-Code/Dart-Code/issues/4214): Changing the `"dart.showTodos"` setting now applies immediately rather than only when a file is next modified (or a VS Code reload).

  > **#4214**: Changing TODO setting does not take immediate affect for LSP `is bug` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > It seems for DAS we restart the server, but not for LSP. If the setting is now being interpreted by the server, it should handle this itself (rather than in the client).

  * [#4203](https://github.com/Dart-Code/Dart-Code/issues/4203): Quick fixes in the lightbulb menu are no longer sometimes ordered incorrectly with `// ignore:` fixes appearing further up the list than intended.

  > **#4203**: Quick fixes are ordered badly `is bug` `in editor` `relies on sdk changes`
  > I would expect all `ignores` to be further down, and the "add import" to further up. Not sure if it's VS Code's new menu or a server issue.

  * [#4156](https://github.com/Dart-Code/Dart-Code/issues/4156): Inlay hints for types (shown while holding `Ctrl`+`Option/Alt`) can now be hovered to see documentation for that type.

  > **#4156**: Support hovers on type inlay hints `is enhancement` `in editor` `in lsp/analysis server`
  > As part of #4154 we'll be showing types as inlay hints:
  > 
  > ![Screenshot 2022-09-13 at 11 16 34](https://user-images.githubusercontent.com/1078012/189876376-9d2a7c13-0a5d-42df-9624-c2a992e77e63.png)
  > 
  > It would be nice if you could hover over these and also get the dartdoc for that type. It looks like inlay hints support tooltips, and we could include an element reference string in the `data` and stitch this in via `resolve` (which we don't currently support, but could).

  * [#2527](https://github.com/Dart-Code/Dart-Code/issues/2527)/[#3313](https://github.com/Dart-Code/Dart-Code/issues/3313): VS Code’s built-in Type Hierarchy is now available (when using LSP) and can be found in the context menu.

  > **#2527**: Implement Type Hierarchy for LSP `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > How can I revover this function? Thanks! 
  > My IDE:
  > Name: Visual Studio Code
  > Version: 1.45.1
  > Commit: 5763d909d5f12fe19f215cbfdd29a91c0fa9208a
  > Date: 2020-05-14T08:33:47.663Z
  > Electron: 7.2.4
  > Chrome: 78.0.3904.130
  > Node.js: 12.8.1
  > V8: 7.8.279.23-electron.0
  > OS: Darwin x64 18.7.0
  > 
  > My Flutter and Dart SDK :3.11.0
  > 
  > ![image](https://user-images.githubusercontent.com/2143234/83995129-2389c080-a98b-11ea-8e8f-c4dbb56bab30.png)
  > 
  > ![image](https://user-images.githubusercontent.com/2143234/83995086-f806d600-a98a-11ea-9df5-1213a886042d.png)

  * [#4217](https://github.com/Dart-Code/Dart-Code/issues/4217): The new Type Hierarchy now includes Type Arguments in labels.

  > **#4217**: Include type arguments in Type Hierarchy `is enhancement` `in editor` `in lsp/analysis server` `relies on sdk changes`
  > ```dart
  > class A extends B {}
  > class B {}
  > ```
  > 
  > When browsing the hierarchy from A, we see a node for `B` but it doesn't include `` (or ``).

  * [#4206](https://github.com/Dart-Code/Dart-Code/issues/4206): Expression evaluation is now available in the Debug Console when running Flutter integration tests.

  > **#4206**: Evaluate code in Debug Console during integration tests `is enhancement` `in flutter` `in testing`
  > ### Describe the bug
  > **TL;DR** I can't evaluate code in Debug Console when running integration tests. I don't know if I'm doing something wrong or if this is just not possible.
  > 
  > 
  > Also, I can't find a way to run (using VS Code's `launch.json`) normal widget tests with `flutter run test/widget_test.dart` (=running on device) instead of `flutter test test/widget_test.dart` (running in isolation). This might be another issue, though.
  > 
  > ### To Reproduce
  > 
  > **TL;DR** Run any Flutter integration test with VS Code and try to evaluate Dart code in the Debug Console.
  > 
  > Create `.vscode/launch.json` in the root of a Flutter project with the following contents:
  > 
  > ```json
  > {
  >   "version": "0.2.0",
  >   "configurations": [
  >     {
  >       "name": "flutter run app",
  >       "request": "launch",
  >       "type": "dart",
  >       "program": "lib/main.dart"
  >     },
  >     {
  >       "name": "flutter run integration tests",
  >       "request": "launch",
  >       "type": "dart",
  >       "program": "integration_test/e
  > 
  > _(truncated)_

  * [#4213](https://github.com/Dart-Code/Dart-Code/issues/4213): Lists from `dart:typed_data` like `Uint8List` are now rendered as lists (rather than objects) in Watch/Variables panels when using the new SDK DAPs.

  > **#4213**: Improve rendering of Uint8List (and friends) in the debugger `is enhancement` `in debugging` `relies on sdk changes`
  > ```dart
  > final a = [1, 2, 3, 4, 5, 6];
  > final b = Uint8List.fromList(a);
  > final c = Uint16List.fromList(a)
  > ```
  > 
  > List `a` looks like a list, but the others do not:
  > 
  > 
  > 
  > In the VM Service traffic, we can see the item has a `length: 6` so we might be able to present it the same as a standard `List`:

  * [#4204](https://github.com/Dart-Code/Dart-Code/issues/4204)/[#4205](https://github.com/Dart-Code/Dart-Code/issues/4205): Large lists in Watch/Variables panels are now paged when using the new SDK DAPs, avoiding long delays/hangs when trying to expand very large lists.

  > **#4204**: Large lists in locals/watch windows can hang `is bug` `in debugging` `relies on sdk changes`
  > Reported on StackOverflow: https://stackoverflow.com/q/73921614/25124
  > 
  > ```dart
  > import 'dart:typed_data';
  > 
  > void main() {
  >   Uint8List inputBytes = Uint8List.fromList(List.filled(100000000, 0));
  >   print(''); // Breakpoint here
  > }
  > ```
  > 
  > We send a `getObject()` request but there's no offset/length s presumably it's trying to send the entire list back which is huge. It's possible being a `Uint8List` complicates things, but a normal List (`List.filled(100000000, 0)`) has issues too.
  > 
  > ```
  >  {
  > 	"jsonrpc": "2.0",
  > 	"id": "40",
  > 	"method": "getObject",
  > 	"params": {
  > 		"isolateId": "isolates/2007599444226843",
  > 		"objectId": "objects/1"
  > 	}
  > }
  > ```
  > 
  > For `Uint8List` the `kind` is `Uint8List` but it still has a length, and the kinds that provide lists are documented in https://github.com/dart-lang/sdk/blob/master/runtime/vm/service/service.md#instance (string, map, and various lists).

